<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/png" href="../favicon-96x96.png" sizes="96x96" />
		<link rel="icon" type="image/svg+xml" href="../favicon.svg" />
		<link rel="shortcut icon" href="../favicon.ico" />
		<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png" />
		<meta name="apple-mobile-web-app-title" content="Maltsev.Space" />
		<link rel="manifest" href="../site.webmanifest" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1, maximum-scale=5, viewport-fit=cover"
		/>
		
		<link href="../_app/immutable/assets/link.BAldVUzc.css" rel="stylesheet">
		<link href="../_app/immutable/assets/tag-cloud.D51KQwgG.css" rel="stylesheet">
		<link href="../_app/immutable/assets/0.Ev2lDQ97.css" rel="stylesheet">
		<link href="../_app/immutable/assets/7.BPVSJhiw.css" rel="stylesheet">
		<link rel="modulepreload" href="../_app/immutable/entry/start.BAwsauoP.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CU9xnZuL.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CwbgRza9.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DUiI8Tgq.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CYgJF_JY.js">
		<link rel="modulepreload" href="../_app/immutable/entry/app.BpIvGGP8.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Dp1pzeXC.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/9RHoeuvn.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CKaYoKbp.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Bc90b5vU.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/0.DMrUjdpS.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BIt0NJHA.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/NXvnr6M4.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CYbmHHiD.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Dc4aelGg.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BCQ5r3qw.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/7.C1eeObjv.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DNSHY1Ls.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DC53pYih.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Og1VuF_t.js"><!--[--><link rel="alternate" type="application/rss+xml" title="Aleksey Maltsev's Blog" href="/rss.xml"><!--]--><!--[--><!--]--><title>Testing Private Code in C#: Breaking Encapsulation with InternalsVisibleTo Attribute | MALTSEV.SPACE</title>
	</head>

	<body data-sveltekit-preload-data="hover">
		<div style="display: contents"><!--[--><!--[--><!----><div class="space-layout svelte-144yekp"><header class="svelte-yqzv1j"><nav class="space-container svelte-yqzv1j"><div class="logo svelte-yqzv1j"><a href="/" class="svelte-yqzv1j">MALTSEV.SPACE</a></div> <ul class="nav-links svelte-yqzv1j"><li><a class="nav-link svelte-yqzv1j" href="/">Home</a></li> <li><a class="nav-link svelte-yqzv1j" href="/about">About</a></li> <li><a class="nav-link svelte-yqzv1j" href="/art">Gallery</a></li> <li><a class="nav-link svelte-yqzv1j" href="/blog">Blog</a></li></ul> <div class="nav-actions svelte-yqzv1j"><a href="/rss.xml" class="rss-link nav-link svelte-yqzv1j" aria-label="RSS Feed"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" class="lucide-icon lucide lucide-rss"><!--[--><!----><path d="M4 11a9 9 0 0 1 9 9"><!----></path><!----><!----><path d="M4 4a16 16 0 0 1 16 16"><!----></path><!----><!----><circle cx="5" cy="19" r="1"><!----></circle><!----><!--]--><!----><!----></svg><!----></a> <div class="theme-switch svelte-awph5w"><button class="theme-button svelte-awph5w" title="Light theme" aria-label="Light theme"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon lucide lucide-sun"><!--[--><!----><circle cx="12" cy="12" r="4"><!----></circle><!----><!----><path d="M12 2v2"><!----></path><!----><!----><path d="M12 20v2"><!----></path><!----><!----><path d="m4.93 4.93 1.41 1.41"><!----></path><!----><!----><path d="m17.66 17.66 1.41 1.41"><!----></path><!----><!----><path d="M2 12h2"><!----></path><!----><!----><path d="M20 12h2"><!----></path><!----><!----><path d="m6.34 17.66-1.41 1.41"><!----></path><!----><!----><path d="m19.07 4.93-1.41 1.41"><!----></path><!----><!--]--><!----><!----></svg><!----></button> <button class="theme-button svelte-awph5w" title="Dark theme" aria-label="Dark theme"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon lucide lucide-moon"><!--[--><!----><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"><!----></path><!----><!--]--><!----><!----></svg><!----></button> <button class="theme-button svelte-awph5w active" title="System theme" aria-label="System theme"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon lucide lucide-laptop"><!--[--><!----><path d="M20 16V7a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v9m16 0H4m16 0 1.28 2.55a1 1 0 0 1-.9 1.45H3.62a1 1 0 0 1-.9-1.45L4 16"><!----></path><!----><!--]--><!----><!----></svg><!----></button></div><!----> <button class="mobile-menu-toggle svelte-yqzv1j" aria-label="Toggle menu"><!--[!--><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" class="lucide-icon lucide lucide-menu"><!--[--><!----><path d="M4 12h16"><!----></path><!----><!----><path d="M4 18h16"><!----></path><!----><!----><path d="M4 6h16"><!----></path><!----><!--]--><!----><!----></svg><!--]--></button></div></nav> <div class="mobile-nav svelte-yqzv1j"><ul class="svelte-yqzv1j"><li class="svelte-yqzv1j"><a class="nav-link svelte-yqzv1j" href="/">Home</a></li> <li class="svelte-yqzv1j"><a class="nav-link svelte-yqzv1j" href="/about">About</a></li> <li class="svelte-yqzv1j"><a class="nav-link svelte-yqzv1j" href="/art">Gallery</a></li> <li class="svelte-yqzv1j"><a class="nav-link svelte-yqzv1j" href="/blog">Blog</a></li></ul></div></header><!----> <div class="stars-background svelte-1xnwqdy"><!--[--><!--]--></div><!----> <main class="svelte-144yekp"><div class="space-container"><!----><!--[--><div class="hero-background-container svelte-17kp2kb"><img src="/images/blog/003-internals-visible-for-testing/hero.jpg" alt="Testing Private Code in C#: Breaking Encapsulation with InternalsVisibleTo Attribute hero image" loading="lazy" class="hero-background-image svelte-17kp2kb"> <div class="hero-content svelte-17kp2kb"><hgroup class="svelte-17kp2kb"><h1 class="space-title svelte-17kp2kb">Testing Private Code in C#: Breaking Encapsulation with InternalsVisibleTo Attribute</h1> <p class="svelte-17kp2kb"><span>Published at <time datetime="2024-06-15">2018-11-12</time></span></p></hgroup></div></div><!--]--> <article class="svelte-17kp2kb"><!--[!--><!--]--> <div class="post-navigation top-navigation svelte-17kp2kb"><!--[--><a href="/blog" class="button primary medium svelte-6ghmor"><!---->← Back to all posts<!----></a><!--]--><!----></div> <div class="prose"><h2 id="about-tests-for-private-code"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#about-tests-for-private-code">#</a>About tests for private code</h2> <p>Well, most of the time, if you need to test some private logic, maybe you it’s better to be SPECIFIC and extract it to public members of new classes. Sometimes decomposition “rocks” and you code became clearer and more maintainable, so check it out before.</p> <p>However, this private logic can be really connected to the domain of a single class and isn’t worth of extracting it somewhere else.</p> <p>In that case you have 3 simple options and all of them somehow break the idea of encapsulation:</p> <ul><li>Make those members <code>public</code> and treat them in your test-fixtures as usual. It may be OK, if you are writing simple app and for now you don’t care about clean public interfaces. However, if you provide it as a public library, This approach opens you internal logic for every user, so, if “dirty” usage of these members could break state of your objects or even whole application.</li> <li>Make those members <code>protected</code>, inherit into your testable stub, which will make those members <code>public</code>, or derive your test-fixture from it. This can also work, but you have to write some boilerplate code. However, it is not suitable, if your class is sealed. For example, if you don’t want users to extend it, as it may break the logic of connected classes.</li> <li>Make those members <code>internal</code> and add <code>InternalsVisibleTo</code> attribute on assembly-level. This approach also breaks encapsulation, but only inside you assembly, all your public interfaces for users will stay clean and secure. And you don’t need to use inheritance and write stubs.</li></ul> <h2 id="how-to-use-internalsvisibleto"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#how-to-use-internalsvisibleto">#</a>How to use <code>InternalsVisibleTo</code></h2> <p>For example, you have got a class <code>Some</code> with public method <code>Increment</code> and internal property <code>Counter</code> as object’s state:</p> <!----><pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">namespace</span><span style="color:#BABED8;--shiki-dark:#B392F0"> InternalsLib</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> class</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Some</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">        internal</span><span style="color:#89DDFF;--shiki-dark:#F97583"> int</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Counter</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#123;</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> get</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> set</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">        public</span><span style="color:#89DDFF;--shiki-dark:#F97583"> void</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Increment</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#123;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">            Counter</span><span style="color:#89DDFF;--shiki-dark:#F97583">++</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre><!----> <p>You want to assert its state in some CLI or test-fixture:</p> <!----><pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#F78C6C;--shiki-dark:#F97583">using</span><span style="color:#BABED8;--shiki-dark:#B392F0"> System</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#B392F0">Diagnostics</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F78C6C;--shiki-dark:#F97583">using</span><span style="color:#BABED8;--shiki-dark:#B392F0"> InternalsLib</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">namespace</span><span style="color:#BABED8;--shiki-dark:#B392F0"> InternalsVisibleTests</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">    class</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Program</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">        static</span><span style="color:#89DDFF;--shiki-dark:#F97583"> void</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Main</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[]</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> args</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#123;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">            var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> someObj</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#89DDFF;--shiki-dark:#F97583"> new</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Some</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">            someObj</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">Increment</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">            Trace</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">WriteLine</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">$"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">Expected count </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#F78C6C;--shiki-dark:#79B8FF">1</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#125;</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">, real count </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">someObj</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">Counter</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#125;"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre><!----> <p>We can’t access property <code>Counter</code> in assembly <code>InternalsVisibleTests</code>, because it’s modifier is <code>internal</code>. To open internal logic for other assemblies, you need to provide attribute for whole testable assembly in file <code>AssemblyInfo.cs</code> or just above the definition of your class, it doesn’t really matter.
Let’s put attribute invocation into <code>AssemblyInfo.cs</code> of project <code>InternalsLib</code>:</p> <!----><pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[</span><span style="color:#F78C6C;--shiki-dark:#F97583">assembly</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">:</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> InternalsVisibleTo</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">InternalsVisibleTests</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)]</span></span></code></pre><!----> <p>Now <code>InternalsVisibleTests</code> became a friend assembly and internal members from assembly <code>InternalsLib</code> became visible inside of its scope.</p> <p>You can learn more about <code>InternalsVisibleTo</code> at <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.compilerservices.internalsvisibletoattribute" rel="nofollow">documentation</a>.</p><!----></div> <footer class="post-footer svelte-17kp2kb"><div class="post-navigation svelte-17kp2kb"><!--[--><a href="/blog" class="button primary medium svelte-6ghmor"><!---->← Back to all posts<!----></a><!--]--><!----></div> <div class="card default svelte-1bwdm5p"><div class="share-message svelte-17kp2kb">Enjoyed this post? Share it with the universe!</div> <div class="share-buttons svelte-17kp2kb"><a class="link default share-link twitter svelte-blzdii" target="_blank" rel="noopener noreferrer" href="https://twitter.com/intent/tweet?text=Testing%20Private%20Code%20in%20C%23%3A%20Breaking%20Encapsulation%20with%20InternalsVisibleTo%20Attribute&amp;url=" aria-label="Share on Twitter"><!---->Twitter<!----> <!--[!--><!--]--></a><!----> <a class="link default share-link linkedin svelte-blzdii" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/shareArticle?mini=true&amp;title=Testing%20Private%20Code%20in%20C%23%3A%20Breaking%20Encapsulation%20with%20InternalsVisibleTo%20Attribute&amp;url=" aria-label="Share on LinkedIn"><!---->LinkedIn<!----> <!--[!--><!--]--></a><!----> <a class="link default share-link facebook svelte-blzdii" target="_blank" rel="noopener noreferrer" href="https://www.facebook.com/sharer/sharer.php?u=" aria-label="Share on Facebook"><!---->Facebook<!----> <!--[!--><!--]--></a><!----></div><!----> <!--[!--><!--]--></div><!----></footer></article><!----><!----></div></main> <footer class="svelte-1mbgpkc"><div class="space-container"><p class="space-text-small">© 2025 | Aleksey Maltsev</p></div></footer><!----></div><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_11ym62i = {
						base: new URL("..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("../_app/immutable/entry/start.BAwsauoP.js"),
						import("../_app/immutable/entry/app.BpIvGGP8.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 7],
							data: [null,null],
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
