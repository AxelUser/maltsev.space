<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1, maximum-scale=5, viewport-fit=cover"
		/>

		<!-- Favicons -->
		<link rel="icon" type="image/png" href="../favicon-96x96.png" sizes="96x96" />
		<link rel="icon" type="image/svg+xml" href="../favicon.svg" />
		<link rel="shortcut icon" href="../favicon.ico" />
		<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png" />
		<meta name="apple-mobile-web-app-title" content="Maltsev.Space" />
		<link rel="manifest" href="../site.webmanifest" />
		
		<link href="../_app/immutable/assets/one-column-layout.dk0RUYX7.css" rel="stylesheet">
		<link href="../_app/immutable/assets/tag-cloud.70LkpYqV.css" rel="stylesheet">
		<link href="../_app/immutable/assets/0.CaXpniMl.css" rel="stylesheet">
		<link href="../_app/immutable/assets/posts.BYtmJbQG.css" rel="stylesheet">
		<link href="../_app/immutable/assets/8.BFZU1Dea.css" rel="stylesheet">
		<link rel="modulepreload" href="../_app/immutable/entry/start.GJZ_hnUf.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BTXdbtFg.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/sVw9Ped7.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DS0R9CKb.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CYgJF_JY.js">
		<link rel="modulepreload" href="../_app/immutable/entry/app.SOLyqlcg.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Dp1pzeXC.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CqZlLleP.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/COfChAPb.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BUJIhQsn.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/0.B8Zyb8ny.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/C04FsZVz.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/E2_GMQvN.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CPVJZChB.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DasYoi_Y.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/8.Bd5ggBuO.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DbeoEI5c.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Cq_8lF6v.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/J-DOm9KT.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DNSHY1Ls.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DtIdhLIQ.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/B67hBybd.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BLvE5VWU.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CjY4LRRC.js"><!--[--><link rel="alternate" type="application/rss+xml" title="Aleksey Maltsev's Blog" href="/rss.xml"> <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml"><!--]--><!--[--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css" integrity="sha384-5TcZemv2l/9On385z///+d7MSYlvIEw9FuZTIdZ14vJLqWphw7e7ZPuOiCHJcFCP" crossorigin="anonymous"><!--]--><!--[--><meta name="description" content="It started with a simple thought: four bytes in a hash table bucket look just like an integer. Luckily, this one idea led to a deep dive into bit-twiddling and a 2x performance boost."> <link rel="canonical" href="https://maltsev.space/blog/012-simd-within-a-register-how-i-doubled-hash-table-lookup-performance"> <!--[!--><meta name="robots" content="index, follow"><!--]--> <meta property="og:type" content="article"> <meta property="og:title" content="SIMD Within a Register: How I Doubled Hash Table Lookup Performance | MALTSEV.SPACE"> <meta property="og:description" content="It started with a simple thought: four bytes in a hash table bucket look just like an integer. Luckily, this one idea led to a deep dive into bit-twiddling and a 2x performance boost."> <meta property="og:image" content="https://maltsev.space/images/og/012-simd-within-a-register-how-i-doubled-hash-table-lookup-performance.jpg"> <meta property="og:image:alt" content="SIMD Within a Register: How I Doubled Hash Table Lookup Performance - SIMD Within a Register: How I Doubled Hash Table Lookup Performance"> <meta property="og:url" content="https://maltsev.space/blog/012-simd-within-a-register-how-i-doubled-hash-table-lookup-performance"> <meta property="og:site_name" content="MALTSEV.SPACE"> <meta property="og:locale" content="en_US"> <!--[--><!--[--><meta property="article:published_time" content="2025-07-15T00:00:00.000Z"><!--]--> <!--[!--><!--]--> <!--[--><meta property="article:author" content="Aleksey Maltsev"><!--]--> <meta property="article:section" content="Technology"> <!--[--><meta property="article:tag" content="C#"><meta property="article:tag" content="Bitwise tricks"><meta property="article:tag" content="Hash table"><meta property="article:tag" content="Performance"><meta property="article:tag" content="Bitwise"><meta property="article:tag" content="C#"><!--]--><!--]--> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:title" content="SIMD Within a Register: How I Doubled Hash Table Lookup Performance | MALTSEV.SPACE"> <meta name="twitter:description" content="It started with a simple thought: four bytes in a hash table bucket look just like an integer. Luckily, this one idea led to a deep dive into bit-twiddling and a 2x performance boost."> <meta name="twitter:image" content="https://maltsev.space/images/og/012-simd-within-a-register-how-i-doubled-hash-table-lookup-performance.jpg"> <meta name="twitter:image:alt" content="SIMD Within a Register: How I Doubled Hash Table Lookup Performance - SIMD Within a Register: How I Doubled Hash Table Lookup Performance"> <meta name="twitter:site" content="@axel_user"> <meta name="twitter:creator" content="@axel_user">  <!----><script type="application/ld+json">{"@context":"https://schema.org","@type":"Person","name":"Aleksey Maltsev","jobTitle":"Senior Software Engineer","description":"Senior Software Engineer focused on distributed systems and highload applications","url":"https://maltsev.space/","image":"https://maltsev.space/images/ava.jpg","sameAs":["https://github.com/AxelUser","https://www.linkedin.com/in/dev-alexey-maltsev/"]}</script><!----> <!--[!--><!--]--> <!--[--><!----><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"SIMD Within a Register: How I Doubled Hash Table Lookup Performance","description":"It started with a simple thought: four bytes in a hash table bucket look just like an integer. Luckily, this one idea led to a deep dive into bit-twiddling and a 2x performance boost.","image":"https://maltsev.space/images/og/012-simd-within-a-register-how-i-doubled-hash-table-lookup-performance.jpg","author":{"@context":"https://schema.org","@type":"Person","name":"Aleksey Maltsev","jobTitle":"Senior Software Engineer","description":"Senior Software Engineer focused on distributed systems and highload applications","url":"https://maltsev.space/","image":"https://maltsev.space/images/ava.jpg","sameAs":["https://github.com/AxelUser","https://www.linkedin.com/in/dev-alexey-maltsev/"]},"publisher":{"@context":"https://schema.org","@type":"Person","name":"Aleksey Maltsev","jobTitle":"Senior Software Engineer","description":"Senior Software Engineer focused on distributed systems and highload applications","url":"https://maltsev.space/","image":"https://maltsev.space/images/ava.jpg","sameAs":["https://github.com/AxelUser","https://www.linkedin.com/in/dev-alexey-maltsev/"]},"url":"https://maltsev.space/blog/012-simd-within-a-register-how-i-doubled-hash-table-lookup-performance","datePublished":"2025-07-15T00:00:00.000Z","dateModified":"2025-07-15T00:00:00.000Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://maltsev.space/blog/012-simd-within-a-register-how-i-doubled-hash-table-lookup-performance"},"keywords":["C#","Bitwise tricks","Hash table","Performance","Bitwise","C#"]}</script><!----><!--]--><!--]--><title>SIMD Within a Register: How I Doubled Hash Table Lookup Performance | MALTSEV.SPACE</title>
	</head>

	<body data-sveltekit-preload-data="hover">
		<div style="display: contents"><!--[--><!--[--><!----><div class="space-layout svelte-144yekp"><header class="svelte-1eq0cli"><div class="space-container nav-bar svelte-7gsxae"><div class="logo svelte-1eq0cli"><a href="/" class="svelte-1eq0cli">MALTSEV.SPACE</a></div> <ul class="nav-links svelte-1eq0cli"><li><a class="nav-link svelte-1eq0cli" href="/">Home</a></li> <li><a class="nav-link svelte-1eq0cli" href="/about">About</a></li> <li><a class="nav-link svelte-1eq0cli" href="/art">Gallery</a></li> <li><a class="nav-link svelte-1eq0cli" href="/blog">Blog</a></li></ul> <div class="nav-actions svelte-1eq0cli"><a href="/rss.xml" class="rss-link nav-link svelte-1eq0cli" aria-label="RSS Feed"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" class="lucide-icon lucide lucide-rss"><!--[--><!----><path d="M4 11a9 9 0 0 1 9 9"><!----></path><!----><!----><path d="M4 4a16 16 0 0 1 16 16"><!----></path><!----><!----><circle cx="5" cy="19" r="1"><!----></circle><!----><!--]--><!----><!----></svg><!----></a> <div class="theme-switch svelte-awph5w"><button class="theme-button svelte-awph5w" title="Light theme" aria-label="Light theme"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon lucide lucide-sun"><!--[--><!----><circle cx="12" cy="12" r="4"><!----></circle><!----><!----><path d="M12 2v2"><!----></path><!----><!----><path d="M12 20v2"><!----></path><!----><!----><path d="m4.93 4.93 1.41 1.41"><!----></path><!----><!----><path d="m17.66 17.66 1.41 1.41"><!----></path><!----><!----><path d="M2 12h2"><!----></path><!----><!----><path d="M20 12h2"><!----></path><!----><!----><path d="m6.34 17.66-1.41 1.41"><!----></path><!----><!----><path d="m19.07 4.93-1.41 1.41"><!----></path><!----><!--]--><!----><!----></svg><!----></button> <button class="theme-button svelte-awph5w" title="Dark theme" aria-label="Dark theme"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon lucide lucide-moon"><!--[--><!----><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"><!----></path><!----><!--]--><!----><!----></svg><!----></button> <button class="theme-button svelte-awph5w active" title="System theme" aria-label="System theme"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon lucide lucide-laptop"><!--[--><!----><path d="M20 16V7a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v9m16 0H4m16 0 1.28 2.55a1 1 0 0 1-.9 1.45H3.62a1 1 0 0 1-.9-1.45L4 16"><!----></path><!----><!--]--><!----><!----></svg><!----></button></div><!----> <button class="mobile-menu-toggle svelte-1eq0cli" aria-label="Toggle menu"><!--[!--><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" class="lucide-icon lucide lucide-menu"><!--[--><!----><path d="M4 12h16"><!----></path><!----><!----><path d="M4 18h16"><!----></path><!----><!----><path d="M4 6h16"><!----></path><!----><!--]--><!----><!----></svg><!--]--></button></div><!----></div><!----> <div class="mobile-nav svelte-1eq0cli"><ul class="svelte-1eq0cli"><li class="svelte-1eq0cli"><a class="nav-link svelte-1eq0cli" href="/">Home</a></li> <li class="svelte-1eq0cli"><a class="nav-link svelte-1eq0cli" href="/about">About</a></li> <li class="svelte-1eq0cli"><a class="nav-link svelte-1eq0cli" href="/art">Gallery</a></li> <li class="svelte-1eq0cli"><a class="nav-link svelte-1eq0cli" href="/blog">Blog</a></li></ul></div></header><!----> <div class="stars-background svelte-1xnwqdy"><!--[--><!--]--></div><!----> <main class="svelte-144yekp"><!--[!--><!----><!----> <div class="hero-background-container svelte-18l6c9h"><!--[--><img src="data:image/png;base64,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" alt="SIMD Within a Register: How I Doubled Hash Table Lookup Performance hero image placeholder" class="hero-image hero-placeholder-image svelte-18l6c9h"> <!--[!--><picture class="svelte-18l6c9h"><!--[--><source srcset="/_app/immutable/assets/hero.CAYiYJgd.avif 1x, /_app/immutable/assets/hero.2A24B_Gh.avif 2x" sizes="min(1536px, 100vw)" type="image/avif" class="svelte-18l6c9h"><source srcset="/_app/immutable/assets/hero.VTA5Cz52.webp 1x, /_app/immutable/assets/hero.Cvegwbyq.webp 2x" sizes="min(1536px, 100vw)" type="image/webp" class="svelte-18l6c9h"><source srcset="/_app/immutable/assets/hero.Blfknt1o.jpg 1x, /_app/immutable/assets/hero.CvtWwOfE.jpg 2x" sizes="min(1536px, 100vw)" type="image/jpeg" class="svelte-18l6c9h"><!--]--> <img src="/_app/immutable/assets/hero.CvtWwOfE.jpg" alt="SIMD Within a Register: How I Doubled Hash Table Lookup Performance hero image" loading="lazy" class="hero-image hero-background-image svelte-18l6c9h" width="1536" height="1024" onload="this.__e=event" onerror="this.__e=event"></picture><!--]--><!--]--> <div class="hero-content svelte-18l6c9h"><hgroup class="svelte-18l6c9h"><div class="post-meta svelte-18l6c9h"><time datetime="2024-06-15" class="publish-date svelte-18l6c9h">2025-07-15</time> <span class="meta-separator svelte-18l6c9h">‚Ä¢</span> <span class="author-name svelte-18l6c9h">by Aleksey Maltsev</span> <!--[--><span class="meta-separator svelte-18l6c9h">‚Ä¢</span> <span class="views-count svelte-18l6c9h">2,575 views</span><!--]--></div> <h1 class="space-title svelte-18l6c9h">SIMD Within a Register: How I Doubled Hash Table Lookup Performance</h1> <!--[--><p class="post-preview svelte-18l6c9h">It started with a simple thought: four bytes in a hash table bucket look just like an integer. Luckily, this one idea led to a deep dive into bit-twiddling and a 2x performance boost.</p><!--]--></hgroup></div></div><!----> <div class="space-container undefined svelte-7gsxae"><article class="svelte-1dc6gs2"><div class="post-navigation top-navigation svelte-1dc6gs2"><!--[--><a href="/blog" class="button primary medium svelte-1edpa7d"><!---->‚Üê Back to all posts<!----></a><!--]--><!----></div> <!--[!--><!--]--> <div class="prose"><p>While working on a <a href="https://maltsev.space/blog/010-cuckoo-filters" rel="nofollow">Cuckoo Filter</a> implementation in C#, I created an array-like structure for the underlying hash table. I chose an 8-bit fingerprint: it aligns nicely on a byte boundary and still keeps the false-positive rate around <strong>3 %</strong>.</p> <p>The layout looked straightforward‚Äîjust a byte array where the start of each bucket is calculated as <code>bucketIdx * bucketSize</code>. The size of each bucket is 4 slots, which is a solid choice for Cuckoo Filter.</p> <div class="scrollbox svelte-yiz1i3"><svg xmlns="http://www.w3.org/2000/svg" width="648" height="80" class="svgbob"><style>.svgbob line, .svgbob path, .svgbob circle, .svgbob rect, .svgbob polygon {
  stroke: black;
  stroke-width: 2;
  stroke-opacity: 1;
  fill-opacity: 1;
  stroke-linecap: round;
  stroke-linejoin: miter;
}

.svgbob text {
  white-space: pre;
  fill: black;
  font-family: Iosevka Fixed, monospace;
  font-size: 14px;
}

.svgbob rect.backdrop {
  stroke: none;
  fill: transparent;
}

.svgbob .broken {
  stroke-dasharray: 8;
}

.svgbob .filled {
  fill: black;
}

.svgbob .bg_filled {
  fill: transparent;
  stroke-width: 1;
}

.svgbob .nofill {
  fill: transparent;
}

.svgbob .end_marked_arrow {
  marker-end: url(#arrow);
}

.svgbob .start_marked_arrow {
  marker-start: url(#arrow);
}

.svgbob .end_marked_diamond {
  marker-end: url(#diamond);
}

.svgbob .start_marked_diamond {
  marker-start: url(#diamond);
}

.svgbob .end_marked_circle {
  marker-end: url(#circle);
}

.svgbob .start_marked_circle {
  marker-start: url(#circle);
}

.svgbob .end_marked_open_circle {
  marker-end: url(#open_circle);
}

.svgbob .start_marked_open_circle {
  marker-start: url(#open_circle);
}

.svgbob .end_marked_big_open_circle {
  marker-end: url(#big_open_circle);
}

.svgbob .start_marked_big_open_circle {
  marker-start: url(#big_open_circle);
}

</style><defs><marker id="arrow" viewBox="-2 -2 8 8" refX="4" refY="2" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><polygon points="0,0 0,4 4,2 0,0"></polygon></marker><marker id="diamond" viewBox="-2 -2 8 8" refX="4" refY="2" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><polygon points="0,2 2,0 4,2 2,4 0,2"></polygon></marker><marker id="circle" viewBox="0 0 8 8" refX="4" refY="4" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><circle cx="4" cy="4" r="2" class="filled"></circle></marker><marker id="open_circle" viewBox="0 0 8 8" refX="4" refY="4" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><circle cx="4" cy="4" r="2" class="bg_filled"></circle></marker><marker id="big_open_circle" viewBox="0 0 8 8" refX="4" refY="4" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><circle cx="4" cy="4" r="3" class="bg_filled"></circle></marker></defs><rect class="backdrop" x="0" y="0" width="648" height="80"></rect><text x="114" y="12">Bucket</text><text x="170" y="12">0</text><text x="74" y="44">3A</text><text x="114" y="44">00</text><text x="154" y="44">B7</text><text x="194" y="44">F2</text><text x="290" y="12">Bucket</text><text x="346" y="12">1</text><text x="250" y="44">4C</text><text x="290" y="44">91</text><text x="330" y="44">00</text><text x="370" y="44">DE</text><text x="530" y="12">Bucket</text><text x="586" y="12">n</text><text x="490" y="44">AA</text><text x="530" y="44">00</text><text x="570" y="44">5F</text><text x="610" y="44">C8</text><text x="2" y="44">Table:</text><text x="426" y="44">...</text><g><line x1="60" y1="24" x2="220" y2="24" class="solid"></line><line x1="60" y1="24" x2="60" y2="56" class="solid"></line><line x1="100" y1="24" x2="100" y2="56" class="solid"></line><line x1="140" y1="24" x2="140" y2="56" class="solid"></line><line x1="180" y1="24" x2="180" y2="56" class="solid"></line><line x1="220" y1="24" x2="220" y2="56" class="solid"></line><line x1="60" y1="56" x2="220" y2="56" class="solid"></line></g><g><line x1="236" y1="24" x2="396" y2="24" class="solid"></line><line x1="236" y1="24" x2="236" y2="56" class="solid"></line><line x1="276" y1="24" x2="276" y2="56" class="solid"></line><line x1="316" y1="24" x2="316" y2="56" class="solid"></line><line x1="356" y1="24" x2="356" y2="56" class="solid"></line><line x1="396" y1="24" x2="396" y2="56" class="solid"></line><line x1="236" y1="56" x2="396" y2="56" class="solid"></line></g><g><line x1="476" y1="24" x2="636" y2="24" class="solid"></line><line x1="476" y1="24" x2="476" y2="56" class="solid"></line><line x1="516" y1="24" x2="516" y2="56" class="solid"></line><line x1="556" y1="24" x2="556" y2="56" class="solid"></line><line x1="596" y1="24" x2="596" y2="56" class="solid"></line><line x1="636" y1="24" x2="636" y2="56" class="solid"></line><line x1="476" y1="56" x2="636" y2="56" class="solid"></line></g></svg><!----></div><!----> <p>But those four bytes in a bucket reminded me of something. They <em>feel</em> like ‚Ä¶ an integer!</p> <p>I wasn‚Äôt chasing ultra-low latency‚Äîafter all, this is C#‚Äîbut I couldn‚Äôt resist experimenting. Could I speed up lookups in my Cuckoo Filter by replacing the 4-byte bucket with a plain old 32-bit integer?</p> <p>Time to find out. üí™</p> <h2 id="contents"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#contents">#</a>Contents</h2> <ul><li><a href="#a-flexible-and-simple-implementation">A Flexible and Simple Implementation</a></li> <li><a href="#migrating-to-a-uint-table">Migrating to a <code>uint</code> Table</a></li> <li><a href="#finding-a-byte-with-masking">Finding a Byte with Masking</a></li> <li><a href="#xor-to-the-rescue">XOR to the Rescue</a></li> <li><a href="#what-about-existing-zeros">What About Existing Zeros?</a></li> <li><a href="#putting-it-all-together">Putting It All Together</a></li> <li><a href="#final-thoughts">Final Thoughts</a></li></ul> <h2 id="a-flexible-and-simple-implementation"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#a-flexible-and-simple-implementation">#</a>A Flexible and Simple Implementation</h2> <p>Here‚Äôs the na√Øve storage I began with. To keep the rest of the code clean, all table logic lives in its own class, whose heart is a pre-allocated byte array:</p> <!----><pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">private</span><span style="color:#C792EA;--shiki-dark:#F97583"> readonly</span><span style="color:#89DDFF;--shiki-dark:#F97583"> byte</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[]</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> _table</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span></code></pre><!----> <p>Each bucket has 4 slots, so there was no need for a second dimension; mapping a key to its bucket is obvious:</p> <!----><pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> offset</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> bucketIdx </span><span style="color:#89DDFF;--shiki-dark:#F97583">*</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 4</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span></code></pre><!----> <p>Checking whether a particular fingerprint (a single byte) sits in a bucket is just as obvious:</p> <!----><pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#89DDFF;--shiki-dark:#F97583"> bool</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Contains</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">byte</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> fingerprint</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#89DDFF;--shiki-dark:#F97583"> uint</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> bucketIdx</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">    var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> s</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> bucketIdx </span><span style="color:#89DDFF;--shiki-dark:#F97583">*</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 4</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">    for</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> (</span><span style="color:#FFCB6B;--shiki-dark:#F97583">var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> i</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> s</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> i </span><span style="color:#89DDFF;--shiki-dark:#F97583">&#x3C;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> s </span><span style="color:#89DDFF;--shiki-dark:#F97583">+</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> BucketSize</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> i</span><span style="color:#89DDFF;--shiki-dark:#F97583">++</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">        if</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> (</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">_table</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">i</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">]</span><span style="color:#89DDFF;--shiki-dark:#F97583"> ==</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> fingerprint</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit"> return</span><span style="color:#FF9CAC;--shiki-dark:#79B8FF"> true</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">    return</span><span style="color:#FF9CAC;--shiki-dark:#79B8FF"> false</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre><!----> <p>(Please ignore the missing bounds checks‚Äîthey‚Äôre not the point today.)</p> <p>I‚Äôm no bit-twiddling wizard‚ÄîI live in a cosy, GC-collected world‚Äîbut those 4 bytes kept itching. A bucket lines up <em>perfectly</em> with a 32-bit <code>uint</code>; that opens the door to a future lock-free <a href="https://en.wikipedia.org/wiki/Compare-and-swap" rel="nofollow">compare-and-swap</a>. So I decided to play.</p> <h2 id="migrating-to-a-uint-table"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#migrating-to-a-uint-table">#</a>Migrating to a <code>uint</code> Table</h2> <p>Switching the backing array is trivial because the hash table is still one-dimensional:</p> <!----><pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#89DDFF;--shiki-dark:#FDAEB7">-</span><span style="color:#F07178;--shiki-dark:#FDAEB7"> private readonly byte[] _table;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#85E89D">+</span><span style="color:#C3E88D;--shiki-dark:#85E89D"> private readonly uint[] _table;</span></span></code></pre><!----> <p>Now let‚Äôs refactor the lookup:</p> <!----><pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">public bool Contains(byte fingerprint, uint bucketIdx)</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#FDAEB7">-</span><span style="color:#F07178;--shiki-dark:#FDAEB7">   var s = bucketIdx * 4;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#85E89D">+</span><span style="color:#C3E88D;--shiki-dark:#85E89D">   var bucket = _table[bucketIdx];</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#FDAEB7">-</span><span style="color:#F07178;--shiki-dark:#FDAEB7">   for (var i = s; i &#x3C; s + BucketSize; i++)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#85E89D">+</span><span style="color:#C3E88D;--shiki-dark:#85E89D">   for (var i = 0; i &#x3C; BucketSize; i++)</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#FDAEB7">-</span><span style="color:#F07178;--shiki-dark:#FDAEB7">       if (_table[i] == fingerprint) return true;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#85E89D">+</span><span style="color:#C3E88D;--shiki-dark:#85E89D">       var shift = i * 8;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#85E89D">+</span><span style="color:#C3E88D;--shiki-dark:#85E89D">       var fp = (byte)(bucket >> shift);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#85E89D">+</span><span style="color:#C3E88D;--shiki-dark:#85E89D">       if (fp == fingerprint) return true;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    return false;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre><!----> <p>The bucket offset disappears because each <code>uint</code> is a bucket. But I‚Äôve lost the luxury of direct indexing‚Äîunless I convert the integer to bytes first:</p> <!----><pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">  Span</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#89DDFF;--shiki-dark:#F97583">byte</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> bucketBytes</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#89DDFF;--shiki-dark:#F97583"> stackalloc</span><span style="color:#89DDFF;--shiki-dark:#F97583"> byte</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[</span><span style="color:#89DDFF;--shiki-dark:#F97583">sizeof</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">uint</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)];</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">  BitConverter</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">TryWriteBytes</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">bucketBytes</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> _table</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">bucketIdx</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">  for</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> (</span><span style="color:#FFCB6B;--shiki-dark:#F97583">var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> i</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 0</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> i </span><span style="color:#89DDFF;--shiki-dark:#F97583">&#x3C;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> BucketSize</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> i</span><span style="color:#89DDFF;--shiki-dark:#F97583">++</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">  &#123;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">      var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> fp</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> bucketBytes</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">i</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">];</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">      if</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> (</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">fp </span><span style="color:#89DDFF;--shiki-dark:#F97583">==</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> fingerprint</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit"> return</span><span style="color:#FF9CAC;--shiki-dark:#79B8FF"> true</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">  &#125;</span></span></code></pre><!----> <p>I ran a quick benchmark on both <code>uint</code>-based lookups, and the results were revealing. The shifting version gave a nice speed boost, about <strong>35%</strong> faster than the original byte-array loop. I‚Äôve also tested the unrolled loop, but it showed no significant improvement because the compiler has already unrolled it.</p> <div class="scrollbox svelte-yiz1i3"><table><thead><tr><th>Method</th><th>Operations</th><th align="right">Mean</th><th align="right">Ratio</th></tr></thead><tbody><tr><td><strong>ByteTable_PositiveLookups</strong></td><td><strong>128</strong></td><td align="right"><strong>239.9 ns</strong></td><td align="right"><strong>1.00</strong></td></tr><tr><td>IntTable_PositiveLookups</td><td>128</td><td align="right">166.9 ns</td><td align="right">0.70</td></tr><tr><td>ByteTable_NegativeLookups</td><td>128</td><td align="right">321.9 ns</td><td align="right">1.34</td></tr><tr><td>IntTable_NegativeLookups</td><td>128</td><td align="right">203.9 ns</td><td align="right">0.85</td></tr><tr><td></td><td></td><td align="right"></td><td align="right"></td></tr><tr><td><strong>ByteTable_PositiveLookups</strong></td><td><strong>1024</strong></td><td align="right"><strong>1,847.0 ns</strong></td><td align="right"><strong>1.00</strong></td></tr><tr><td>IntTable_PositiveLookups</td><td>1024</td><td align="right">1,300.9 ns</td><td align="right">0.70</td></tr><tr><td>ByteTable_NegativeLookups</td><td>1024</td><td align="right">2,523.7 ns</td><td align="right">1.37</td></tr><tr><td>IntTable_NegativeLookups</td><td>1024</td><td align="right">1,597.2 ns</td><td align="right">0.86</td></tr><tr><td></td><td></td><td align="right"></td><td align="right"></td></tr><tr><td><strong>ByteTable_PositiveLookups</strong></td><td><strong>1048576</strong></td><td align="right"><strong>1,907,503.2 ns</strong></td><td align="right"><strong>1.00</strong></td></tr><tr><td>IntTable_PositiveLookups</td><td>1048576</td><td align="right">1,762,474.3 ns</td><td align="right">0.92</td></tr><tr><td>ByteTable_NegativeLookups</td><td>1048576</td><td align="right">2,575,301.5 ns</td><td align="right">1.35</td></tr><tr><td>IntTable_NegativeLookups</td><td>1048576</td><td align="right">1,637,653.6 ns</td><td align="right">0.86</td></tr></tbody></table><!----></div><!----> <p>The <code>BitConverter</code> approach, however, was a step backward. It was even slower than the original, likely due to the additional <code>Span</code> overhead. I‚Äôm not about to introduce complexity for negative gain, so the <code>BitConverter</code> version was a non-starter.</p> <div class="scrollbox svelte-yiz1i3"><table><thead><tr><th>Method</th><th>Operations</th><th align="right">Mean</th><th align="right">Ratio</th></tr></thead><tbody><tr><td><strong>ByteTable_PositiveLookups</strong></td><td><strong>128</strong></td><td align="right"><strong>239.7 ns</strong></td><td align="right"><strong>1.00</strong></td></tr><tr><td>IntTable_PositiveLookups</td><td>128</td><td align="right">366.8 ns</td><td align="right">1.53</td></tr><tr><td>ByteTable_NegativeLookups</td><td>128</td><td align="right">322.6 ns</td><td align="right">1.35</td></tr><tr><td>IntTable_NegativeLookups</td><td>128</td><td align="right">429.2 ns</td><td align="right">1.79</td></tr><tr><td></td><td></td><td align="right"></td><td align="right"></td></tr><tr><td><strong>ByteTable_PositiveLookups</strong></td><td><strong>1024</strong></td><td align="right"><strong>1,850.0 ns</strong></td><td align="right"><strong>1.00</strong></td></tr><tr><td>IntTable_PositiveLookups</td><td>1024</td><td align="right">2,877.2 ns</td><td align="right">1.56</td></tr><tr><td>ByteTable_NegativeLookups</td><td>1024</td><td align="right">2,512.9 ns</td><td align="right">1.36</td></tr><tr><td>IntTable_NegativeLookups</td><td>1024</td><td align="right">3,396.8 ns</td><td align="right">1.84</td></tr><tr><td></td><td></td><td align="right"></td><td align="right"></td></tr><tr><td><strong>ByteTable_PositiveLookups</strong></td><td><strong>1048576</strong></td><td align="right"><strong>1,909,607.9 ns</strong></td><td align="right"><strong>1.00</strong></td></tr><tr><td>IntTable_PositiveLookups</td><td>1048576</td><td align="right">3,352,454.1 ns</td><td align="right">1.76</td></tr><tr><td>ByteTable_NegativeLookups</td><td>1048576</td><td align="right">2,566,696.5 ns</td><td align="right">1.34</td></tr><tr><td>IntTable_NegativeLookups</td><td>1048576</td><td align="right">3,536,050.6 ns</td><td align="right">1.85</td></tr></tbody></table><!----></div><!----> <div class="callout" data-callout="question" data-collapsible="false"><div class="callout-title"><div class="callout-title-icon" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg></div><div class="callout-title-text">So what‚Äôs next?</div></div><div class="callout-content"><p>Even the shifting version is quite performant, can we do better? Maybe just eliminate the loop entirely?</p></div></div> <h2 id="finding-a-byte-with-masking"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#finding-a-byte-with-masking">#</a>Finding a Byte with Masking</h2> <p>Long ago I bookmarked Sean Anderson‚Äôs great <em><a href="https://graphics.stanford.edu/%7Eseander/bithacks.html" rel="nofollow">Bit Twiddling Hacks</a></em>. One gem there‚Äî<em>Determine if a word has a zero byte</em>‚Äîis exactly what I need. The C# version is nearly identical:</p> <!----><pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">private</span><span style="color:#C792EA;--shiki-dark:#F97583"> static</span><span style="color:#89DDFF;--shiki-dark:#F97583"> bool</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> HasZero</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">uint</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> v</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">    return</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> ((</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">v </span><span style="color:#89DDFF;--shiki-dark:#F97583">-</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 0x01010101U</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span><span style="color:#89DDFF;--shiki-dark:#F97583"> &#x26;</span><span style="color:#89DDFF;--shiki-dark:#F97583"> ~</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">v </span><span style="color:#89DDFF;--shiki-dark:#F97583">&#x26;</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 0x80808080U</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span><span style="color:#89DDFF;--shiki-dark:#F97583"> !=</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 0</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre><!----> <p>Admittedly opaque, so let‚Äôs unpack it.</p> <p>The core of the trick is¬†<code>(v - 0x01010101U) &amp; ~v</code>. This expression has a special property:</p> <ul><li><strong>For any non-zero byte¬†b</strong>, the most significant bit of¬†<code>(b - 1) &amp; ~b</code>¬†will always be¬†<code>0</code>.</li> <li><strong>For a zero-byte¬†b = 0x00</strong>, the expression becomes¬†<code>(0x00 - 1) &amp; ~0x00</code>, which is¬†<code>0xFF &amp; 0xFF = 0xFF</code>. The most significant bit is¬†<code>1</code>.</li></ul> <p>So, this operation creates a ‚Äúmarker‚Äù bit (it sets the most significant bit to <code>1</code>) in any byte position that was originally <code>0x00</code>.</p> <p>Let‚Äôs apply it to our¬†<code>v</code>, e.g.,¬†<code>0x4462002E</code>:</p> <p>First, we subtract <code>0x01010101U</code>.</p> <div class="math math-display"><!----><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnalign="right" columnspacing="1em" rowlines="none solid"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mrow><mtext mathvariant="monospace">01000100</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">01100010</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">00000000</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">00101110</mtext></mrow><mtext>‚ÄÖ‚Ää</mtext><mo stretchy="false">(</mo><mtext mathvariant="monospace">0x4462002E</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>‚àí</mo><mtext>‚ÄÖ‚Ää</mtext><mrow><mtext mathvariant="monospace">00000001</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">00000001</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">00000001</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">00000001</mtext></mrow><mtext>‚ÄÖ‚Ää</mtext><mo stretchy="false">(</mo><mtext mathvariant="monospace">0x01010101</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mrow><mtext mathvariant="monospace">01000011</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">01100000</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">11111111</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">00101101</mtext></mrow><mtext>‚ÄÖ‚Ää</mtext><mo stretchy="false">(</mo><mtext mathvariant="monospace">0x4360FF2D</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{r}
\texttt{01000100\;01100010\;00000000\;00101110}\;(\texttt{0x4462002E}) \\[-2pt]
-\;
\texttt{00000001\;00000001\;00000001\;00000001}\;(\texttt{0x01010101}) \\ \hline
\texttt{01000011\;01100000\;11111111\;00101101}\;(\texttt{0x4360FF2D})
\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.4em;vertical-align:-1.45em;"></span><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.95em;"><span style="top:-3.95em;"><span class="pstrut" style="height:3.95em;"></span><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.95em;"><span style="top:-4.11em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord texttt">01000100</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">01100010</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">00000000</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">00101110</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord texttt">0x4462002E</span></span><span class="mclose">)</span></span></span><span style="top:-3.11em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">‚àí</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord texttt">00000001</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">00000001</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">00000001</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">00000001</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord texttt">0x01010101</span></span><span class="mclose">)</span></span></span><span style="top:-1.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord texttt">01000011</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">01100000</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">11111111</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">00101101</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord texttt">0x4360FF2D</span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span><span style="top:-3.7em;"><span class="pstrut" style="height:3.95em;"></span><span class="hline" style="border-bottom-width:0.04em;"></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span></span></span></span></span></span></span></span></span></span><!----></div> <div class="callout" data-callout="note" data-collapsible="false"><div class="callout-title"><div class="callout-title-icon" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="2" x2="22" y2="6"></line><path d="M7.5 20.5 19 9l-4-4L3.5 16.5 2 22z"></path></svg></div><div class="callout-title-text">Note</div></div><div class="callout-content"><p>Note that this is a single 32-bit subtraction, so borrows can cross byte boundaries. The <code>0x00</code> byte borrows from <code>0x62</code>, resulting in <code>0x...60FF...</code>.</p></div></div> <p>Second, we apply a bitwise NOT to the original value:</p> <div class="math math-display"><!----><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnalign="right" columnspacing="1em" rowlines="solid"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi mathvariant="normal">¬¨</mi><mtext>‚ÄÖ‚Ää</mtext><mrow><mtext mathvariant="monospace">01000100</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">01100010</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">00000000</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">00101110</mtext></mrow><mtext>‚ÄÖ‚Ää</mtext><mo stretchy="false">(</mo><mtext mathvariant="monospace">0x4462002E</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mrow><mtext mathvariant="monospace">10111011</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">10011101</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">11111111</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">11010001</mtext></mrow><mtext>‚ÄÖ‚Ää</mtext><mo stretchy="false">(</mo><mtext mathvariant="monospace">0xBB9DFFD1</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{r}
\neg\;
\texttt{01000100\;01100010\;00000000\;00101110}\;(\texttt{0x4462002E}) \\ \hline
\texttt{10111011\;10011101\;11111111\;11010001}\;(\texttt{0xBB9DFFD1})
\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.45em;"><span class="pstrut" style="height:3.45em;"></span><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">¬¨</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord texttt">01000100</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">01100010</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">00000000</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">00101110</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord texttt">0x4462002E</span></span><span class="mclose">)</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord texttt">10111011</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">10011101</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">11111111</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">11010001</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord texttt">0xBB9DFFD1</span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span><span style="top:-3.7em;"><span class="pstrut" style="height:3.45em;"></span><span class="hline" style="border-bottom-width:0.04em;"></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span></span></span><!----></div> <p>Now,¬†<code>&amp;</code>¬†them together:</p> <div class="math math-display"><!----><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnalign="right" columnspacing="1em" rowlines="none solid"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mrow><mtext mathvariant="monospace">01000011</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">01100000</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">11111111</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">00101101</mtext></mrow><mtext>‚ÄÖ‚Ää</mtext><mo stretchy="false">(</mo><mtext mathvariant="monospace">0x4360FF2D</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo mathvariant="normal" lspace="0.22em" rspace="0.22em">&amp;</mo><mtext>‚ÄÖ‚Ää</mtext><mrow><mtext mathvariant="monospace">10111011</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">10011101</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">11111111</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">11010001</mtext></mrow><mtext>‚ÄÖ‚Ää</mtext><mo stretchy="false">(</mo><mtext mathvariant="monospace">0xBB9DFFD1</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mrow><mtext mathvariant="monospace">00000011</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">00000000</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">11111111</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">00000001</mtext></mrow><mtext>‚ÄÖ‚Ää</mtext><mo stretchy="false">(</mo><mtext mathvariant="monospace">0x0300FF01</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{r}
\texttt{01000011\;01100000\;11111111\;00101101}\;(\texttt{0x4360FF2D}) \\[-2pt]
\mathbin{\&amp;}\;
\texttt{10111011\;10011101\;11111111\;11010001}\;(\texttt{0xBB9DFFD1}) \\ \hline
\texttt{00000011\;00000000\;11111111\;00000001}\;(\texttt{0x0300FF01})
\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.4em;vertical-align:-1.45em;"></span><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.95em;"><span style="top:-3.95em;"><span class="pstrut" style="height:3.95em;"></span><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.95em;"><span style="top:-4.11em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord texttt">01000011</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">01100000</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">11111111</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">00101101</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord texttt">0x4360FF2D</span></span><span class="mclose">)</span></span></span><span style="top:-3.11em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">&amp;</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord texttt">10111011</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">10011101</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">11111111</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">11010001</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord texttt">0xBB9DFFD1</span></span><span class="mclose">)</span></span></span><span style="top:-1.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord texttt">00000011</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">00000000</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">11111111</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">00000001</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord texttt">0x0300FF01</span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span><span style="top:-3.7em;"><span class="pstrut" style="height:3.95em;"></span><span class="hline" style="border-bottom-width:0.04em;"></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span></span></span></span></span></span></span></span></span></span><!----></div> <p>Notice that the third byte from the left is¬†<code>0xFF</code>. Its most significant bit is¬†<code>1</code>, indicating that this was our zero-byte position.</p> <p>The final <code>&amp; 0x80808080U</code> is a mask that removes all other bits, leaving only the most significant bit of each byte.</p> <div class="math math-display"><!----><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnalign="right" columnspacing="1em" rowlines="none solid"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mrow><mtext mathvariant="monospace">00000011</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">00000000</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">11111111</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">00000001</mtext></mrow><mtext>‚ÄÖ‚Ää</mtext><mo stretchy="false">(</mo><mtext mathvariant="monospace">0x0300FF01</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo mathvariant="normal" lspace="0.22em" rspace="0.22em">&amp;</mo><mtext>‚ÄÖ‚Ää</mtext><mrow><mtext mathvariant="monospace">10000000</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">10000000</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">10000000</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">10000000</mtext></mrow><mtext>‚ÄÖ‚Ää</mtext><mo stretchy="false">(</mo><mtext mathvariant="monospace">0x80808080</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mrow><mtext mathvariant="monospace">00000000</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">00000000</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">10000000</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">00000000</mtext></mrow><mtext>‚ÄÖ‚Ää</mtext><mo stretchy="false">(</mo><mtext mathvariant="monospace">0x00008000</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{r}
\texttt{00000011\;00000000\;11111111\;00000001}\;(\texttt{0x0300FF01}) \\[-2pt]
\mathbin{\&amp;}\;
\texttt{10000000\;10000000\;10000000\;10000000}\;(\texttt{0x80808080}) \\ \hline
\texttt{00000000\;00000000\;10000000\;00000000}\;(\texttt{0x00008000})
\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.4em;vertical-align:-1.45em;"></span><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.95em;"><span style="top:-3.95em;"><span class="pstrut" style="height:3.95em;"></span><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.95em;"><span style="top:-4.11em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord texttt">00000011</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">00000000</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">11111111</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">00000001</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord texttt">0x0300FF01</span></span><span class="mclose">)</span></span></span><span style="top:-3.11em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">&amp;</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord texttt">10000000</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">10000000</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">10000000</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">10000000</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord texttt">0x80808080</span></span><span class="mclose">)</span></span></span><span style="top:-1.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord texttt">00000000</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">00000000</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">10000000</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">00000000</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord texttt">0x00008000</span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span><span style="top:-3.7em;"><span class="pstrut" style="height:3.95em;"></span><span class="hline" style="border-bottom-width:0.04em;"></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span></span></span></span></span></span></span></span></span></span><!----></div> <p>The method returns the result of <code>0x00008000 != 0</code>. Since <code>0x8000</code> is not zero, the expression is <code>true</code>, and the method correctly reports that the zero byte was found.</p> <p>Great, now I can detect a zero byte without branches. All that remains is to <em>turn the byte I‚Äôm searching for into zero</em>.</p> <h2 id="xor-to-the-rescue"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#xor-to-the-rescue">#</a>XOR to the Rescue</h2> <p>Let‚Äôs assume our integer, aka bucket, is <code>0x12345678</code> and I‚Äôm looking for byte <code>0x56</code>. Without shifts, this seems tough. Luckily, all we need to do is transform the <code>0x56</code> byte to <code>0x00</code>.</p> <div class="callout" data-callout="note" data-collapsible="false"><div class="callout-title"><div class="callout-title-icon" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="2" x2="22" y2="6"></line><path d="M7.5 20.5 19 9l-4-4L3.5 16.5 2 22z"></path></svg></div><div class="callout-title-text">Note</div></div><div class="callout-content"><p>What happens to the other bytes is irrelevant, because our <code>HasZero</code> trick only cares if <em>any</em> byte is zero.</p></div></div> <p>The XOR (<code>^</code>) operator has a useful property: <code>A ^ B = 0</code> if and only if <code>A == B</code>. So, if we XOR the entire bucket with a repeating mask of our target byte, only the matching byte will become zero.</p> <div class="math math-display"><!----><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnalign="right" columnspacing="1em" rowlines="none solid"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mrow><mtext mathvariant="monospace">00010010</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">00110100</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">01010110</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">01111000</mtext></mrow><mtext>‚ÄÖ‚Ää</mtext><mo stretchy="false">(</mo><mtext mathvariant="monospace">0x12345678</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>‚äï</mo><mtext>‚ÄÖ‚Ää</mtext><mrow><mtext mathvariant="monospace">01010110</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">01010110</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">01010110</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">01010110</mtext></mrow><mtext>‚ÄÖ‚Ää</mtext><mo stretchy="false">(</mo><mtext mathvariant="monospace">0x56565656</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mrow><mtext mathvariant="monospace">01000100</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">01100010</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">00000000</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">00101110</mtext></mrow><mtext>‚ÄÖ‚Ää</mtext><mo stretchy="false">(</mo><mtext mathvariant="monospace">0x4462002E</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{r}
\texttt{00010010\;00110100\;01010110\;01111000}\;(\texttt{0x12345678}) \\[-2pt]
\oplus\;
\texttt{01010110\;01010110\;01010110\;01010110}\;(\texttt{0x56565656}) \\ \hline
\texttt{01000100\;01100010\;00000000\;00101110}\;(\texttt{0x4462002E})
\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.4em;vertical-align:-1.45em;"></span><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.95em;"><span style="top:-3.95em;"><span class="pstrut" style="height:3.95em;"></span><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.95em;"><span style="top:-4.11em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord texttt">00010010</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">00110100</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">01010110</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">01111000</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord texttt">0x12345678</span></span><span class="mclose">)</span></span></span><span style="top:-3.11em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">‚äï</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord texttt">01010110</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">01010110</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">01010110</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">01010110</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord texttt">0x56565656</span></span><span class="mclose">)</span></span></span><span style="top:-1.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord texttt">01000100</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">01100010</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">00000000</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">00101110</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord texttt">0x4462002E</span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span><span style="top:-3.7em;"><span class="pstrut" style="height:3.95em;"></span><span class="hline" style="border-bottom-width:0.04em;"></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span></span></span></span></span></span></span></span></span></span><!----></div> <p>So the remaining part of this puzzle is to make a repetitive mask, which is pretty arithmetic: I should multiply target byte by <code>0x01010101U</code>:</p> <div class="math math-display"><!----><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>mask</mtext><mtext>‚ÄÖ‚Ää</mtext><mo>=</mo><mtext>‚ÄÖ‚Ää</mtext><mtext>0x56</mtext><mo>√ó</mo><mtext>0x01010101</mtext><mtext>‚ÄÖ‚Ää</mtext><mo>=</mo><mtext>‚ÄÖ‚Ää</mtext><mtext>0x56565656</mtext></mrow><annotation encoding="application/x-tex">\text{mask} \;=\; \text{0x56} \times \text{0x01010101} \;=\; \text{0x56565656}

</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord text"><span class="mord">mask</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord text"><span class="mord">0x56</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord text"><span class="mord">0x01010101</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord text"><span class="mord">0x56565656</span></span></span></span></span></span><!----></div> <h2 id="what-about-existing-zeros"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#what-about-existing-zeros">#</a>What About Existing Zeros?</h2> <p>A careful reader might ask: what happens if the bucket <em>already</em> has a zero byte in it? Does that mess up the logic?</p> <p>Let‚Äôs say our bucket is <code>0xAA00CCDD</code> and we‚Äôre searching for a non-zero fingerprint like <code>0xBB</code>. The XOR operation transforms the original zero into a non-zero value, so <code>HasZero</code> correctly returns <code>false</code>.</p> <div class="math math-display"><!----><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnalign="right" columnspacing="1em" rowlines="none solid"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mrow><mtext mathvariant="monospace">10101010</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">00000000</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">11001100</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">11011101</mtext></mrow><mtext>‚ÄÖ‚Ää</mtext><mo stretchy="false">(</mo><mtext mathvariant="monospace">0xAA00CCDD</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>‚äï</mo><mtext>‚ÄÖ‚Ää</mtext><mrow><mtext mathvariant="monospace">10111011</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">10111011</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">10111011</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">10111011</mtext></mrow><mtext>‚ÄÖ‚Ää</mtext><mo stretchy="false">(</mo><mtext mathvariant="monospace">0xBBBBBBBB</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mrow><mtext mathvariant="monospace">00010001</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">10111011</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">01110111</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">01100110</mtext></mrow><mtext>‚ÄÖ‚Ää</mtext><mo stretchy="false">(</mo><mtext mathvariant="monospace">0x11BB7766</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{r}
\texttt{10101010\;00000000\;11001100\;11011101}\;(\texttt{0xAA00CCDD}) \\[-2pt]
\oplus\;
\texttt{10111011\;10111011\;10111011\;10111011}\;(\texttt{0xBBBBBBBB}) \\ \hline
\texttt{00010001\;10111011\;01110111\;01100110}\;(\texttt{0x11BB7766})
\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.4em;vertical-align:-1.45em;"></span><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.95em;"><span style="top:-3.95em;"><span class="pstrut" style="height:3.95em;"></span><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.95em;"><span style="top:-4.11em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord texttt">10101010</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">00000000</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">11001100</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">11011101</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord texttt">0xAA00CCDD</span></span><span class="mclose">)</span></span></span><span style="top:-3.11em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">‚äï</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord texttt">10111011</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">10111011</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">10111011</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">10111011</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord texttt">0xBBBBBBBB</span></span><span class="mclose">)</span></span></span><span style="top:-1.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord texttt">00010001</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">10111011</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">01110111</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">01100110</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord texttt">0x11BB7766</span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span><span style="top:-3.7em;"><span class="pstrut" style="height:3.95em;"></span><span class="hline" style="border-bottom-width:0.04em;"></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span></span></span></span></span></span></span></span></span></span><!----></div> <p>Now, what if we search for <code>0x00</code> itself (an empty slot in my case)? The mask is <code>0x00000000</code>, so the XOR leaves the bucket unchanged. <code>HasZero</code> is then applied to the result, which correctly finds the pre-existing zero and returns <code>true</code>.</p> <div class="math math-display"><!----><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnalign="right" columnspacing="1em" rowlines="none solid"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mrow><mtext mathvariant="monospace">10101010</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">00000000</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">11001100</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">11011101</mtext></mrow><mtext>‚ÄÖ‚Ää</mtext><mo stretchy="false">(</mo><mtext mathvariant="monospace">0xAA00CCDD</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>‚äï</mo><mtext>‚ÄÖ‚Ää</mtext><mrow><mtext mathvariant="monospace">00000000</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">00000000</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">00000000</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">00000000</mtext></mrow><mtext>‚ÄÖ‚Ää</mtext><mo stretchy="false">(</mo><mtext mathvariant="monospace">0x00000000</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mrow><mtext mathvariant="monospace">10101010</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">00000000</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">11001100</mtext><mtext>‚ÄÖ‚Ää</mtext><mtext mathvariant="monospace">11011101</mtext></mrow><mtext>‚ÄÖ‚Ää</mtext><mo stretchy="false">(</mo><mtext mathvariant="monospace">0xAA00CCDD</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{r}
\texttt{10101010\;00000000\;11001100\;11011101}\;(\texttt{0xAA00CCDD}) \\[-2pt]
\oplus\;
\texttt{00000000\;00000000\;00000000\;00000000}\;(\texttt{0x00000000}) \\ \hline
\texttt{10101010\;00000000\;11001100\;11011101}\;(\texttt{0xAA00CCDD})
\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.4em;vertical-align:-1.45em;"></span><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.95em;"><span style="top:-3.95em;"><span class="pstrut" style="height:3.95em;"></span><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.95em;"><span style="top:-4.11em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord texttt">10101010</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">00000000</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">11001100</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">11011101</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord texttt">0xAA00CCDD</span></span><span class="mclose">)</span></span></span><span style="top:-3.11em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">‚äï</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord texttt">00000000</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">00000000</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">00000000</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">00000000</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord texttt">0x00000000</span></span><span class="mclose">)</span></span></span><span style="top:-1.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord texttt">10101010</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">00000000</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">11001100</span><span class="mspace" style="margin-right:0.2777em;"></span><span class="mord texttt">11011101</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord texttt">0xAA00CCDD</span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span><span style="top:-3.7em;"><span class="pstrut" style="height:3.95em;"></span><span class="hline" style="border-bottom-width:0.04em;"></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span></span></span></span></span></span></span></span></span></span><!----></div> <p>So no, nothing breaks, the algorithm is still robust: <code>HasZero</code> only gives a positive result if a zero byte exists after the XOR, which only happens if our target fingerprint was in the bucket to begin with.</p> <h2 id="putting-it-all-together"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#putting-it-all-together">#</a>Putting It All Together</h2> <p>Here‚Äôs the final, branch-free lookup:</p> <!----><pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#89DDFF;--shiki-dark:#F97583"> bool</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Contains</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">byte</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> fingerprint</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#89DDFF;--shiki-dark:#F97583"> uint</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> bucketIdx</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#F97583">    uint</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> bucket</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> _table</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">bucketIdx</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">];</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#F97583">    uint</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> mask</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> fingerprint </span><span style="color:#89DDFF;--shiki-dark:#F97583">*</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 0x01010101U</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#F97583">    uint</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> xored</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> bucket </span><span style="color:#89DDFF;--shiki-dark:#F97583">^</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> mask</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">    return</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> ((</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">xored </span><span style="color:#89DDFF;--shiki-dark:#F97583">-</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 0x01010101U</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span><span style="color:#89DDFF;--shiki-dark:#F97583"> &#x26;</span><span style="color:#89DDFF;--shiki-dark:#F97583"> ~</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">xored </span><span style="color:#89DDFF;--shiki-dark:#F97583">&#x26;</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 0x80808080U</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span><span style="color:#89DDFF;--shiki-dark:#F97583"> !=</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 0</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre><!----> <p>We XOR to zero-out matching bytes, then use the bit-twiddling trick to see if any byte is zero.</p> <p>The benchmarks confirmed this bit-twiddling exercise was well worth the effort. Positive lookups became over <strong>60% faster</strong>, while negative lookups became <strong>more than twice as fast</strong> compared to the original byte-array implementation. It‚Äôs a significant leap over the shifting version, too. While readability certainly took a hit, the raw performance gain is a trade-off I‚Äôm ok with.</p> <div class="scrollbox svelte-yiz1i3"><table><thead><tr><th>Method</th><th>Operations</th><th align="right">Mean</th><th align="right">Ratio</th></tr></thead><tbody><tr><td><strong>ByteTable_PositiveLookups</strong></td><td><strong>128</strong></td><td align="right"><strong>245.2 ns</strong></td><td align="right"><strong>1.00</strong></td></tr><tr><td>IntTable_PositiveLookups</td><td>128</td><td align="right">147.7 ns</td><td align="right">0.60</td></tr><tr><td>ByteTable_NegativeLookups</td><td>128</td><td align="right">324.1 ns</td><td align="right">1.32</td></tr><tr><td>IntTable_NegativeLookups</td><td>128</td><td align="right">147.1 ns</td><td align="right">0.60</td></tr><tr><td></td><td></td><td align="right"></td><td align="right"></td></tr><tr><td><strong>ByteTable_PositiveLookups</strong></td><td><strong>1024</strong></td><td align="right"><strong>1,845.6 ns</strong></td><td align="right"><strong>1.00</strong></td></tr><tr><td>IntTable_PositiveLookups</td><td>1024</td><td align="right">1,139.4 ns</td><td align="right">0.62</td></tr><tr><td>ByteTable_NegativeLookups</td><td>1024</td><td align="right">2,561.2 ns</td><td align="right">1.39</td></tr><tr><td>IntTable_NegativeLookups</td><td>1024</td><td align="right">1,136.3 ns</td><td align="right">0.62</td></tr><tr><td></td><td></td><td align="right"></td><td align="right"></td></tr><tr><td><strong>ByteTable_PositiveLookups</strong></td><td><strong>1048576</strong></td><td align="right"><strong>1,908,031.9 ns</strong></td><td align="right"><strong>1.00</strong></td></tr><tr><td>IntTable_PositiveLookups</td><td>1048576</td><td align="right">1,170,627.6 ns</td><td align="right">0.61</td></tr><tr><td>ByteTable_NegativeLookups</td><td>1048576</td><td align="right">2,574,882.8 ns</td><td align="right">1.35</td></tr><tr><td>IntTable_NegativeLookups</td><td>1048576</td><td align="right">1,172,802.0 ns</td><td align="right">0.61</td></tr></tbody></table><!----></div><!----> <h2 id="final-thoughts"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#final-thoughts">#</a>Final Thoughts</h2> <p>I‚Äôm still not a huge fan of stuffing dense <a href="https://maltsev.space/blog/011-practical-bitwise-tricks-in-everyday-code" rel="nofollow">bit tricks</a> into production C#‚Äîthey can be hard to read and even harder to maintain if something goes wrong. But I think this little adventure has been worth it: the lookup path is now twice as fast, and the codebase is still compact enough to keep the trick well-commented. I hope these notes save someone else a detour‚Äîor at the very least that you enjoyed this little optimization trip with me.</p><!----></div> <footer class="post-footer svelte-1dc6gs2"><div class="post-navigation svelte-1dc6gs2"><!--[--><a href="/blog" class="button primary medium svelte-1edpa7d"><!---->‚Üê Back to all posts<!----></a><!--]--><!----></div> <!--[!--><!--]--> <div class="card default svelte-1f4837s"><!--[!--><!--]--> <div class="card-content svelte-1f4837s"><div class="share-message svelte-1dc6gs2">Enjoyed this post? Share it with the universe!</div> <div class="share-buttons svelte-1dc6gs2"><a class="link default share-link twitter svelte-blzdii" target="_blank" rel="noopener noreferrer" href="https://twitter.com/intent/tweet?text=SIMD%20Within%20a%20Register%3A%20How%20I%20Doubled%20Hash%20Table%20Lookup%20Performance&amp;url=" aria-label="Share on Twitter"><!---->Twitter<!----> <!--[!--><!--]--></a><!----> <a class="link default share-link linkedin svelte-blzdii" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/shareArticle?mini=true&amp;title=SIMD%20Within%20a%20Register%3A%20How%20I%20Doubled%20Hash%20Table%20Lookup%20Performance&amp;url=" aria-label="Share on LinkedIn"><!---->LinkedIn<!----> <!--[!--><!--]--></a><!----> <a class="link default share-link facebook svelte-blzdii" target="_blank" rel="noopener noreferrer" href="https://www.facebook.com/sharer/sharer.php?u=" aria-label="Share on Facebook"><!---->Facebook<!----> <!--[!--><!--]--></a><!----></div><!----></div> <!--[!--><!--]--></div><!----></footer></article> <!--[--><div class="referenced-posts svelte-1dc6gs2"><h2 class="svelte-1dc6gs2">Want to read more?</h2> <div class="posts-grid svelte-1xu41xx"><!--[--><a href="/blog/011-practical-bitwise-tricks-in-everyday-code" class="content-card-link svelte-1e8k5qp"><div class="card neon clickable content-card svelte-1f4837s"><!--[--><!--[!--><!--]--> <!--[!--><picture class="svelte-1f4837s"><!--[--><source srcset="/_app/immutable/assets/hero.u8BEqUl_.avif 1x, /_app/immutable/assets/hero.LFrqv3X0.avif 2x" sizes="min(800px, 30vw)" type="image/avif" class="svelte-1f4837s"><source srcset="/_app/immutable/assets/hero.CKxIXTle.webp 1x, /_app/immutable/assets/hero.DAVKIi1O.webp 2x" sizes="min(800px, 30vw)" type="image/webp" class="svelte-1f4837s"><source srcset="/_app/immutable/assets/hero.ZY5Je-2-.jpg 1x, /_app/immutable/assets/hero.xHvcAvrs.jpg 2x" sizes="min(800px, 30vw)" type="image/jpeg" class="svelte-1f4837s"><!--]--> <img src="/_app/immutable/assets/hero.xHvcAvrs.jpg" loading="lazy" class="cover-image real-image svelte-1f4837s" width="1536" height="1024" onload="this.__e=event" onerror="this.__e=event"></picture><!--]--><!--]--> <div class="card-content svelte-1f4837s"><!--[!--><!--]--> <div class="card-content svelte-1e8k5qp"><!--[--><span class="card-date svelte-1e8k5qp">2025-07-07</span><!--]--> <h3 class="card-title svelte-1e8k5qp">Practical Bitwise Tricks in Everyday Code</h3> <p class="card-description svelte-1e8k5qp">An opinionated and short collection of bitwise tricks that make sense at an average 1x engineer's code.</p> <!--[!--><!--]--> <!--[--><div class="card-tags svelte-1e8k5qp"><!--[--><span class="badge subtle small svelte-1ffaubh"><!---->Bitwise<!----></span><!--]--></div><!--]--></div><!----></div> <!--[--><div class="neon-border svelte-1f4837s"></div><!--]--></div><!----></a><a href="/blog/010-cuckoo-filters" class="content-card-link svelte-1e8k5qp"><div class="card neon clickable content-card svelte-1f4837s"><!--[--><!--[!--><!--]--> <!--[!--><picture class="svelte-1f4837s"><!--[--><source srcset="/_app/immutable/assets/hero.B2uWPBry.avif 1x, /_app/immutable/assets/hero.CvZl82k-.avif 2x" sizes="min(800px, 30vw)" type="image/avif" class="svelte-1f4837s"><source srcset="/_app/immutable/assets/hero.DeK7qp3N.webp 1x, /_app/immutable/assets/hero.DuXFaxUH.webp 2x" sizes="min(800px, 30vw)" type="image/webp" class="svelte-1f4837s"><source srcset="/_app/immutable/assets/hero.BMxPsSDC.jpg 1x, /_app/immutable/assets/hero.DfuhpzPT.jpg 2x" sizes="min(800px, 30vw)" type="image/jpeg" class="svelte-1f4837s"><!--]--> <img src="/_app/immutable/assets/hero.DfuhpzPT.jpg" loading="lazy" class="cover-image real-image svelte-1f4837s" width="1536" height="1024" onload="this.__e=event" onerror="this.__e=event"></picture><!--]--><!--]--> <div class="card-content svelte-1f4837s"><!--[!--><!--]--> <div class="card-content svelte-1e8k5qp"><!--[--><span class="card-date svelte-1e8k5qp">2025-07-02</span><!--]--> <h3 class="card-title svelte-1e8k5qp">Cuckoo Filters: Better Than Bloom Filters?</h3> <p class="card-description svelte-1e8k5qp">Meet the data structure that refuses trade-offs: identical footprint to Bloom, fewer false positives, and deletion that works without overhead. Grab all three!</p> <!--[!--><!--]--> <!--[--><div class="card-tags svelte-1e8k5qp"><!--[--><span class="badge subtle small svelte-1ffaubh"><!---->Algorithms<!----></span><!--]--></div><!--]--></div><!----></div> <!--[--><div class="neon-border svelte-1f4837s"></div><!--]--></div><!----></a><!--]--></div><!----></div><!--]--><!----></div><!----><!----><!--]--><!----></main> <footer class="svelte-1mbgpkc"><div class="space-container undefined svelte-7gsxae"><p class="space-text-small">¬© 2025 | Aleksey Maltsev</p><!----></div><!----></footer><!----></div><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_1v2qjmb = {
						base: new URL("..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("../_app/immutable/entry/start.GJZ_hnUf.js"),
						import("../_app/immutable/entry/app.SOLyqlcg.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 8],
							data: [null,{type:"data",data:{placeholderUrl:"data:image/png;base64,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",views:2575,ogImagePath:"/images/og/012-simd-within-a-register-how-i-doubled-hash-table-lookup-performance.jpg"},uses:{params:["slug"]}}],
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
