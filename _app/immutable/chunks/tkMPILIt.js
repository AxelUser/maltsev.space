import{t,a as p}from"./CEYJ1X-9.js";import"./DPOUz0k3.js";import{s,f as c,n as d}from"./C93sEKZr.js";import{h as a}from"./DKD9a3x9.js";const n={date:"2018-11-12",tags:["C#"],keywords:["C#","testing","InternalsVisibleTo"],title:"Testing Private Code in C#: Breaking Encapsulation with InternalsVisibleTo Attribute",preview:"Learn about the different options available for testing private logic in C# and how the InternalsVisibleTo attribute can help you access internal members without compromising the encapsulation of your code.",draft:!1,legacy:!0,hero:"/images/blog/003-internals-visible-for-testing/hero.jpg"},{date:D,tags:u,keywords:m,title:B,preview:f,draft:C,legacy:g,hero:v}=n;var k=t(`<h2 id="about-tests-for-private-code"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#about-tests-for-private-code">#</a>About tests for private code</h2> <p>Well, most of the time, if you need to test some private logic, maybe you it’s better to be SPECIFIC and extract it to public members of new classes. Sometimes decomposition “rocks” and you code became clearer and more maintainable, so check it out before.</p> <p>However, this private logic can be really connected to the domain of a single class and isn’t worth of extracting it somewhere else.</p> <p>In that case you have 3 simple options and all of them somehow break the idea of encapsulation:</p> <ul><li>Make those members <code>public</code> and treat them in your test-fixtures as usual. It may be OK, if you are writing simple app and for now you don’t care about clean public interfaces. However, if you provide it as a public library, This approach opens you internal logic for every user, so, if “dirty” usage of these members could break state of your objects or even whole application.</li> <li>Make those members <code>protected</code>, inherit into your testable stub, which will make those members <code>public</code>, or derive your test-fixture from it. This can also work, but you have to write some boilerplate code. However, it is not suitable, if your class is sealed. For example, if you don’t want users to extend it, as it may break the logic of connected classes.</li> <li>Make those members <code>internal</code> and add <code>InternalsVisibleTo</code> attribute on assembly-level. This approach also breaks encapsulation, but only inside you assembly, all your public interfaces for users will stay clean and secure. And you don’t need to use inheritance and write stubs.</li></ul> <h2 id="how-to-use-internalsvisibleto"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#how-to-use-internalsvisibleto">#</a>How to use <code>InternalsVisibleTo</code></h2> <p>For example, you have got a class <code>Some</code> with public method <code>Increment</code> and internal property <code>Counter</code> as object’s state:</p> <!> <p>You want to assert its state in some CLI or test-fixture:</p> <!> <p>We can’t access property <code>Counter</code> in assembly <code>InternalsVisibleTests</code>, because it’s modifier is <code>internal</code>. To open internal logic for other assemblies, you need to provide attribute for whole testable assembly in file <code>AssemblyInfo.cs</code> or just above the definition of your class, it doesn’t really matter.
Let’s put attribute invocation into <code>AssemblyInfo.cs</code> of project <code>InternalsLib</code>:</p> <!> <p>Now <code>InternalsVisibleTests</code> became a friend assembly and internal members from assembly <code>InternalsLib</code> became visible inside of its scope.</p> <p>You can learn more about <code>InternalsVisibleTo</code> at <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.compilerservices.internalsvisibletoattribute" rel="nofollow">documentation</a>.</p>`,1);function F(l){var e=k(),o=s(c(e),14);a(o,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">namespace</span><span style="color:#BABED8;--shiki-dark:#B392F0"> InternalsLib</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> class</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Some</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">        internal</span><span style="color:#89DDFF;--shiki-dark:#F97583"> int</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Counter</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#123;</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> get</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> set</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">        public</span><span style="color:#89DDFF;--shiki-dark:#F97583"> void</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Increment</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#123;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">            Counter</span><span style="color:#89DDFF;--shiki-dark:#F97583">++</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var i=s(o,4);a(i,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#F78C6C;--shiki-dark:#F97583">using</span><span style="color:#BABED8;--shiki-dark:#B392F0"> System</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#B392F0">Diagnostics</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F78C6C;--shiki-dark:#F97583">using</span><span style="color:#BABED8;--shiki-dark:#B392F0"> InternalsLib</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">namespace</span><span style="color:#BABED8;--shiki-dark:#B392F0"> InternalsVisibleTests</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">    class</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Program</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">        static</span><span style="color:#89DDFF;--shiki-dark:#F97583"> void</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Main</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[]</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> args</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#123;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">            var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> someObj</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#89DDFF;--shiki-dark:#F97583"> new</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Some</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">            someObj</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">Increment</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">            Trace</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">WriteLine</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">$"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">Expected count </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#F78C6C;--shiki-dark:#79B8FF">1</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#125;</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">, real count </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">someObj</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">Counter</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#125;"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var r=s(i,4);a(r,()=>'<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[</span><span style="color:#F78C6C;--shiki-dark:#F97583">assembly</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">:</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> InternalsVisibleTo</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">InternalsVisibleTests</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)]</span></span></code></pre>'),d(4),p(l,e)}const w=Object.freeze(Object.defineProperty({__proto__:null,default:F,metadata:n},Symbol.toStringTag,{value:"Module"}));export{w as _};
