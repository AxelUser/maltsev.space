var oa=Object.defineProperty;var ra=(t,a,n)=>a in t?oa(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n;var Ts=(t,a,n)=>ra(t,typeof a!="symbol"?a+"":a,n);import{j as Us,t as _,a as B,s as N,b as ks,n as Ys}from"./CEYJ1X-9.js";import"./DPOUz0k3.js";import{av as pa,y as ca,Q as Js,X as da,R as Rs,h as Ks,aw as ha,c as y,r as F,s as e,f as K,n as z,p as zs,t as J,g as s,u as w,a as Hs,D as M,a4 as Is,w as ka,E as m}from"./C93sEKZr.js";import{h as i}from"./a1pPPDLw.js";import{p as H,i as ls}from"./TDdWhIBO.js";import{a as Fa,e as Ds,i as ms,f as us,r as Os,s as ts,B as Fs}from"./BAtPURNs.js";function ya(t,a,n=a){var o=pa();Us(t,"input",l=>{var p=l?t.defaultValue:t.value;if(p=js(t)?qs(p):p,n(p),o&&p!==(p=a())){var r=t.selectionStart,c=t.selectionEnd;t.value=p??"",c!==null&&(t.selectionStart=r,t.selectionEnd=Math.min(c,t.value.length))}}),(Ks&&t.defaultValue!==t.value||ca(a)==null&&t.value)&&n(js(t)?qs(t.value):t.value),Js(()=>{var l=a();js(t)&&l===qs(t.value)||t.type==="date"&&!l&&!t.value||l!==t.value&&(t.value=l??"")})}const Ws=new Set;function Ls(t,a,n,o,l=o){var p=n.getAttribute("type")==="checkbox",r=t;let c=!1;if(a!==null)for(var d of a)r=r[d]??(r[d]=[]);r.push(n),Us(n,"change",()=>{var h=n.__value;p&&(h=Ns(r,h,n.checked)),l(h)},()=>l(p?[]:null)),Js(()=>{var h=o();if(Ks&&n.defaultChecked!==n.checked){c=!0;return}p?(h=h||[],n.checked=h.includes(n.__value)):n.checked=ha(n.__value,h)}),da(()=>{var h=r.indexOf(n);h!==-1&&r.splice(h,1)}),Ws.has(r)||(Ws.add(r),Rs(()=>{r.sort((h,k)=>h.compareDocumentPosition(k)===4?-1:1),Ws.delete(r)})),Rs(()=>{if(c){var h;if(p)h=Ns(r,h,n.checked);else{var k=r.find(D=>D.checked);h=k==null?void 0:k.__value}l(h)}})}function Ns(t,a,n){for(var o=new Set,l=0;l<t.length;l+=1)t[l].checked&&o.add(t[l].__value);return n||o.delete(a),Array.from(o)}function js(t){var a=t.type;return a==="number"||a==="range"}function qs(t){return t===""?null:+t}var Ea=_('<div class="scrollbox svelte-e7vp9s"><!></div>');function Gs(t,a){var n=Ea(),o=y(n);Fa(o,()=>a.children),F(n),B(t,n)}const Xs={date:"2018-10-26",tags:["C#"],keywords:["C#",".Net","Enums"],title:"Shift Your C# Enums",preview:"Discover the simple yet powerful technique of using bitwise shift operator in C# Enums, and how it can improve the readability and maintainability of your code.",draft:!1,legacy:!0,hero:"/images/blog/001-binary-shifts-for-flags/hero.jpg"},{date:fe,tags:be,keywords:ve,title:Ce,preview:xe,draft:we,legacy:Ae,hero:_e}=Xs;var Da=_('<p>If you want easily increment your flags in <code>Enum</code>, you can represent it’s values with bitwise shift operator:</p> <!> <p>Performance is equal, cause in code all enums translated into underlying numbers by compiler itself, so no runtime overhead. Seems a little bit more trivial, than multiplying “by hand”:</p> <!> <p>More info about bitwise operators and Enums you can learn from <a href="https://www.alanzucconi.com/2015/07/26/enum-flags-and-bitwise-operators/" rel="nofollow">this post</a>.</p>',1);function ma(t){var a=Da(),n=e(K(a),2);i(n,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">Flags</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">enum</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> ProgrammingLanguages</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    None</span><span style="color:#89DDFF;--shiki-dark:#F97583">        =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 0</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    C</span><span style="color:#89DDFF;--shiki-dark:#F97583">           =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 1</span><span style="color:#89DDFF;--shiki-dark:#F97583"> &#x3C;&#x3C;</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 0</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    Cpp</span><span style="color:#89DDFF;--shiki-dark:#F97583">         =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 1</span><span style="color:#89DDFF;--shiki-dark:#F97583"> &#x3C;&#x3C;</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 1</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    VisualBasic</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 1</span><span style="color:#89DDFF;--shiki-dark:#F97583"> &#x3C;&#x3C;</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 2</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    VisualCpp</span><span style="color:#89DDFF;--shiki-dark:#F97583">   =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 1</span><span style="color:#89DDFF;--shiki-dark:#F97583"> &#x3C;&#x3C;</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 3</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    Rust</span><span style="color:#89DDFF;--shiki-dark:#F97583">        =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 1</span><span style="color:#89DDFF;--shiki-dark:#F97583"> &#x3C;&#x3C;</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 4</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    CSharp</span><span style="color:#89DDFF;--shiki-dark:#F97583">      =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 1</span><span style="color:#89DDFF;--shiki-dark:#F97583"> &#x3C;&#x3C;</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 5</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    Java</span><span style="color:#89DDFF;--shiki-dark:#F97583">        =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 1</span><span style="color:#89DDFF;--shiki-dark:#F97583"> &#x3C;&#x3C;</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 6</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    Php</span><span style="color:#89DDFF;--shiki-dark:#F97583">         =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 1</span><span style="color:#89DDFF;--shiki-dark:#F97583"> &#x3C;&#x3C;</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 7</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    Go</span><span style="color:#89DDFF;--shiki-dark:#F97583">          =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 1</span><span style="color:#89DDFF;--shiki-dark:#F97583"> &#x3C;&#x3C;</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 8</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    Rust</span><span style="color:#89DDFF;--shiki-dark:#F97583">        =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 1</span><span style="color:#89DDFF;--shiki-dark:#F97583"> &#x3C;&#x3C;</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 9</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    Scala</span><span style="color:#89DDFF;--shiki-dark:#F97583">       =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 1</span><span style="color:#89DDFF;--shiki-dark:#F97583"> &#x3C;&#x3C;</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 10</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    Clojure</span><span style="color:#89DDFF;--shiki-dark:#F97583">     =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 1</span><span style="color:#89DDFF;--shiki-dark:#F97583"> &#x3C;&#x3C;</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 11</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    FSharp</span><span style="color:#89DDFF;--shiki-dark:#F97583">      =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 1</span><span style="color:#89DDFF;--shiki-dark:#F97583"> &#x3C;&#x3C;</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 12</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    DotNetFamily</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> VisualBasic </span><span style="color:#89DDFF;--shiki-dark:#F97583">|</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> VisualCpp </span><span style="color:#89DDFF;--shiki-dark:#F97583">|</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> CSharp</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    JvmFamily</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> Java </span><span style="color:#89DDFF;--shiki-dark:#F97583">|</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> Scala </span><span style="color:#89DDFF;--shiki-dark:#F97583">|</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> Clojure</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var o=e(n,4);i(o,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">Flags</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">enum</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> ProgrammingLanguages</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    None</span><span style="color:#89DDFF;--shiki-dark:#F97583">        =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 0</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    C</span><span style="color:#89DDFF;--shiki-dark:#F97583">           =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 1</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    Cpp</span><span style="color:#89DDFF;--shiki-dark:#F97583">         =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 2</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    VisualBasic</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 4</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    VisualCpp</span><span style="color:#89DDFF;--shiki-dark:#F97583">   =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 8</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    Rust</span><span style="color:#89DDFF;--shiki-dark:#F97583">        =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 16</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    CSharp</span><span style="color:#89DDFF;--shiki-dark:#F97583">      =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 32</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    Java</span><span style="color:#89DDFF;--shiki-dark:#F97583">        =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 64</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    Php</span><span style="color:#89DDFF;--shiki-dark:#F97583">         =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 128</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    Go</span><span style="color:#89DDFF;--shiki-dark:#F97583">          =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 256</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    Rust</span><span style="color:#89DDFF;--shiki-dark:#F97583">        =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 512</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    Scala</span><span style="color:#89DDFF;--shiki-dark:#F97583">       =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 1024</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    Clojure</span><span style="color:#89DDFF;--shiki-dark:#F97583">     =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 2048</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    FSharp</span><span style="color:#89DDFF;--shiki-dark:#F97583">      =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 4096</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    DotNetFamily</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> VisualBasic </span><span style="color:#89DDFF;--shiki-dark:#F97583">|</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> VisualCpp </span><span style="color:#89DDFF;--shiki-dark:#F97583">|</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> CSharp</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    JvmFamily</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> Java </span><span style="color:#89DDFF;--shiki-dark:#F97583">|</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> Scala </span><span style="color:#89DDFF;--shiki-dark:#F97583">|</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> Clojure</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`),z(2),B(t,a)}const ua=Object.freeze(Object.defineProperty({__proto__:null,default:ma,metadata:Xs},Symbol.toStringTag,{value:"Module"})),Qs={date:"2018-10-27",tags:["C#"],keywords:["C#","CallerMemberName"],title:"Using CallerMemberName for Improved Logging in C#",preview:'Learn how to use "magic" attributes in C#, such as CallerFilePath, CallerLineNumber, and CallerMemberName, to retrieve caller information and improve logging functionality.',draft:!1,legacy:!0,hero:"/images/blog/002-callermembername-attribute-for-logging/hero.jpg"},{date:Te,tags:Ie,keywords:Se,title:Ve,preview:Me,draft:ze,legacy:He,hero:Pe}=Qs;var Ba=_('<p>In software development, especially when working with large codebases, tracking down where and how methods are called can be a challenging task. Debugging and logging become essential tools in a developer’s toolkit to understand the flow of execution and identify issues.</p> <p>Since C# 4.5, the language introduced a set of “magic” attributes that greatly simplify this process. These attributes automatically provide information about the caller, making your code cleaner and more maintainable.</p> <p>This blog post will delve into how these attributes work, provide examples of their use, and demonstrate how they can enhance your debugging and logging efforts.</p> <h2 id="understanding-caller-information-attributes"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#understanding-caller-information-attributes">#</a>Understanding Caller Information Attributes</h2> <p>Caller information attributes are designed to retrieve metadata about the caller of a method. They are <code>CallerFilePath</code>, <code>CallerLineNumber</code> and <code>CallerMemberName</code>.</p> <p>These attributes allow you to change the default values of optional parameters in methods, providing valuable information about the location in the code where the method was called.</p> <h2 id="what-is-a-caller"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#what-is-a-caller">#</a>What is a Caller?</h2> <p>In programming, a <em>caller</em> is the piece of code that invokes (calls) a method or function. Understanding the context of the caller can help in debugging and maintaining code, as it tells you where a particular method was called from within your application.</p> <h2 id="default-behavior-of-optional-parameters"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#default-behavior-of-optional-parameters">#</a>Default Behavior of Optional Parameters</h2> <p>By default, the compiler translates optional parameters into their default values if no other value is provided. For example, consider the following logging method:</p> <!> <p>If you call this method with <code>Log(msg)</code>, the compiler translates this to <code>Log(msg, null)</code>.</p> <h2 id="enhancing-optional-parameters-with-caller-attributes"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#enhancing-optional-parameters-with-caller-attributes">#</a>Enhancing Optional Parameters with Caller Attributes</h2> <p>You can enhance this behavior using caller attributes. By placing these attributes before the optional parameters in your method, the compiler will automatically fill in the predefined values:</p> <ul><li><code>CallerFilePath</code> passes the full path of the source code file where the method was called.</li> <li><code>CallerLineNumber</code> passes the line number (as an integer) where the method was called.</li> <li><code>CallerMemberName</code> passes the name of the member (constructor, method, property, event, etc.) that called the method.</li></ul> <h2 id="example-tracing-or-logging"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#example-tracing-or-logging">#</a>Example: Tracing or Logging</h2> <p>For instance, if you want to write tracing or logging code and need to know where an event occurred, you can use these attributes as shown below:</p> <!> <p>When you invoke this method:</p> <!> <p>You will see output similar to:</p> <!> <h3 id="example-implementing-inotifypropertychanged"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#example-implementing-inotifypropertychanged">#</a>Example: Implementing INotifyPropertyChanged</h3> <p>If you are familiar with <code>INotifyPropertyChanged</code>, you can implement the PropertyChanged event without the hassle of always passing the name of the property that was changed. Here is an example:</p> <!> <p>In this example, the <code>OnPropertyChanged</code> method uses the <code>[CallerMemberName]</code> attribute to automatically provide the name of the property that has changed, eliminating the need to manually specify it each time.</p> <h2 id="final-thoughts"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#final-thoughts">#</a>Final thoughts</h2> <p>Leveraging caller information attributes in C# can significantly simplify your debugging, logging, and event-handling code, making it more robust and easier to maintain.</p> <p>By automatically providing information about the caller, these attributes save you time and reduce the likelihood of errors in your code. For more details on these attributes, you can refer to the <a href="https://docs.microsoft.com/ru-ru/dotnet/csharp/programming-guide/concepts/caller-information" rel="nofollow">official documentation</a> about these attributes.</p>',1);function ga(t){var a=Ba(),n=e(K(a),20);i(n,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#89DDFF;--shiki-dark:#F97583">void</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Log</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> msg</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#89DDFF;--shiki-dark:#F97583"> string</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> method</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#89DDFF;--shiki-dark:#79B8FF"> null</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit">    // logging somewhere</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var o=e(n,14);i(o,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#C792EA;--shiki-dark:#F97583"> static</span><span style="color:#89DDFF;--shiki-dark:#F97583"> void</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> TraceEvent</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> message</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    [</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">CallerMemberName</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">]</span><span style="color:#89DDFF;--shiki-dark:#F97583"> string</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> memberName</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> ""</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    [</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">CallerFilePath</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">]</span><span style="color:#89DDFF;--shiki-dark:#F97583"> string</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> sourceFilePath</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> ""</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    [</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">CallerLineNumber</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">]</span><span style="color:#89DDFF;--shiki-dark:#F97583"> int</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> sourceLineNumber</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 0</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    Trace</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">WriteLine</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">event: </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#F97583"> +</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> message</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    Trace</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">WriteLine</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">member name: </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#F97583"> +</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> memberName</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    Trace</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">WriteLine</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">source file path: </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#F97583"> +</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> sourceFilePath</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    Trace</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">WriteLine</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">source line number: </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#F97583"> +</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> sourceLineNumber</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var l=e(o,4);i(l,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">static</span><span style="color:#89DDFF;--shiki-dark:#F97583"> void</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Main</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[]</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> args</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#82AAFF;--shiki-dark:#B392F0">    TraceEvent</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">Started</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var p=e(l,4);i(p,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span>event: Started</span></span>
<span class="line"><span>member name: Main</span></span>
<span class="line"><span>source file path: C:somepath&#92;tosourceCallerInfoTest.CliCallerInfoTest.CliProgram.cs</span></span>
<span class="line"><span>source line number: 11</span></span></code></pre>`);var r=e(p,6);i(r,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> class</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> ViewModel</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">:</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> INotifyPropertyChanged</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    private</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> String</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> _message</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> String</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Message</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">        get</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =></span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> _message</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">        set</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#123;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">            if</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> (</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">value </span><span style="color:#89DDFF;--shiki-dark:#F97583">==</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> _message</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit"> return</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">            _message </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> value</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#82AAFF;--shiki-dark:#B392F0">            OnPropertyChanged</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> event</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> PropertyChangedEventHandler</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> PropertyChanged</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    protected</span><span style="color:#C792EA;--shiki-dark:#F97583"> virtual</span><span style="color:#89DDFF;--shiki-dark:#F97583"> void</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> OnPropertyChanged</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">([</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">CallerMemberName</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">]</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> String</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> propertyName</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#89DDFF;--shiki-dark:#79B8FF"> null</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">        PropertyChanged</span><span style="color:#89DDFF;--shiki-dark:#F97583">?</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">Invoke</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">this</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#89DDFF;--shiki-dark:#F97583"> new</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> PropertyChangedEventArgs</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">propertyName</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`),z(8),B(t,a)}const fa=Object.freeze(Object.defineProperty({__proto__:null,default:ga,metadata:Qs},Symbol.toStringTag,{value:"Module"})),Zs={date:"2018-11-12",tags:["C#"],keywords:["C#","testing","InternalsVisibleTo"],title:"Testing Private Code in C#: Breaking Encapsulation with InternalsVisibleTo Attribute",preview:"Learn about the different options available for testing private logic in C# and how the InternalsVisibleTo attribute can help you access internal members without compromising the encapsulation of your code.",draft:!1,legacy:!0,hero:"/images/blog/003-internals-visible-for-testing/hero.jpg"},{date:We,tags:je,keywords:qe,title:Oe,preview:Re,draft:Le,legacy:Ne,hero:Ge}=Zs;var ba=_(`<h2 id="about-tests-for-private-code"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#about-tests-for-private-code">#</a>About tests for private code</h2> <p>Well, most of the time, if you need to test some private logic, maybe you it’s better to be SPECIFIC and extract it to public members of new classes. Sometimes decomposition “rocks” and you code became clearer and more maintainable, so check it out before.</p> <p>However, this private logic can be really connected to the domain of a single class and isn’t worth of extracting it somewhere else.</p> <p>In that case you have 3 simple options and all of them somehow break the idea of encapsulation:</p> <ul><li>Make those members <code>public</code> and treat them in your test-fixtures as usual. It may be OK, if you are writing simple app and for now you don’t care about clean public interfaces. However, if you provide it as a public library, This approach opens you internal logic for every user, so, if “dirty” usage of these members could break state of your objects or even whole application.</li> <li>Make those members <code>protected</code>, inherit into your testable stub, which will make those members <code>public</code>, or derive your test-fixture from it. This can also work, but you have to write some boilerplate code. However, it is not suitable, if your class is sealed. For example, if you don’t want users to extend it, as it may break the logic of connected classes.</li> <li>Make those members <code>internal</code> and add <code>InternalsVisibleTo</code> attribute on assembly-level. This approach also breaks encapsulation, but only inside you assembly, all your public interfaces for users will stay clean and secure. And you don’t need to use inheritance and write stubs.</li></ul> <h2 id="how-to-use-internalsvisibleto"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#how-to-use-internalsvisibleto">#</a>How to use <code>InternalsVisibleTo</code></h2> <p>For example, you have got a class <code>Some</code> with public method <code>Increment</code> and internal property <code>Counter</code> as object’s state:</p> <!> <p>You want to assert its state in some CLI or test-fixture:</p> <!> <p>We can’t access property <code>Counter</code> in assembly <code>InternalsVisibleTests</code>, because it’s modifier is <code>internal</code>. To open internal logic for other assemblies, you need to provide attribute for whole testable assembly in file <code>AssemblyInfo.cs</code> or just above the definition of your class, it doesn’t really matter.
Let’s put attribute invocation into <code>AssemblyInfo.cs</code> of project <code>InternalsLib</code>:</p> <!> <p>Now <code>InternalsVisibleTests</code> became a friend assembly and internal members from assembly <code>InternalsLib</code> became visible inside of its scope.</p> <p>You can learn more about <code>InternalsVisibleTo</code> at <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.compilerservices.internalsvisibletoattribute" rel="nofollow">documentation</a>.</p>`,1);function va(t){var a=ba(),n=e(K(a),14);i(n,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">namespace</span><span style="color:#BABED8;--shiki-dark:#B392F0"> InternalsLib</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> class</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Some</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">        internal</span><span style="color:#89DDFF;--shiki-dark:#F97583"> int</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Counter</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#123;</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> get</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> set</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">        public</span><span style="color:#89DDFF;--shiki-dark:#F97583"> void</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Increment</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#123;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">            Counter</span><span style="color:#89DDFF;--shiki-dark:#F97583">++</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var o=e(n,4);i(o,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#F78C6C;--shiki-dark:#F97583">using</span><span style="color:#BABED8;--shiki-dark:#B392F0"> System</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#B392F0">Diagnostics</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F78C6C;--shiki-dark:#F97583">using</span><span style="color:#BABED8;--shiki-dark:#B392F0"> InternalsLib</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">namespace</span><span style="color:#BABED8;--shiki-dark:#B392F0"> InternalsVisibleTests</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">    class</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Program</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">        static</span><span style="color:#89DDFF;--shiki-dark:#F97583"> void</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Main</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[]</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> args</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#123;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">            var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> someObj</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#89DDFF;--shiki-dark:#F97583"> new</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Some</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">            someObj</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">Increment</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">            Trace</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">WriteLine</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">$"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">Expected count </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#F78C6C;--shiki-dark:#79B8FF">1</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#125;</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">, real count </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">someObj</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">Counter</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#125;"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var l=e(o,4);i(l,()=>'<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[</span><span style="color:#F78C6C;--shiki-dark:#F97583">assembly</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">:</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> InternalsVisibleTo</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">InternalsVisibleTests</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)]</span></span></code></pre>'),z(4),B(t,a)}const Ca=Object.freeze(Object.defineProperty({__proto__:null,default:va,metadata:Zs},Symbol.toStringTag,{value:"Module"})),sa={date:"2018-11-15",tags:["C#"],keywords:["C#","deconstructors","tuples","operation-result"],title:"Benefits of deconstructors for custom types",preview:"How and when to use deconstruction syntax-sugar for your custom types in C#",draft:!1,legacy:!0,hero:"/images/blog/004-deconstructors/hero.jpg"},{date:$e,tags:Ue,keywords:Ye,title:Je,preview:Ke,draft:Xe,legacy:Qe,hero:Ze}=sa;var xa=_(`<h2 id="about-tuples-in-c-7"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#about-tuples-in-c-7">#</a>About tuples in C# 7</h2> <p>New tuples and its support in C# 7 are blazing-cool:</p> <ul><li>they are structures, so no heap allocations;</li> <li>they have aliases for names of its fields (<code>tuple.Info</code> vs old <code>tuple.Item1</code>);</li> <li>they bring syntax-sugar of deconstruction;</li></ul> <p>Moreover, the deconstruction can be used not only for build-in tuples, but also for your own classes and structures.</p> <h2 id="deconstruction-for-tuples"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#deconstruction-for-tuples">#</a>Deconstruction for tuples</h2> <p>Let’s start with the original usage for tuples. If you are already familiar with it, you may jump to <a href="#implementing-deconstruction-for-custom-types">the next block</a>.</p> <p>For example, you have a method, which returns a statistic about most frequent word in a form of a tuple with two fields: word and count. Below is the example of such method:</p> <!> <p>As you see, <code>GetMostFrequentWord</code> returns unnamed tuple, and you can access its fields via <code>Item1</code> and <code>Item2</code>:</p> <!> <p>On the other hand, if you implement named-tuple, those values can be accessed through aliases, you just need to make some changes into declaration of the tuple:</p> <!> <p>However, our original need is just getting those fields <code>word</code> and <code>count</code>, we don’t really care about grouping tuple. So be it: with the help of deconstruction, we can initialize only variables <code>word</code> and <code>count</code>:</p> <!> <p>In addition, you can even use <code>var</code> for completely deconstructed tuple, instead of specifying explicit types for every field:</p> <!> <p>If you don’t need some fields from deconstruction, you can use another feature of C# 7 - <a href="https://docs.microsoft.com/ru-ru/dotnet/csharp/discards" rel="nofollow">discards</a>. For example, if we want to discard the creation of variable <code>count</code> during deconstruction, we can pass <code>_</code> instead:</p> <!> <h2 id="implementing-deconstruction-for-custom-types"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#implementing-deconstruction-for-custom-types">#</a>Implementing deconstruction for custom types</h2> <p>Using deconstruction of tuples is quite straightforward, how about user-defined types? You may want <code>GetMostFrequentWord</code> to return your own struct <code>WordStat</code>:</p> <!> <p>Generic tuples are great, but there are several reasons for using your own models:</p> <ul><li>Better readability, as your code became less “technical”.</li> <li>Easy refactoring, for example, if you want to change field names or add new ones.</li> <li>Your model has domain specifics, but generic tuples - doesn’t.</li></ul> <p>So, we will use <code>WordStat</code> instead of a tuple, but can we use deconstruction for our model?</p> <p>We are lucky because we can add this feature to our type. All is needed is adding new public method <code>Deconstruct</code> with <code>out</code> parameters, that will be extracted during deconstruction:</p> <!> <p>After that, smart compiler will use this method to produce deconstructed values:</p> <!> <p>Deconstructed fields must be of same types and in same order and count, as they appear in <code>Deconstruct</code>. You can have as many configurations of deconstruction, as how many overrides of <code>Deconstruct</code> you have.
One more thing - <code>Deconstruct</code> may be an extension-method!</p> <p>Let’s add a new field <code>WordLength</code> to <code>WordStat</code> and write an extension to get all those three fields:</p> <!> <p>Now we can get word’s length from deconstruction:</p> <!> <h2 id="use-cases-of-deconstruction"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#use-cases-of-deconstruction">#</a>Use-cases of deconstruction</h2> <p>Imagine a service, which sends you some data, for example aggregational count of some records in some data-sources. Method takes a long time to aggregate. Let’s say it’s signature will be:</p> <!> <p>What if service failed, while retrieving count; or even more complicated - it failed only for several sources. What will be the result of <code>Count</code>: partial count, <code>default(int)</code>, <code>-1</code>, <code>null</code> (if it will be <code>Nullable&lt;int&gt;</code>)? Or maybe <code>Count</code> will throw an exception?</p> <p>One approach is to use complex type as a result; often it is named as <strong>Operation Result</strong>. It usually consists of requested data and some information about errors, which have been occurred (or not). Below is the example:</p> <!> <!> <!> <p>The main idea is that it is grouping result and errors, so we have full information about result of the operation and may react as we want. In our case we want to show user any result, even if it isn’t full.</p> <p>So, as in the example with frequent word, our model of complex result just group everything together. It’s useful when we construct complex result via our factory-methods, but then in the consumer we need only its fields.</p> <p>There may be different ways of how we consume these results, for example, we just need requested data, even if it may be equals <code>default</code> (empty).</p> <p>So, we can use deconstruction and discards. Firstly, we create <code>Deconstruct</code> with all 4 fields:</p> <!> <p>Then we can deconstruct it as we want:</p> <!> <p>And that’s it, were are ready to go on!</p> <h2 id="further-reading"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#further-reading">#</a>Further reading</h2> <ul><li><a href="https://docs.microsoft.com/ru-ru/dotnet/csharp/deconstruct" rel="nofollow">Documentation about deconstruction</a></li> <li><a href="https://blogs.msdn.microsoft.com/seteplia/2017/11/01/dissecting-the-tuples-in-c-7/" rel="nofollow">Some investigation about how new tuples work</a></li> <li><a href="https://www.codeproject.com/Articles/1022462/Error-Handling-in-SOLID-Csharp-NET-The-Operation-R" rel="nofollow">Article about different kinds of error handling, like OperationResult</a></li></ul>`,1);function wa(t){var a=xa(),n=e(K(a),14);i(n,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">static</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> (</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#89DDFF;--shiki-dark:#F97583"> int</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> GetMostFrequentWord</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> text</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">    var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> group</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> text</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">Split</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">'</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> '</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        .</span><span style="color:#82AAFF;--shiki-dark:#B392F0">GroupBy</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">s</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =></span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> s</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        .</span><span style="color:#82AAFF;--shiki-dark:#B392F0">OrderByDescending</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">grouping</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =></span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> grouping</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">Count</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">())</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        .</span><span style="color:#82AAFF;--shiki-dark:#B392F0">First</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">    return</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> (</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">group</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">Key</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> group</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">Count</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">());</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var o=e(n,4);i(o,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">static</span><span style="color:#89DDFF;--shiki-dark:#F97583"> void</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Main</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[]</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> args</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#F97583">    string</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> text</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">tuple for testing tuple</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">    var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> stat</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> GetMostFrequentWord</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">text</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    Trace</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">WriteLine</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">$"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">word: </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">stat</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">Item1</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#125;</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">, count: </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">stat</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">Item2</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#125;"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var l=e(o,4);i(l,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit">// we added aliases for the output below</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">static</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> (</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> word</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#89DDFF;--shiki-dark:#F97583"> int</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> count</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> GetMostFrequentWord</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> text</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit">    // same logic</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">static</span><span style="color:#89DDFF;--shiki-dark:#F97583"> void</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Main</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[]</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> args</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#F97583">    string</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> text</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">tuple for testing tuple</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">    var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> stat</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> GetMostFrequentWord</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">text</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit">    // but now we use aliases for fields</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    Trace</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">WriteLine</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">$"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">word: </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">stat</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">word</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#125;</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">, count: </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">stat</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">count</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#125;"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var p=e(l,4);i(p,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">static</span><span style="color:#89DDFF;--shiki-dark:#F97583"> void</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Main</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[]</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> args</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#F97583">    string</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> text</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">tuple for testing tuple</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit">    // no tuple now, just values from its fields</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    (</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> word</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#89DDFF;--shiki-dark:#F97583"> int</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> count</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> GetMostFrequentWord</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">text</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    Trace</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">WriteLine</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">$"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">word: </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">word</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#125;</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">, count: </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">count</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#125;"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var r=e(p,4);i(r,()=>'<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">var</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> (</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">word</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> count</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> GetMostFrequentWord</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">text</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span></code></pre>');var c=e(r,4);i(c,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">static</span><span style="color:#89DDFF;--shiki-dark:#F97583"> void</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Main</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[]</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> args</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#F97583">    string</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> text</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">tuple for testing tuple</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">    var</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> (</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">word</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> _</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> GetMostFrequentWord</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">text</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    Trace</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">WriteLine</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">$"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">Most frequent word: </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">word</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#125;"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var d=e(c,6);i(d,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> struct</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> WordStat</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#89DDFF;--shiki-dark:#F97583"> string</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Word</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#123;</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> get</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> set</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#89DDFF;--shiki-dark:#F97583"> int</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Count</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#123;</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> get</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> set</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> WordStat</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> word</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#89DDFF;--shiki-dark:#F97583"> int</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> count</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">        Word </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> word</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">        Count </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> count</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">static</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> WordStat</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> GetMostFrequentWordStats</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> text</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">    var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> group</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> text</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">Split</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">'</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> '</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        .</span><span style="color:#82AAFF;--shiki-dark:#B392F0">GroupBy</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">s</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =></span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> s</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        .</span><span style="color:#82AAFF;--shiki-dark:#B392F0">OrderByDescending</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">grouping</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =></span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> grouping</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">Count</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">())</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        .</span><span style="color:#82AAFF;--shiki-dark:#B392F0">First</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">    return</span><span style="color:#89DDFF;--shiki-dark:#F97583"> new</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> WordStat</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">group</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">Key</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> group</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">Count</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">());</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var h=e(d,10);i(h,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#89DDFF;--shiki-dark:#F97583"> void</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Deconstruct</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#C792EA;--shiki-dark:#F97583">out</span><span style="color:#89DDFF;--shiki-dark:#F97583"> string</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> word</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#C792EA;--shiki-dark:#F97583"> out</span><span style="color:#89DDFF;--shiki-dark:#F97583"> int</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> count</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    word </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> Word</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    count </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> Count</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var k=e(h,4);i(k,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">static</span><span style="color:#89DDFF;--shiki-dark:#F97583"> void</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Main</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[]</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> args</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#F97583">    string</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> text</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">tuple for testing tuple</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit">    // visually nothing has changed</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">    var</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> (</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">word</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> count</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> GetMostFrequentWordStats</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">text</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    Trace</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">WriteLine</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">$"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">word: </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">word</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#125;</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">, count: </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">count</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#125;"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var D=e(k,6);i(D,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#C792EA;--shiki-dark:#F97583"> static</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> class</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Extensions</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#C792EA;--shiki-dark:#F97583"> static</span><span style="color:#89DDFF;--shiki-dark:#F97583"> void</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Deconstruct</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#C792EA;--shiki-dark:#F97583">this</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Program</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">WordStat</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> stat</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#C792EA;--shiki-dark:#F97583"> out</span><span style="color:#89DDFF;--shiki-dark:#F97583"> string</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> word</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#C792EA;--shiki-dark:#F97583"> out</span><span style="color:#89DDFF;--shiki-dark:#F97583"> int</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> count</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#C792EA;--shiki-dark:#F97583"> out</span><span style="color:#89DDFF;--shiki-dark:#F97583"> int</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> length</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">        word </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> stat</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">Word</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">        count </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> stat</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">Count</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">        length </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> stat</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">WordLength</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var u=e(D,4);i(u,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">static</span><span style="color:#89DDFF;--shiki-dark:#F97583"> void</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Main</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[]</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> args</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#F97583">    string</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> text</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">tuple for testing tuple</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">    var</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> (</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">word</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> count</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> length</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> GetMostFrequentWordStats</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">text</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    Trace</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">WriteLine</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">$"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">word: </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">word</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#125;</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">, count: </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">count</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#125;</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">, length: </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">length</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#125;"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var A=e(u,6);i(A,()=>'<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">Task</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#89DDFF;--shiki-dark:#F97583">int</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Count</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[]</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> dataSourcesUrls</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span></code></pre>');var C=e(A,6);i(C,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit">// Our service</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> class</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> AggregationService</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Task</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">OperationResult</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#89DDFF;--shiki-dark:#F97583">int</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">>></span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Count</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[]</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> dataSourcesUrls</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">        return</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> Task</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">FromResult</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">            OperationResult</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#89DDFF;--shiki-dark:#F97583">int</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">>.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">CreatePartly</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#F78C6C;--shiki-dark:#79B8FF">100</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#F97583">                new</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Exception</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">$"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">Data from url '</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">dataSourcesUrls</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">[</span><span style="color:#F78C6C;--shiki-dark:#79B8FF">0</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">]&#125;</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">' was not loaded, but it's OK, go on</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)));</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var T=e(C,2);i(T,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit">// Complex result</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> class</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> OperationResult</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">TResult</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    private</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> OperationResult</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#89DDFF;--shiki-dark:#F97583"> bool</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Success</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#123;</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> get</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span><span style="color:#C792EA;--shiki-dark:#F97583"> private</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> set</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#125;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> TResult</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Result</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#123;</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> get</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span><span style="color:#C792EA;--shiki-dark:#F97583"> private</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> set</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#125;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Exception</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Exception</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#123;</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> get</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span><span style="color:#C792EA;--shiki-dark:#F97583"> private</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> set</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#125;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#89DDFF;--shiki-dark:#F97583"> bool</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> IsTotallySuccessful</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =></span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> Success </span><span style="color:#89DDFF;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> Exception </span><span style="color:#89DDFF;--shiki-dark:#F97583">==</span><span style="color:#89DDFF;--shiki-dark:#79B8FF"> null</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit">    // Factories</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#C792EA;--shiki-dark:#F97583"> static</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> OperationResult</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">TResult</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span><span style="color:#82AAFF;--shiki-dark:#B392F0"> CreateSuccessful</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">TResult</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> result</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">        return</span><span style="color:#89DDFF;--shiki-dark:#F97583"> new</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> OperationResult</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">TResult</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#123;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">            Success </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#FF9CAC;--shiki-dark:#79B8FF"> true</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">            Result </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> result</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#125;;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#C792EA;--shiki-dark:#F97583"> static</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> OperationResult</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">TResult</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span><span style="color:#82AAFF;--shiki-dark:#B392F0"> CreatePartly</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">TResult</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> result</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Exception</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> e</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">        return</span><span style="color:#89DDFF;--shiki-dark:#F97583"> new</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> OperationResult</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">TResult</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#123;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">            Success </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#FF9CAC;--shiki-dark:#79B8FF"> true</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">            Result </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> result</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">            Exception </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> e</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#125;;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#C792EA;--shiki-dark:#F97583"> static</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> OperationResult</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">TResult</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span><span style="color:#82AAFF;--shiki-dark:#B392F0"> CreateFailed</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">TResult</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> result</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Exception</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> e</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">        return</span><span style="color:#89DDFF;--shiki-dark:#F97583"> new</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> OperationResult</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">TResult</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#123;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">            Success </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#FF9CAC;--shiki-dark:#79B8FF"> false</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">            Exception </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> e</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#125;;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var S=e(T,2);i(S,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit">// Consumer of our service</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> class</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Consumer</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#C792EA;--shiki-dark:#F97583"> async</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Task</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Run</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">        var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> urls</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#89DDFF;--shiki-dark:#F97583"> new</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[]</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#123;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#9ECBFF">            "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">https://www.maltsev.space/sources/1</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#9ECBFF">            "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">https://www.maltsev.space/sources/2</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#9ECBFF">            "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">https://www.maltsev.space/sources/3</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#125;;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">        var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> service</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#89DDFF;--shiki-dark:#F97583"> new</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> AggregationService</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">        var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> countResult</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#89DDFF;--shiki-dark:#F97583"> await</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> service</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">Count</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">urls</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">).</span><span style="color:#82AAFF;--shiki-dark:#B392F0">ConfigureAwait</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FF9CAC;--shiki-dark:#79B8FF">false</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">        if</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">countResult</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">IsTotallySuccessful</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">            Trace</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">WriteLine</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">$"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">Total count: </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">countResult</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">Result</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#125;"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">        else</span><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit"> if</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> (</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">countResult</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">Success</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">            Trace</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">WriteLine</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">$"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">Count is around: </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">countResult</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">Result</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#125;</span><span style="color:#BABED8;--shiki-dark:#79B8FF">&#92;n</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">Error: </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">countResult</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">Exception</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#125;"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">        else</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">            Trace</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">WriteLine</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">$"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">Error: </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">countResult</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">Exception</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#125;"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var f=e(S,10);i(f,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#89DDFF;--shiki-dark:#F97583"> void</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Deconstruct</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#C792EA;--shiki-dark:#F97583">out</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> TResult</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> result</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#C792EA;--shiki-dark:#F97583"> out</span><span style="color:#89DDFF;--shiki-dark:#F97583"> bool</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> success</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#C792EA;--shiki-dark:#F97583"> out</span><span style="color:#89DDFF;--shiki-dark:#F97583"> bool</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> totalSuccess</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#C792EA;--shiki-dark:#F97583"> out</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Exception</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> exception</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    result </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> Result</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    success </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> Success</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    totalSuccess </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> IsTotallySuccessful</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    exception </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> Exception</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var x=e(f,4);i(x,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">var</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> (</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">count</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> _</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> totalSuccess</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> _</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#89DDFF;--shiki-dark:#F97583"> await</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> service</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">Count</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">urls</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">).</span><span style="color:#82AAFF;--shiki-dark:#B392F0">ConfigureAwait</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FF9CAC;--shiki-dark:#79B8FF">false</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">if</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">totalSuccess</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    Trace</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">WriteLine</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">$"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">Total count: </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">count</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#125;"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span></code></pre>`),z(6),B(t,a)}const Aa=Object.freeze(Object.defineProperty({__proto__:null,default:wa,metadata:sa},Symbol.toStringTag,{value:"Module"})),aa={date:"2020-06-22",tags:["C#"],keywords:["C#","generics"],title:"Unlocking the Power of Generics: Simulating Dictionary Behavior in C#",preview:"Do you want to improve performance of caching? Get rid of Dictionary and use just CLR for that!",draft:!1,legacy:!0,hero:"/images/blog/005-dictionary-on-generics/hero.jpg"},{date:sn,tags:an,keywords:en,title:nn,preview:tn,draft:ln,legacy:on,hero:rn}=aa;var _a=_('<h2 id="disclaimer"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#disclaimer">#</a>Disclaimer</h2> <ol><li>This article shows how to simulate dictionary behavior with generic static classes. However, <strong>the way to this solution goes through other examples with lots of design details</strong> to make you familiar with the situation. If you’re interested only in “hacking” part, you may go directly to the section <a href="#implementing-a-generic-based-cached-producer">Implementing a generic-based cached producer</a>.</li> <li>In code examples I’ve used <strong>Nullable Reference Types</strong>, which is a new feature from <strong>C# 8</strong>. They don’t affect the performance and definitely not a main point of the article. If you’re curious, check the <a href="https://docs.microsoft.com/en-us/dotnet/csharp/nullable-references" rel="nofollow">documentation</a>.</li> <li>All code is available on <a href="https://github.com/AxelUser/examples/tree/master/DotNet/DictionaryOfTypes" rel="nofollow">GitHub</a>.</li></ol> <h2 id="task-create-a-factory-for-rest-clients"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#task-create-a-factory-for-rest-clients">#</a>Task: create a factory for REST clients</h2> <p>When you are integrating different services into each other, it’s always a very time-consuming process to write clients for all of them. Luckily, if those RESTful services provide their API schema in <strong>OpenAPI</strong> (or previously named <strong>Swagger</strong>) format, chances are great that there’s a generator of clients for this common type of schema format.</p> <p>.Net has several packages for client generation, for example <a href="https://github.com/RicoSuter/NSwag" rel="nofollow">NSwag</a>. There are different opinions on how generated clients should be look like, but let’s consider that their constructors receive <em>HttpClient</em> instance for sending requests and classes themselves are derived from generated interfaces, containing all public methods for the API.</p> <p>The first requirement helps to manipulate <em>HttpClient</em> creation and lifetime, which means that we can even reuse one from the pool. The second requirement will be handy, when it’s needed to write unit-tests for code, that uses service’s clients - in that case they must be mocked and mocking in .Net’s frameworks “mostly” requires passing an interface.</p> <p>To sum everything up, the generated code will follow the similar pattern:</p> <!> <h2 id="automating-client-creation"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#automating-client-creation">#</a>Automating client creation</h2> <p>Although clients are implementing their own interfaces, it’s still hard to test code, that creates clients via constructors. For a testable code it’s required to have all those clients as dependencies or delegate their creation into a new dependency. It’s possible to resolve clients via <strong>Dependency Injection</strong>, because <em>HttpClient</em> can be effectively taken from reusable pool via <a href="https://docs.microsoft.com/en-us/dotnet/architecture/microservices/implement-resilient-applications/use-httpclientfactory-to-implement-resilient-http-requests" rel="nofollow">IHttpClientFactory</a>, and most of the DI frameworks offer you a zero configuration for that feature.</p> <p>However sometimes it’s necessary to control base url to your service or to dynamically pass some values into request’s headers, like authorization tokens or distributed tracing ids. So it may be preferred to pass a valid <em>HttpClient</em> manually and that’s why for the sake of the article let’s stick to this format.</p> <p>The most appropriate way of extracting object construction into dedicated dependency is implementing a <a href="https://refactoring.guru/design-patterns/factory-method" rel="nofollow">Factory</a> for clients. Unfortunately, all clients implement different interfaces and it isn’t possible to write base interface as returned value for the factory method. However it’s still possible to invoke the creation of specific client by redesigning the factory into generic class.</p> <p>Let’s discuss possible interface:</p> <!> <p>Why it’s preferred to make whole class as generic and not just the method <code>Create</code>? If it will be only a generic method, the factory will be similar to the <a href="https://blog.ploeh.dk/2010/02/03/ServiceLocatorisanAnti-Pattern/" rel="nofollow">Service Locator</a>, which has some maintainability issues and hides the information which clients the outer code depends on.</p> <p>Here is an example:</p> <!> <p>The first variant of <code>concreteClientFactory</code> is much more transparent than <code>commonClientFactory</code>. <strong>That’s why this design will be applied to all further solutions it the article.</strong></p> <p>As factory should create clients of specific types, there are some more questions to discuss:</p> <ol><li>How factory should invoke a constructor of the concrete client?</li> <li>How factory should effectively guess object of which class should be created, if only interface is passed to the generic type parameter?</li></ol> <p>Solution for the first question is quite trivial - invoking constructor via handy static helper <a href="https://docs.microsoft.com/en-gb/dotnet/api/system.activator.createinstance?view=netcore-3.1#System_Activator_CreateInstance_System_Type_System_Object___" rel="nofollow">Activator.CreateInstance</a>. Internally it’s an old friend reflection does all the job, but activator provides a simpler API.</p> <p>For the second problem another reflection-based mechanism should be involved. As I mentioned above, mocking frameworks for .Net work better, if they create mocks that implement base interfaces. Thus the factory method should expose client’s interface in returned value. It can be easily achieved with the help of generic type parameter, but nevertheless factory method should create an object of the concrete class.</p> <p>So, factory should perform mapping between the interface and the implementation. Fortunately, all generated classes and interfaces are stored under dedicated namespace and are available during the start of an application. That’s right - <strong>mapping can be created by traversing though all classes in that namespace</strong>.</p> <p>To execute search only once, it’s better to put mapping code into a <strong>static constructor</strong>. Reflection will traverse through the whole assembly, find all client’s interfaces with their implementations and save that relationships into a simple dictionary. Also it’a a good idea to <strong>encapsulate mapping into another dependency</strong>, which has private static field with that dictionary and produces the factory for required clients. Encapsulation will protect internal mapping from unexpected mutations and make namespace cleaner.</p> <p>The new dependency can be implemented as a factory provider, or in other words factory of factories. The interface is trivial:</p> <!> <p>Type of the client’s implementation can be passed into client factory constructor by factory provider. Thus, after factory provider is invoked, it finds relevant class for an interface passed as generic type argument and creates the valid client factory. Below is the implementation of the provider:</p> <!> <p>Everything is done so far. All mapping is extracted into provider, which had permitted the easier implementation of the actual client factory:</p> <!> <p>Now it’s time to ask, <strong>what can be done to produce factories more efficiently</strong>. If factory creation will be done very often, it’s better to make some kind of caching for it, because it doesn’t depend on a context of invocation.</p> <p>I want to mention, that all modern DI frameworks has an ability to mark those client factories as singletons at configuration and that’s OK to use it when you can.</p> <p>Even so, what about making this mechanism by ourselves? If you’re interested, I’ll welcome you to read the article further.</p> <h2 id="benchmarking"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#benchmarking">#</a>Benchmarking</h2> <p>Before we dig into optimizations, <strong>it’s HIGHLY recommended to track the performance of made solutions</strong>. As we are dealing with isolated modules, micro-benchmarking will suit our needs.</p> <p>The easiest way to create benchmarks of that kind is using a popular nuget package <a href="https://benchmarkdotnet.org/" rel="nofollow">BenchmarkDotNet</a>. I won’t include in the article how to write good benchmarks for every situation, because this theme is quite vast. However, if you’re not familiar with benchmarking or BenchmarkDotNet, you may follow the links to BenchmarkDotNet documentation at the section <strong>References</strong>.</p> <p>Frankly speaking, I shall mention that maintainers of the BenchmarkDotNet did a great job in providing an easy API for creating benchmarks, which gives ability to include lots of useful indicators and will be clear to the most of .Net developers.</p> <p>Firstly we need to know how solutions are fast and how much memory they consume. In BenchmarkDotNet speed indicator come out of the box, and memory consumption can be tracked via <a href="https://adamsitnik.com/the-new-Memory-Diagnoser/" rel="nofollow"><code>MemoryDiagnoser</code></a> attribute for the benchmark class. Here is a code snippet of configuration:</p> <!> <p>Now it’s time for benchmarks themselves. <strong>Caching improves peeking of some value many times</strong>, that’s why benchmark should also perform several attempts of getting factories for each client.</p> <p>To show how many attempts were performed, BenchmarkDotNet has an ability to use custom benchmark parameters via another attribute <a href="https://benchmarkdotnet.org/articles/features/parameterization.html" rel="nofollow"><code>Params</code></a>. It receives values of that parameter for each benchmark run and displays that value at its own column in report. For this benchmark let’s choose numbers <em>100</em>, <em>1000</em> and <em>10000000</em>:</p> <!> <p>Another useful feature is making benchmark for original solution as <a href="https://benchmarkdotnet.org/articles/features/baselines.html" rel="nofollow">baseline</a>. It is used to display the ratio of how speed of other benchmarks differs from the baseline.</p> <p>Alright, now everything is ready to write the code of the first benchmark:</p> <!> <p>Well, that code is strange. It’s because I’ve generated all actual invocations of factory provider using <strong>T4</strong> template file. Obviously that isn’t necessary, but as soon as I generated all code for clients using the same T4 templates, I thought that it is more maintainable to generate invocations as well. I mentioned it before, but all code is available on GitHub, so you may have a look at <a href="https://github.com/AxelUser/examples/blob/master/DotNet/DictionaryOfTypes/Clients/StubbedClients.cs" rel="nofollow">generated clients</a> and generated <a href="https://github.com/AxelUser/examples/blob/master/DotNet/DictionaryOfTypes/Benchmarking/BenchmarkCallsCreator.cs" rel="nofollow">provider invocations</a>.</p> <p>One more thing to know - because I don’t want to include the creation of delegates with provider invocations, it’s vital to move it into set-up, similar to the one that testing frameworks offer. BenchmarkDotNet has the same API for it, which means making set-up method and marking it with <a href="https://benchmarkdotnet.org/articles/features/setup-and-cleanup.html" rel="nofollow"><code>GlobalSetup</code></a> attribute:</p> <!> <p>Now all deletes are accessible from private field and its initialization won’t affect the results.</p> <p>Anyway, let’s run our benchmark and see how things are doing:</p> <!> <p>We may see, that the provider performed quite fast (for now), but had allocated factory objects for each invocation of the factory provider. As I’ve said, for this issue there’s a solution - <strong>caching factories</strong>.</p> <h2 id="store-factories-into-dictionary"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#store-factories-into-dictionary">#</a>Store factories into Dictionary</h2> <p>The most obvious way to cache concrete factories is to store mapping from interface to factory, not just the mapping between interfaces and their implementation.</p> <p>Seems legit! So let’s rewrite our initial factory method into one, which returns concrete client’s factories for interfaces.</p> <p>Mapping reflection-based mechanism also should be rewritten to store concrete client factories for each interface into static dictionary object. As mentioned above, this mapping can performed once at application start-up, because factories are quite stateless by themselves.</p> <p>Unfortunately, we can’t provide open generic type as the type for a value of our dictionary, but because all these factories are reference types, we can cast them to objects, put these values into the dictionary and when requested, receive from the dictionary and cast to a requested generic type. To make further examples simpler, I’ve extracted mapping construction into static helper <code>ClientTypesProvider.GetAllTypes(Assembly)</code>, because it won’t be changed further in the article.</p> <!> <p>Well, this solution isn’t so elegant, but <strong>casting is mostly used to overcome the type system’s limitation</strong>.</p> <p>Now it’s obvious that we’ve reduced memory consumption using pre-allocated factories, but what about speed?</p> <p>Let’s check the performance of this caching mechanism by writing a benchmark and compare results with the baseline:</p> <!> <p>Hm, seems like it’s <strong>became SLOWER, than the original simple solution</strong>, but we may guess what operation caused such performance penalty. <em>Did we write something wrong or inefficient?</em></p> <p>Earlier I’ve mentioned that “dumb” casting from object to generic factory type. <strong>This simple cast is overkill for current situation</strong> - it involves type checking, but we know exactly what generic type stored under each key in dictionary.</p> <!> <p>Once again check the benchmark results:</p> <!> <p>Much better - the speed of invocation is a little bit less than the baseline and the memory consumption is minimal.</p> <p>We may stay with this implementation, but if that was an option, I’ve never wrote such an obvious post 😅.</p> <p>So, is there a way to improve speed even more? Well, <strong>that’s when generics steal the show!</strong></p> <h2 id="delegate-caching-to-jit"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#delegate-caching-to-jit">#</a>Delegate caching to JIT</h2> <p>This trick is mostly inspired by the way how <a href="https://docs.microsoft.com/en-us/dotnet/api/system.array.empty?view=netcore-3.1" rel="nofollow">Array.Empty</a> works.</p> <p>Empty arrays are best candidates for caching, because their construction doesn’t require any parameters, but only a generic type parameter.</p> <p>When you invoke <code>Array.Empty&lt;MyClass&gt;</code>, it internally invokes a static read-only field <code>Empty</code> of static generic class <code>EmptyArray&lt;MyClass&gt;</code>, which initializes and returns an empty array of type <code>MyClass</code> (have a look at <a href="https://github.com/dotnet/runtime/blob/3705185af806e273ccef98e44699400f0416c452/src/libraries/System.Private.CoreLib/src/System/Array.cs#L694-L704" rel="nofollow">sources</a>). Static field is initialized during the time of a first access to the field of the class <em>EmptyArray</em>. This is guaranteed from the fact how generics and static classes work in <strong>CLR</strong> (Common Language Runtime). For your information, that’s how you can implement a <a href="https://csharpindepth.com/articles/singleton" rel="nofollow">simple thread-safe singleton</a> in .Net.</p> <h2 id="how-clr-compiles-generic-classes"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#how-clr-compiles-generic-classes">#</a>How CLR compiles generic classes</h2> <p>Generics are types, that contain a type parameter, which isn’t known at compile time (e.g. <code>List&lt;T&gt;</code>). When dotnet compiler sees open generic type, it compiles it into IL with the same generic type parameter.</p> <p>After the type argument is passed into generic constructor (e.g. <code>List&lt;MyClass&gt;</code>), CLR will do the following:</p> <ol><li>Lookup if the closed generic (with concrete generic type argument) was requested before.</li> <li>If not - it will be compiled at run time.</li></ol> <p>Nice point is that JIT compiler will share all code for specific generics, which have only reference types as their type parameters. This optimization makes sense, because objects of reference types are passed into methods by fixed-sized reference to their content in the managed heap. All references to objects have common size, which equals to the machine word: 32 or 64 bits, depending on the architecture of an operating system and processor.</p> <p>It doesn’t mean, that compiler vanishes all information about different closed generics, but instead of compiling the whole code for the class, it will save the information about concrete closed generic into <strong>Method Table</strong>.</p> <p>It worth mentioning, that for value types, like structs and primitives, JIT will compile specialized code to handle each type parameters combination, which were passed during the construction of a closed generic.</p> <p>Using the knowledge about how generics are compiled and how static fields are initialized, we can implement a cache for factory producer.</p> <h2 id="implementing-a-generic-based-cached-producer"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#implementing-a-generic-based-cached-producer">#</a>Implementing a generic-based cached producer</h2> <p>Let’s create a new static class <code>CachedFactory&lt;T&gt;</code> with static field <code>Instance</code>, which is initialized with a factory for the concrete client implementing interface <em>T</em>. The factory creation is extracted into the method, that gets implementation type from static dictionary and creates a factory.</p> <p>How new static factories can access the mapping information? One way is to make that dictionary public, as well as making this new class as public. However, as I mentioned before in the case of dictionary-based caching solution, that will pollute a namespace with things you should never access manually.</p> <p>Encapsulation of the caching mechanism can be achieved by making the class <code>CachedFactory&lt;T&gt;</code> private and nesting it inside the actual provider class. In that case the public factory provider will have full access the public field of <code>CachedFactory&lt;T&gt;</code>, without opening its API to the outer code</p> <!> <p>However, there is also a caveat - <strong>when a type <em>T</em> isn’t stored in dictionary, the generic nevertheless will be compiled and stored at Method Table until the end of execution</strong>. That’s why the whole generics trick may be a bad idea, if the client interface is passed from user input.</p> <p>To make things a little bit fancier, <strong>code with nested class may be extracted into own file</strong>, if the factory provider will be marked as partial. It’s up to you how to name that file, but I recommend you to write the name of the provider plus the name of cached factory, separated by the dot, like <em>GenericClientFactoryProvider.CachedFactory.cs</em>.</p> <p>Provider will trigger client creation when accessing the field <code>Instance</code> of a closed generic <code>CachedFactory&lt;T&gt;</code> class for the first time:</p> <!> <p>If client creation shouldn’t be lazy, fields for all closed generic classes can be accessed at the same time, when mapping is created.</p> <!> <p>Now let’s add a new benchmark and check the performance:</p> <!> <p>Speed of invocation has been dramatically increased, compared to the previous dictionary-based solution. Now we may use this solution with interface defined earlier, gaining all benefits of generic type lookup, which give us the runtime itself.</p> <h2 id="conclusion"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#conclusion">#</a>Conclusion</h2> <p>All these solutions are powered by the knowledge of runtime internals, which may increase the difficulty of understanding how much benefits we receive. <strong>When messing with such hacks don’t hesitate to check the performance incrementally via benchmarking</strong>. I hope that my examples proves you, that this process isn’t much harder than writing a unit-tests, thanks to BenchmarkDotNet!</p> <p>All provided solutions are quite specialized for the task of caching values, which don’t depend on dynamic parameters. In other words all values can be initialized during the application start-up. If that is your case, you may use provided solutions and I hope you will improve the overall performance of your program.</p> <h2 id="references"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#references">#</a>References</h2> <ol><li><a href="https://codeblog.jonskeet.uk/2017/04/26/surprise-creating-an-instance-of-an-open-generic-type/" rel="nofollow">How to create open generic type at runtime</a></li> <li><a href="https://alexandrnikitin.github.io/blog/dotnet-generics-under-the-hood/" rel="nofollow">Generic types under the hood</a></li> <li><a href="https://benchmarkdotnet.org/" rel="nofollow">BenchmarkDotNet website</a></li></ol>',1);function Ta(t){var a=_a(),n=e(K(a),14);i(n,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#C792EA;--shiki-dark:#F97583"> partial</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> interface</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> ISomeResourceClient</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">	Task</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">SwaggerResponse</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">>></span><span style="color:#82AAFF;--shiki-dark:#B392F0"> GetSomeResourceAsync</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">CancellationToken</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> cancellationToken</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#C792EA;--shiki-dark:#F97583"> partial</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> class</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> SomeResourceClient</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> ISomeResourceClient</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">	private</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> HttpClient</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> _httpClient</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">	public</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> SystemClient</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">HttpClient</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> httpClient</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">	&#123;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">		_httpClient </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> httpClient</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">	&#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">	public</span><span style="color:#C792EA;--shiki-dark:#F97583"> async</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Task</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">SwaggerResponse</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">>></span><span style="color:#82AAFF;--shiki-dark:#B392F0"> GetUpdaterLinkAsync</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">CancellationToken</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> cancellationToken</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">	&#123;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit">		// Generated code for sending request.</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">	&#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var o=e(n,12);i(o,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> interface</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> IClientFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#C792EA;--shiki-dark:#F97583">out</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span><span style="color:#C792EA;--shiki-dark:#F97583"> where</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">:</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> class</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    T</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Create</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">HttpClient</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> client</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var l=e(o,6);i(l,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Wrapper</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    IClientFactory</span><span style="color:#89DDFF;--shiki-dark:#F97583">&#x3C;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">ISomeResourceClient</span><span style="color:#89DDFF;--shiki-dark:#F97583">></span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> concreteClientFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#676E95;font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit"> // doesn't hide details</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    IClientFactory commonClientFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit">    // some ctor details</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var p=e(l,18);i(p,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> interface</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> IClientsFactoryProvider</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    IClientFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span><span style="color:#82AAFF;--shiki-dark:#B392F0"> GetClientFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">>()</span><span style="color:#C792EA;--shiki-dark:#F97583"> where</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> class</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var r=e(p,4);i(r,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> class</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> SimpleClientFactoryProvider</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">:</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> IClientsFactoryProvider</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    private</span><span style="color:#C792EA;--shiki-dark:#F97583"> static</span><span style="color:#C792EA;--shiki-dark:#F97583"> readonly</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Dictionary</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">Type</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Type</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> DiscoveredAllowedClientTypes</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    static</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> SimpleClientFactoryProvider</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">        DiscoveredAllowedClientTypes </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> GetAllTypes</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">Assembly</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">GetExecutingAssembly</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">())</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">            .</span><span style="color:#82AAFF;--shiki-dark:#B392F0">ToDictionary</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">tuple</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =></span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> tuple</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">@interface</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> tuple</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =></span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> tuple</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">implementation</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> IClientFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span><span style="color:#82AAFF;--shiki-dark:#B392F0"> GetClientFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">>()</span><span style="color:#C792EA;--shiki-dark:#F97583"> where</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> class</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">        if</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">!</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">DiscoveredAllowedClientTypes</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">TryGetValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">typeof</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">),</span><span style="color:#C792EA;--shiki-dark:#F97583"> out</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> implType</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">            throw</span><span style="color:#89DDFF;--shiki-dark:#F97583"> new</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Exception</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">$"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">Client type '</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#89DDFF;--shiki-dark:#F97583">typeof</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">)&#125;</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">' isn't supported</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">        return</span><span style="color:#89DDFF;--shiki-dark:#F97583"> new</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> ClientFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">>(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">implType</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    private</span><span style="color:#C792EA;--shiki-dark:#F97583"> static</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> IEnumerable</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">Type</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> @interface</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Type</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> implementation</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)></span><span style="color:#82AAFF;--shiki-dark:#B392F0"> GetAllTypes</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">Assembly</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> assembly</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">        var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> clientsTypes</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> assembly</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">DefinedTypes</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">            .</span><span style="color:#82AAFF;--shiki-dark:#B392F0">Where</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">type</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =></span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> type</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">CustomAttributes</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">                .</span><span style="color:#82AAFF;--shiki-dark:#B392F0">Any</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">attr</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =></span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> attr</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">AttributeType </span><span style="color:#89DDFF;--shiki-dark:#F97583">==</span><span style="color:#89DDFF;--shiki-dark:#F97583"> typeof</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">RestClientAttribute</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">        foreach</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> (</span><span style="color:#FFCB6B;--shiki-dark:#F97583">var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> clientType</span><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit"> in</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> clientsTypes</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#123;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">            var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> @interface</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> clientType</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">ImplementedInterfaces</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">First</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">            yield</span><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit"> return</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> (</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">@interface</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> clientType</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var c=e(r,4);i(c,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> class</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> ClientFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">>:</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> IClientFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span><span style="color:#C792EA;--shiki-dark:#F97583"> where</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> class</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    private</span><span style="color:#C792EA;--shiki-dark:#F97583"> readonly</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Type</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> _clientImplType</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> ClientFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">Type</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> clientImplType</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">        _clientImplType </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> clientImplType</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> T</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Create</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">HttpClient</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> client</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">        return</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> (</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> Activator</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">CreateInstance</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">_clientImplType</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> client</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span><span style="color:#89DDFF;--shiki-dark:#F97583">!</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var d=e(c,18);i(d,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">MemoryDiagnoser</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> class</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> ClientFactoryProvidersBenchmark</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit">	// Benchmarks</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var h=e(d,6);i(h,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">Params</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#F78C6C;--shiki-dark:#79B8FF">100</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 1000</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 10000000</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)]</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#89DDFF;--shiki-dark:#F97583"> int</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> Accesses </span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> get</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> set</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#125;</span></span></code></pre>`);var k=e(h,6);i(k,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">Benchmark</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">Baseline</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#FF9CAC;--shiki-dark:#79B8FF"> true</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)]</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#89DDFF;--shiki-dark:#F97583"> void</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> SimpleFactory_SequentialAccess</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#82AAFF;--shiki-dark:#B392F0">    Execute</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">_simpleFactoryRunActions</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">MethodImpl</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">MethodImplOptions</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">AggressiveInlining</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)]</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">private</span><span style="color:#89DDFF;--shiki-dark:#F97583"> void</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Execute</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">IReadOnlyList</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">Action</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> actions</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">    var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> length</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> actions</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">Count</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">    for</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> (</span><span style="color:#FFCB6B;--shiki-dark:#F97583">var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> i</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 0</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> i </span><span style="color:#89DDFF;--shiki-dark:#F97583">&#x3C;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> Accesses</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> i</span><span style="color:#89DDFF;--shiki-dark:#F97583">++</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">        actions</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">i </span><span style="color:#89DDFF;--shiki-dark:#F97583">%</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> length</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">]();</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var D=e(k,6);i(D,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">[</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">GlobalSetup</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#89DDFF;--shiki-dark:#F97583"> void</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> SetUp</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    _simpleFactoryRunActions </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> BenchmarkCallsCreator</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">CreateInvocations</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">new</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> SimpleClientFactoryProvider</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">());</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var u=e(D,6);i(u,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span>|                         Method | Accesses |           Mean |         Error |        StdDev | Ratio |      Gen 0 | Gen 1 | Gen 2 | Allocated |</span></span>
<span class="line"><span>|------------------------------- |--------- |---------------:|--------------:|--------------:|------:|-----------:|------:|------:|----------:|</span></span>
<span class="line"><span>| SimpleFactory_SequentialAccess |      100 |       3.636 us |     0.0297 us |     0.0278 us |  1.00 |     0.3815 |     - |     - |   2.34 KB |</span></span>
<span class="line"><span>|                                |          |                |               |               |       |            |       |       |           |</span></span>
<span class="line"><span>| SimpleFactory_SequentialAccess |     1000 |      38.098 us |     0.2838 us |     0.2654 us |  1.00 |     3.7842 |     - |     - |  23.44 KB |</span></span>
<span class="line"><span>|                                |          |                |               |               |       |            |       |       |           |</span></span>
<span class="line"><span>| SimpleFactory_SequentialAccess | 10000000 | 383,617.687 us | 3,106.0346 us | 2,905.3867 us |  1.00 | 38000.0000 |     - |     - | 234375 KB |</span></span></code></pre>`);var A=e(u,14);i(A,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> class</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> CachedSimpleFactoryProvider</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">:</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> IClientsFactoryProvider</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    private</span><span style="color:#C792EA;--shiki-dark:#F97583"> static</span><span style="color:#C792EA;--shiki-dark:#F97583"> readonly</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Type</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> FactoryType</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#89DDFF;--shiki-dark:#F97583"> typeof</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">ClientFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;>);</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    private</span><span style="color:#C792EA;--shiki-dark:#F97583"> static</span><span style="color:#C792EA;--shiki-dark:#F97583"> readonly</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Dictionary</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">Type</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#89DDFF;--shiki-dark:#F97583"> object</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> CachedClientFactories</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    static</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> CachedSimpleFactoryProvider</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">        CachedClientFactories </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> ClientTypesProvider</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">GetAllTypes</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">Assembly</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">GetExecutingAssembly</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">())</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">            .</span><span style="color:#82AAFF;--shiki-dark:#B392F0">ToDictionary</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">tuple</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =></span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> tuple</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">@interface</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> tuple</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =></span><span style="color:#82AAFF;--shiki-dark:#B392F0"> CreateFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">tuple</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">implementation</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> IClientFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span><span style="color:#82AAFF;--shiki-dark:#B392F0"> GetClientFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">>()</span><span style="color:#C792EA;--shiki-dark:#F97583"> where</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> class</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">        if</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">!</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">CachedClientFactories</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">TryGetValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">typeof</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">),</span><span style="color:#C792EA;--shiki-dark:#F97583"> out</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> factory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">            throw</span><span style="color:#89DDFF;--shiki-dark:#F97583"> new</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Exception</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">$"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">Client type '</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#89DDFF;--shiki-dark:#F97583">typeof</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">)&#125;</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">' isn't supported</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">        return</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> (</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">IClientFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">>)</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> factory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    private</span><span style="color:#C792EA;--shiki-dark:#F97583"> static</span><span style="color:#89DDFF;--shiki-dark:#F97583"> object</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> CreateFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">Type</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> clientType</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">        var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> factory</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> FactoryType</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">MakeGenericType</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">clientType</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">        return</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> Activator</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">CreateInstance</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">factory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> clientType</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span><span style="color:#89DDFF;--shiki-dark:#F97583">!</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var C=e(A,8);i(C,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span>|                         Method | Accesses |           Mean |         Error |        StdDev | Ratio | RatioSD |      Gen 0 | Gen 1 | Gen 2 |   Allocated |</span></span>
<span class="line"><span>|------------------------------- |--------- |---------------:|--------------:|--------------:|------:|--------:|-----------:|------:|------:|------------:|</span></span>
<span class="line"><span>| SimpleFactory_SequentialAccess |      100 |       3.636 us |     0.0152 us |     0.0142 us |  1.00 |    0.00 |     0.3815 |     - |     - |      2400 B |</span></span>
<span class="line"><span>| CachedFactory_SequentialAccess |      100 |       7.692 us |     0.0543 us |     0.0481 us |  2.12 |    0.01 |          - |     - |     - |           - |</span></span>
<span class="line"><span>|                                |          |                |               |               |       |         |            |       |       |             |</span></span>
<span class="line"><span>| SimpleFactory_SequentialAccess |     1000 |      35.619 us |     0.0787 us |     0.0697 us |  1.00 |    0.00 |     3.7842 |     - |     - |     24001 B |</span></span>
<span class="line"><span>| CachedFactory_SequentialAccess |     1000 |      74.106 us |     0.9672 us |     0.9047 us |  2.08 |    0.03 |          - |     - |     - |         1 B |</span></span>
<span class="line"><span>|                                |          |                |               |               |       |         |            |       |       |             |</span></span>
<span class="line"><span>| SimpleFactory_SequentialAccess | 10000000 | 365,822.213 us | 2,226.8696 us | 2,083.0152 us |  1.00 |    0.00 | 38000.0000 |     - |     - | 240000000 B |</span></span>
<span class="line"><span>| CachedFactory_SequentialAccess | 10000000 | 746,398.580 us | 3,361.2568 us | 3,144.1217 us |  2.04 |    0.02 |          - |     - |     - |           - |</span></span></code></pre>`);var T=e(C,6);i(T,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> IClientFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span><span style="color:#82AAFF;--shiki-dark:#B392F0"> GetClientFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">>()</span><span style="color:#C792EA;--shiki-dark:#F97583"> where</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> class</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">    if</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">!</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">CachedClientFactories</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">TryGetValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">typeof</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">),</span><span style="color:#C792EA;--shiki-dark:#F97583"> out</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> factory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">        throw</span><span style="color:#89DDFF;--shiki-dark:#F97583"> new</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Exception</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">$"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">Client type '</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#89DDFF;--shiki-dark:#F97583">typeof</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">)&#125;</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">' isn't supported</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">    return</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> Unsafe</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">As</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">IClientFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">>>(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">factory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var S=e(T,4);i(S,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span>|                         Method | Accesses |           Mean |         Error |        StdDev | Ratio |      Gen 0 | Gen 1 | Gen 2 |   Allocated |</span></span>
<span class="line"><span>|------------------------------- |--------- |---------------:|--------------:|--------------:|------:|-----------:|------:|------:|------------:|</span></span>
<span class="line"><span>| SimpleFactory_SequentialAccess |      100 |       3.492 us |     0.0143 us |     0.0134 us |  1.00 |     0.3815 |     - |     - |      2400 B |</span></span>
<span class="line"><span>| CachedFactory_SequentialAccess |      100 |       3.138 us |     0.0022 us |     0.0020 us |  0.90 |          - |     - |     - |           - |</span></span>
<span class="line"><span>|                                |          |                |               |               |       |            |       |       |             |</span></span>
<span class="line"><span>| SimpleFactory_SequentialAccess |     1000 |      34.968 us |     0.3702 us |     0.3462 us |  1.00 |     3.7842 |     - |     - |     24000 B |</span></span>
<span class="line"><span>| CachedFactory_SequentialAccess |     1000 |      31.494 us |     0.0589 us |     0.0522 us |  0.90 |          - |     - |     - |           - |</span></span>
<span class="line"><span>|                                |          |                |               |               |       |            |       |       |             |</span></span>
<span class="line"><span>| SimpleFactory_SequentialAccess | 10000000 | 369,860.373 us | 2,062.8473 us | 1,929.5887 us |  1.00 | 38000.0000 |     - |     - | 240000000 B |</span></span>
<span class="line"><span>| CachedFactory_SequentialAccess | 10000000 | 306,086.300 us | 2,633.7588 us | 2,463.6196 us |  0.83 |          - |     - |     - |           - |</span></span></code></pre>`);var f=e(S,40);i(f,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#C792EA;--shiki-dark:#F97583"> partial</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> class</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> GenericClientFactoryProvider</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    private</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> class</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> CachedFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span><span style="color:#C792EA;--shiki-dark:#F97583"> where</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> class</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">        public</span><span style="color:#C792EA;--shiki-dark:#F97583"> static</span><span style="color:#C792EA;--shiki-dark:#F97583"> readonly</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> IClientFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">>?</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Instance</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">        static</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> CachedFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#123;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">            Instance </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> CreateFactoryIfAllowed</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">        private</span><span style="color:#C792EA;--shiki-dark:#F97583"> static</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> IClientFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">>?</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> CreateFactoryIfAllowed</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">()</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =></span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">            DiscoveredAllowedClientTypes</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">TryGetValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">typeof</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">),</span><span style="color:#C792EA;--shiki-dark:#F97583"> out</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> implType</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#F97583">                ?</span><span style="color:#89DDFF;--shiki-dark:#F97583"> new</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> ClientFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">>(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">implType</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#F97583">                :</span><span style="color:#89DDFF;--shiki-dark:#79B8FF"> null</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var x=e(f,8);i(x,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#C792EA;--shiki-dark:#F97583"> partial</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> class</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> GenericClientFactoryProvider</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> IClientsFactoryProvider</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    private</span><span style="color:#C792EA;--shiki-dark:#F97583"> static</span><span style="color:#C792EA;--shiki-dark:#F97583"> readonly</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Dictionary</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">Type</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Type</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> DiscoveredAllowedClientTypes</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> IClientFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span><span style="color:#82AAFF;--shiki-dark:#B392F0"> GetClientFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">>()</span><span style="color:#C792EA;--shiki-dark:#F97583"> where</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> class</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">        return</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> CachedFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">>.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">Instance </span><span style="color:#89DDFF;--shiki-dark:#F97583">??</span><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit"> throw</span><span style="color:#89DDFF;--shiki-dark:#F97583"> new</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Exception</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">$"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">Client type '</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#89DDFF;--shiki-dark:#F97583">typeof</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">)&#125;</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">' isn't supported</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    static</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> GenericClientFactoryProvider</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">        DiscoveredAllowedClientTypes </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> ClientTypesProvider</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">GetAllTypes</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">Assembly</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">GetExecutingAssembly</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">())</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">            .</span><span style="color:#82AAFF;--shiki-dark:#B392F0">ToDictionary</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">tuple</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =></span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> tuple</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">@interface</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> tuple</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =></span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> tuple</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">implementation</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var P=e(x,4);i(P,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">static</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> GenericClientFactoryProvider</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    DiscoveredAllowedClientTypes </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> ClientTypesProvider</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">GetAllTypes</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">Assembly</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">GetExecutingAssembly</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">())</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        .</span><span style="color:#82AAFF;--shiki-dark:#B392F0">ToDictionary</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">tuple</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =></span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> tuple</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">@interface</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> tuple</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =></span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> tuple</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">implementation</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;--shiki-dark:#B392F0">    InitializeFactories</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">();</span><span style="color:#676E95;font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit"> // Eager initialization</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">private</span><span style="color:#C792EA;--shiki-dark:#F97583"> static</span><span style="color:#89DDFF;--shiki-dark:#F97583"> void</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> InitializeFactories</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">    var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> factory</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#89DDFF;--shiki-dark:#F97583"> typeof</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">CachedFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;>);</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">    foreach</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> (</span><span style="color:#FFCB6B;--shiki-dark:#F97583">var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> @interface</span><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit"> in</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> DiscoveredAllowedClientTypes</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">Keys</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">        var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> genericFactory</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> factory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">MakeGenericType</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">@interface</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">        var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> instanceProperty</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> genericFactory</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">GetField</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">Instance</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">        instanceProperty</span><span style="color:#89DDFF;--shiki-dark:#F97583">!</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">GetValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">null</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var R=e(P,4);i(R,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span>|                                  Method | Accesses |           Mean |         Error |        StdDev | Ratio |      Gen 0 | Gen 1 | Gen 2 |   Allocated |</span></span>
<span class="line"><span>|---------------------------------------- |--------- |---------------:|--------------:|--------------:|------:|-----------:|------:|------:|------------:|</span></span>
<span class="line"><span>|          SimpleFactory_SequentialAccess |      100 |       3.538 us |     0.0454 us |     0.0402 us |  1.00 |     0.3815 |     - |     - |      2400 B |</span></span>
<span class="line"><span>|          CachedFactory_SequentialAccess |      100 |       3.213 us |     0.0233 us |     0.0218 us |  0.91 |          - |     - |     - |           - |</span></span>
<span class="line"><span>| CompiledGenericFactory_SequentialAccess |      100 |       1.390 us |     0.0128 us |     0.0107 us |  0.39 |          - |     - |     - |           - |</span></span>
<span class="line"><span>|                                         |          |                |               |               |       |            |       |       |             |</span></span>
<span class="line"><span>|          SimpleFactory_SequentialAccess |     1000 |      36.258 us |     0.1383 us |     0.1294 us |  1.00 |     3.7842 |     - |     - |     24000 B |</span></span>
<span class="line"><span>|          CachedFactory_SequentialAccess |     1000 |      31.292 us |     0.1065 us |     0.0890 us |  0.86 |          - |     - |     - |           - |</span></span>
<span class="line"><span>| CompiledGenericFactory_SequentialAccess |     1000 |      14.505 us |     0.0144 us |     0.0120 us |  0.40 |          - |     - |     - |           - |</span></span>
<span class="line"><span>|                                         |          |                |               |               |       |            |       |       |             |</span></span>
<span class="line"><span>|          SimpleFactory_SequentialAccess | 10000000 | 374,137.631 us | 1,675.7705 us | 1,399.3442 us |  1.00 | 38000.0000 |     - |     - | 240000000 B |</span></span>
<span class="line"><span>|          CachedFactory_SequentialAccess | 10000000 | 307,281.414 us | 1,939.4985 us | 1,719.3149 us |  0.82 |          - |     - |     - |           - |</span></span>
<span class="line"><span>| CompiledGenericFactory_SequentialAccess | 10000000 | 144,997.830 us |   715.7528 us |   634.4962 us |  0.39 |          - |     - |     - |       334 B |</span></span></code></pre>`),z(12),B(t,a)}const Ia=Object.freeze(Object.defineProperty({__proto__:null,default:Ta,metadata:aa},Symbol.toStringTag,{value:"Module"})),ea={date:"2022-04-20",tags:["MongoDB"],title:"Checking MongoDB Operation Status: A Simple Guide",preview:"Learn how to easily check the status of your MongoDB operations with this step-by-step guide.",draft:!1,hero:"/images/blog/006-how-to-get-status-of-mongodb-operation/hero.jpg"},{date:pn,tags:cn,title:dn,preview:hn,draft:kn,hero:Fn}=ea;var Sa=_('<p>When working with databases, it’s not uncommon to inspect the status of a running query, whether it’s for profiling purposes or as part of a polling mechanism for asynchronous operations. In this blog post, we’ll explore how to use MongoDB’s <code>$currentOp</code> stage to retrieve information about running queries and how to use this functionality to store the status of running operations.</p> <h2 id="background"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#background">#</a>Background</h2> <p>My use case involves building a background service that handles data retention. The service should be able to handle multiple requests and be tolerant to failures during deletion handling. To achieve this, I need to store the states of running operations so that they can be checked during failure recovery or regular reboot/deployment.</p> <p>To receive requests, I’ll use a message broker like Kafka. The service will receive messages with a <code>JobId</code> and a condition specifying which data to delete. After the deletion is completed, the service will commit the message. If the service is restarted or fails, it will receive the uncommitted message again.</p> <h2 id="solution"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#solution">#</a>Solution</h2> <p>A straightforward solution is to store the state in another MongoDB collection. However, storing the state may be redundant since the only need for that state is to tell if the operation was completed, and if not, whether it is running or failed.</p> <p>Most of the databases I’ve worked with have special tables or views with information about all running queries, and MongoDB is no exception. It has a special query called <a href="https://www.mongodb.com/docs/manual/reference/method/db.currentOp/" rel="nofollow">db.currentOp()</a> that returns a document with information about all running queries.</p> <p>However, this API has limitations caused by MongoDB specifics. So, there’s a more modern way of retrieving running queries: the <a href="https://www.mongodb.com/docs/manual/reference/operator/aggregation/currentOp/" rel="nofollow">$currentOp</a> stage for the aggregation pipeline. It works like a regular stage and can be combined with other aggregation features like projection and grouping. I’ll use this approach for my solution.</p> <p>There are several things to keep in mind:</p> <ol><li><p>The aggregation pipeline with this stage should be run on the <code>admin</code> collection, and you need a special user to access it via your application.</p></li> <li><p>This command returns operations that are started on a specific MongoDB node. If you’re using a sharded cluster like we are, you need to run <code>$currentOp</code> on the router that started the specific delete operation. It’s not a big deal, though; you can run this query against all routers in parallel and check if any have it.</p></li> <li><p>You need to distinguish delete operations started by your service from normal operations. In our case, all data retention tasks have a <code>JobId</code>, which is a unique key for the operation. All we need is a way to mark MongoDB queries with this key.</p></li></ol> <p>If we look through the output format for <code>$currentOp</code>, we’ll notice that it has a <a href="https://www.mongodb.com/docs/manual/reference/command/currentOp/#mongodb-data-currentOp.command" rel="nofollow">comment</a> field that can be attached when a command is started. Some queries (e.g., <code>find</code>) support the <a href="https://www.mongodb.com/docs/manual/reference/operator/query/comment/" rel="nofollow">$comment</a> operator, but the most universal way to pass a comment is to run a query via a <a href="https://www.mongodb.com/docs/manual/reference/command/#database-commands" rel="nofollow">database command</a>. With this API, we can run the delete command and pass the <code>JobId</code> into the comment field.</p> <h2 id="example"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#example">#</a>Example</h2> <p>Now, let’s look at some MongoDB shell examples.</p> <h3 id="starting-delete-operation-with-jobid"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#starting-delete-operation-with-jobid">#</a>Starting delete operation with “JobId”</h3> <p>To pass <code>JobId</code> into the comment when we start the delete operation, we can use the following command:</p> <!> <p>This MongoDB query is designed to delete all documents from the <code>"Events"</code> collection where the <code>"clientId"</code> field equals <code>0</code>. The query is executed using the <code>runCommand</code> method, which takes a single argument that is a document representing the command to be executed.</p> <p>The command document contains several fields:</p> <ul><li><p><code>"delete"</code>: This field specifies the name of the collection to delete documents from, which is <code>"Events"</code> in this case.</p></li> <li><p><code>"ordered"</code>: This field specifies whether the deletion operation should be executed in order, with each deletion waiting for the previous one to complete before starting. In this case, it is set to false, indicating that the deletion operations can be executed in parallel.</p></li> <li><p><code>"comment"</code>: This field is an optional comment that can be included in the command. It has no effect on the operation itself, but will be highly useful in further command below.</p></li> <li><p><code>"deletes"</code>: This field contains an array of objects, each representing a deletion operation to be executed. In this case, there is only one object, which contains two fields:</p> <ul><li><p><code>"q"</code>: This field specifies the query that will be used to match documents to be deleted. In this case, the query is searching for documents where the <code>"clientId"</code> field equals 0.</p></li> <li><p><code>"limit"</code>: This field specifies the maximum number of documents to delete. In this case, it is set to 0, indicating that all documents matching the query should be deleted.</p></li></ul></li></ul> <p>When executed, this query will delete all documents from the <code>"Events"</code> collection where the <code>"clientId"</code> field equals <code>0</code>. The deletion will be executed in parallel and there is no limit to the number of documents that can be deleted. The optional comment included in the command document is “job:blog-test”, which is our <code>JobId</code>.</p> <h3 id="finding-running-operation-by-jobid"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#finding-running-operation-by-jobid">#</a>Finding running operation by “JobId”</h3> <p>MongoDB query below uses the aggregate method to find a specific operation that has a JobId in its command.comment field:</p> <!> <p>The first stage of the pipeline is <code>$currentOp</code>, which returns information about the current operations running on the server. The <code>localOps</code> option is set to <code>true</code>, which limits the output to only show operations running on the same node as the query.</p> <p>The second stage is <code>$match</code>, which filters the running operations based on a specific condition. In this case, it matches operations that have a comment field in their command object that matches the value “job:blog-test”.</p> <p>The third stage is <code>$limit</code>, which limits the output to the first document that matches the filter. Since we are looking for a single operation, we must set the limit to <code>1</code>.</p> <p>In summary, this query finds the first operation running on the current node that has a <code>JobId</code> in its command.comment field equal to <code>"job:blog-test"</code>.</p> <p>If an operation with such a comment is running on the current node (or router), we’ll receive a single document, containing all the info about operation with specified <code>JobId</code>:</p> <!>',1);function Va(t){var a=Sa(),n=e(K(a),30);i(n,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">db</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">runCommand</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#F07178;--shiki-dark:#E1E4E8">  delete</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">:</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">Events</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#F07178;--shiki-dark:#E1E4E8">  ordered</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">:</span><span style="color:#FF9CAC;--shiki-dark:#79B8FF"> false</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#F07178;--shiki-dark:#E1E4E8">  comment</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">:</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">job:blog-test</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#F07178;--shiki-dark:#E1E4E8">  deletes</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">:</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#F07178;--shiki-dark:#E1E4E8">      q</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">:</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#123;</span><span style="color:#F07178;--shiki-dark:#E1E4E8"> clientId</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">:</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 0</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#125;,</span></span>
<span class="line"><span style="color:#F07178;--shiki-dark:#E1E4E8">      limit</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">:</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 0</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;,</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">  ]</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">)</span></span></code></pre>`);var o=e(n,14);i(o,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">db</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">aggregate</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">([</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">  &#123;</span><span style="color:#F07178;--shiki-dark:#E1E4E8"> $currentOp</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">:</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#123;</span><span style="color:#F07178;--shiki-dark:#E1E4E8"> localOps</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">:</span><span style="color:#FF9CAC;--shiki-dark:#79B8FF"> true</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#125;</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#125;,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">  &#123;</span><span style="color:#F07178;--shiki-dark:#E1E4E8"> $match</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">:</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#123;</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#F07178;--shiki-dark:#9ECBFF">command.comment</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">:</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">job:blog-test</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#125;</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#125;,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">  &#123;</span><span style="color:#F07178;--shiki-dark:#E1E4E8"> $limit</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">:</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 1</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#125;,</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">])</span></span></code></pre>`);var l=e(o,12);i(l,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">    "</span><span style="color:#C792EA;--shiki-dark:#79B8FF">type</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">op</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">    "</span><span style="color:#C792EA;--shiki-dark:#79B8FF">host</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">f0fde895fb50:27017</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">    "</span><span style="color:#C792EA;--shiki-dark:#79B8FF">desc</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">conn65</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">    "</span><span style="color:#C792EA;--shiki-dark:#79B8FF">connectionId</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 65</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">    "</span><span style="color:#C792EA;--shiki-dark:#79B8FF">client</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">172.18.0.1:57176</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">    "</span><span style="color:#C792EA;--shiki-dark:#79B8FF">appName</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">MongoDB Shell</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">    "</span><span style="color:#C792EA;--shiki-dark:#79B8FF">clientMetadata</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#123;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">        "</span><span style="color:#FFCB6B;--shiki-dark:#79B8FF">application</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#123;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">            "</span><span style="color:#F78C6C;--shiki-dark:#79B8FF">name</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">MongoDB Shell</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#125;,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">        "</span><span style="color:#FFCB6B;--shiki-dark:#79B8FF">driver</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#123;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">            "</span><span style="color:#F78C6C;--shiki-dark:#79B8FF">name</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">MongoDB Internal Client</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">            "</span><span style="color:#F78C6C;--shiki-dark:#79B8FF">version</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">4.2.6-18-g6cdb6ab</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#125;,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">        "</span><span style="color:#FFCB6B;--shiki-dark:#79B8FF">os</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#123;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">            "</span><span style="color:#F78C6C;--shiki-dark:#79B8FF">type</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">Windows</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">            "</span><span style="color:#F78C6C;--shiki-dark:#79B8FF">name</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">Microsoft Windows 8</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">            "</span><span style="color:#F78C6C;--shiki-dark:#79B8FF">architecture</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">x86_64</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">            "</span><span style="color:#F78C6C;--shiki-dark:#79B8FF">version</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">6.2 (build 9200)</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#125;,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">        "</span><span style="color:#FFCB6B;--shiki-dark:#79B8FF">mongos</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#123;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">            "</span><span style="color:#F78C6C;--shiki-dark:#79B8FF">host</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">f0fde895fb50:27017</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">            "</span><span style="color:#F78C6C;--shiki-dark:#79B8FF">client</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">172.18.0.1:57176</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">            "</span><span style="color:#F78C6C;--shiki-dark:#79B8FF">version</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">4.4.11</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">    "</span><span style="color:#C792EA;--shiki-dark:#79B8FF">active</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#79B8FF"> true</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">    "</span><span style="color:#C792EA;--shiki-dark:#79B8FF">currentOpTime</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">2022-04-19T22:01:50.629+00:00</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">    "</span><span style="color:#C792EA;--shiki-dark:#79B8FF">opid</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 996</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">    "</span><span style="color:#C792EA;--shiki-dark:#79B8FF">lsid</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#123;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">        "</span><span style="color:#FFCB6B;--shiki-dark:#79B8FF">id</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#BABED8;font-style:inherit;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic"> UUID(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">e42b457e-bc01-4ffa-83dc-343f1f6ea351</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#BABED8;font-style:inherit;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">)</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">        "</span><span style="color:#FFCB6B;--shiki-dark:#79B8FF">uid</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#123;</span><span style="color:#89DDFF;--shiki-dark:#79B8FF"> "</span><span style="color:#F78C6C;--shiki-dark:#79B8FF">$binary</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU=</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#89DDFF;--shiki-dark:#79B8FF"> "</span><span style="color:#F78C6C;--shiki-dark:#79B8FF">$type</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">00</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">    "</span><span style="color:#C792EA;--shiki-dark:#79B8FF">secs_running</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#BABED8;font-style:inherit;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic"> NumberLong(</span><span style="color:#F78C6C;--shiki-dark:#79B8FF">3</span><span style="color:#BABED8;font-style:inherit;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">)</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">    "</span><span style="color:#C792EA;--shiki-dark:#79B8FF">microsecs_running</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#BABED8;font-style:inherit;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic"> NumberLong(</span><span style="color:#F78C6C;--shiki-dark:#79B8FF">3406911</span><span style="color:#BABED8;font-style:inherit;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">)</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">    "</span><span style="color:#C792EA;--shiki-dark:#79B8FF">op</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">remove</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">    "</span><span style="color:#C792EA;--shiki-dark:#79B8FF">ns</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">testdb.Events</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">    "</span><span style="color:#C792EA;--shiki-dark:#79B8FF">command</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#123;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">        "</span><span style="color:#FFCB6B;--shiki-dark:#79B8FF">delete</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">Events</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">        "</span><span style="color:#FFCB6B;--shiki-dark:#79B8FF">ordered</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#79B8FF"> false</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">        "</span><span style="color:#FFCB6B;--shiki-dark:#79B8FF">comment</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">job:blog-test</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">        "</span><span style="color:#FFCB6B;--shiki-dark:#79B8FF">lsid</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#123;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">            "</span><span style="color:#F78C6C;--shiki-dark:#79B8FF">id</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#BABED8;font-style:inherit;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic"> UUID(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">e42b457e-bc01-4ffa-83dc-343f1f6ea351</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#BABED8;font-style:inherit;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#125;,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">        "</span><span style="color:#FFCB6B;--shiki-dark:#79B8FF">$clusterTime</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#123;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">            "</span><span style="color:#F78C6C;--shiki-dark:#79B8FF">clusterTime</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#BABED8;font-style:inherit;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic"> Timestamp(</span><span style="color:#F78C6C;--shiki-dark:#79B8FF">1650405661</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#BABED8;font-style:inherit;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic"> 34),</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">            "</span><span style="color:#F78C6C;--shiki-dark:#79B8FF">signature</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#123;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">                "</span><span style="color:#F07178;--shiki-dark:#79B8FF">hash</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#123;</span><span style="color:#89DDFF;--shiki-dark:#79B8FF"> "</span><span style="color:#916B53;--shiki-dark:#79B8FF">$binary</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">AAAAAAAAAAAAAAAAAAAAAAAAAAA=</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#89DDFF;--shiki-dark:#79B8FF"> "</span><span style="color:#916B53;--shiki-dark:#79B8FF">$type</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">00</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#125;,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">                "</span><span style="color:#F07178;--shiki-dark:#79B8FF">keyId</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#BABED8;font-style:inherit;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic"> NumberLong(</span><span style="color:#F78C6C;--shiki-dark:#79B8FF">0</span><span style="color:#BABED8;font-style:inherit;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">            &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#125;,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">        "</span><span style="color:#FFCB6B;--shiki-dark:#79B8FF">$readPreference</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#123;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">            "</span><span style="color:#F78C6C;--shiki-dark:#79B8FF">mode</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">secondaryPreferred</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#125;,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">        "</span><span style="color:#FFCB6B;--shiki-dark:#79B8FF">$db</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">testdb</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">    "</span><span style="color:#C792EA;--shiki-dark:#79B8FF">numYields</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 0</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">    "</span><span style="color:#C792EA;--shiki-dark:#79B8FF">waitingForLatch</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#123;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">        "</span><span style="color:#FFCB6B;--shiki-dark:#79B8FF">timestamp</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#BABED8;font-style:inherit;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic"> ISODate(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">2022-04-19T22:01:47.323Z</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#BABED8;font-style:inherit;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">)</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#79B8FF">        "</span><span style="color:#FFCB6B;--shiki-dark:#79B8FF">captureName</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF"> "</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">ProducerConsumerQueue::_mutex</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`),B(t,a)}const Ma=Object.freeze(Object.defineProperty({__proto__:null,default:Va,metadata:ea},Symbol.toStringTag,{value:"Module"})),na={date:"2024-02-18",tags:["C#"],keywords:["C#","Visitors Pattern","Type pattern matching","switch keyword"],title:"Fixing C# type pattern-matching",preview:"Craving Kotlin's secure pattern matching on sealed classes for your C# code? Discover how the Visitor Pattern can satisfy your longing!",draft:!1,hero:"/images/blog/007-fixing-csharp-type-pattern-matching/hero.jpg"},{date:yn,tags:En,keywords:Dn,title:mn,preview:un,draft:Bn,hero:gn}=na;var za=_('<p>Hello there! Are you looking for ways to make your code more robust, maintainable, and less prone to runtime errors? Well, buckle up because today we’re going to explore how to substitute type pattern matching in C# with the Visitors pattern. Yes, I know it sounds a bit strange, but stick with me, and you’ll see how this can help you write better code.</p> <h2 id="task-example-validation-of-property-values"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#task-example-validation-of-property-values">#</a>Task example: Validation of property values</h2> <p>So let’s start with an example. Imagine we have a marker interface for some property value - <code>IValue</code>. It has two implementations - <code>StringValue</code> and <code>NumericValue</code>, holding <code>string</code> and <code>long</code> values respectively.</p> <!> <p>As an example, let’s implement validation of those values. We write a static helper function <code>IsValid</code>, which accepts <code>IValue</code> and returns a boolean value: <code>true</code> if the value is valid, <code>false</code> otherwise. We do it in a straightforward way - just make a <code>switch</code> expression with branches for <code>StringValue</code> and <code>NumericValue</code> types. But for our <code>switch</code> to be exhaustive, we’re forced to make a default branch with throwing <code>UnreachableException</code>.</p> <!> <p>So a simple console application that spins the gears of our code will look like that:</p> <!> <p>Let’s test it:</p> <!> <h2 id="the-issue"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#the-issue">#</a>The issue</h2> <p>At first glance everything looks fine! But what if we have dozens of such type pattern matching across the project, and some other developer introduces a new type for a value, for example, <code>DateTimeValue</code>?</p> <p>In that case, he or she needs to find all usages of pattern matching for <code>IValue</code> and add a branch for the new type. And also write tests to check that we won’t have an <code>UnreachableException</code> thrown at runtime:</p> <!> <p>As our case is very simple, still, let’s imaging that our imaginary developer implemented only parsing of the new type, but forgot to handle it in our helper function.</p> <!> <p>So, you may already guess what will happen if we pass <code>2024-02-18T19:38:37Z</code> to our CLI input.</p> <!> <p>We found a bug! (how surprisingly, ha-ha)</p> <p>Imaging that this will happen in production during the midnight while you’re on-call. <strong>Not so funny now, huh?</strong></p> <h2 id="solution-visitor-pattern"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#solution-visitor-pattern">#</a>Solution: Visitor Pattern</h2> <p>I’m sure that this bug can be found with tests or during code-review. But can we have a compilation error, indicating what places to fix? Like in Kotlin or Java with sealed interfaces and classes that allow creating an exhaustive <code>when</code> expression without a default branch and receiving compilation errors when a new type is not handled.</p> <p>Unfortunately, in C# we don’t have language support for that yet. But surprisingly, an old-fashioned OOP pattern called <a href="https://refactoring.guru/design-patterns/visitor" rel="nofollow">Visitor</a> can help us achieve that. We can add a generic <code>Accept&lt;T&gt;</code> method for <code>IValue</code>, which accepts <code>IValueVisitor&lt;T&gt;</code> and returns a value of type <code>T</code>.</p> <!> <p>Interface <code>IValueVisitor&lt;T&gt;</code> has methods <code>Accept</code>, with overloads, each accepting an implementation of <code>IValue</code> interface as a parameter and returning a value of generic type <code>T</code>.</p> <!> <p>In all <code>IValue</code> implementations, we just call <code>visitor.Visit(this)</code> and return the value from this invocation:</p> <!> <p>We can rewrite a helper validation function to a class <code>ValueValidationVisitor</code>, that for each <code>Visit</code> overload performs the same check as it was done for the static function described above, generic type parameter in that case will be <code>bool</code>. Here’s how it looks like:</p> <!> <p>When a developer adds a new class implementing <code>IValue</code>, for example, <code>DateTimeValue</code>, we need to implement an <code>Accept</code> method, which should invoke the visitor’s <code>Visit</code> method:</p> <!> <p>But there’s no such overload at <code>IValueVisitor&lt;T&gt;</code> that accepts <code>DateTimeValue</code> value, so we’ve got to add it into <code>IValueVisitor&lt;T&gt;</code> and implement it all over visitor’s implementations:</p> <!> <p>So after all tons of code we’ve written, we can now change the console app and use <code>ValueValidationVisitor</code> instead of <code>ValidationHelper</code>. There’s also a singleton instance of <code>ValueValidationVisitor</code> that we can use in client code, so let’s do it.</p> <!> <p>Voilà, now not only the bug is fixed, but also the chance of missed type handling is reduced, so in overall we strengthen our type-safety guarantees.</p> <h2 id="final-thoughts"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#final-thoughts">#</a>Final thoughts</h2> <p>However Visitor pattern is a lot more verbose than simple switch statement or expression, we are now almost absolutely sure that the developer doesn’t miss to handle its new type. And as a reviewer, one will see all places that were changed in git diff without the need to double-check in the code of the project.</p> <p>So there you have it! By using Visitor pattern, you can make your C# code more maintainable and less prone to runtime errors, especially when adding new types or modifying existing ones. It may not be as elegant or concise, but it can save you a lot of headaches in the long run. If you want to see code - check it in <a href="https://github.com/AxelUser/TypePatternMatchingOnVisitors" rel="nofollow">this</a> repository.</p> <p>And remember, a little bit of extra verbosity is worth the peace of mind!</p>',1);function Ha(t){var a=za(),n=e(K(a),6);i(n,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> interface</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> IValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#123;</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> &#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> record</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> StringValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">?</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Value</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> IValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> record</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> NumericValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">long</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Value</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> IValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span></code></pre>`);var o=e(n,4);i(o,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#C792EA;--shiki-dark:#F97583"> static</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> class</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> ValidationHelper</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#C792EA;--shiki-dark:#F97583"> static</span><span style="color:#89DDFF;--shiki-dark:#F97583"> bool</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> IsValid</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">IValue</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> value</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#123;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">        return</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> value </span><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">switch</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#123;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">            StringValue</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> stringValue</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =></span><span style="color:#89DDFF;--shiki-dark:#F97583"> !</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">IsNullOrWhiteSpace</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">stringValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">Value</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">            NumericValue</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> numericValue</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =></span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> numericValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">Value </span><span style="color:#89DDFF;--shiki-dark:#F97583">>=</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 0</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#79B8FF">            _</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =></span><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit"> throw</span><span style="color:#89DDFF;--shiki-dark:#F97583"> new</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> UnreachableException</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">        &#125;;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">    &#125;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var l=e(o,4);i(l,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">while</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> (</span><span style="color:#FF9CAC;--shiki-dark:#79B8FF">true</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    Console</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">Write</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">Write a property value: </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">    var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> input</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> Console</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">ReadLine</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">    var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> value</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Parse</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">input</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    Console</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">WriteLine</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">$"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">Value '</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">input</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#125;</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">' is valid: </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#F97583"> +</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> ValidationHelper</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">IsValid</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">value</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">));</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">    </span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">static</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> IValue</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Parse</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">?</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> value</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">    if</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> (</span><span style="color:#89DDFF;--shiki-dark:#F97583">long</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">TryParse</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">value</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#C792EA;--shiki-dark:#F97583"> out</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> num</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">))</span><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit"> return</span><span style="color:#89DDFF;--shiki-dark:#F97583"> new</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> NumericValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">num</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">    return</span><span style="color:#89DDFF;--shiki-dark:#F97583"> new</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> StringValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">value</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var p=e(l,4);i(p,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span>Write a property value: foo</span></span>
<span class="line"><span>Value 'foo' is valid: True</span></span>
<span class="line"><span>Write a property value: 1 </span></span>
<span class="line"><span>Value '1' is valid: True</span></span>
<span class="line"><span>Write a property value: -42</span></span>
<span class="line"><span>Value '-42' is valid: False</span></span></code></pre>`);var r=e(p,8);i(r,()=>'<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> record</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> DateTimeValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">DateTimeOffset</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Value</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> IValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span></code></pre>');var c=e(r,4);i(c,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">static</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> IValue</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Parse</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">?</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> value</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">    if</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> (</span><span style="color:#89DDFF;--shiki-dark:#F97583">long</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">TryParse</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">value</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#C792EA;--shiki-dark:#F97583"> out</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> num</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">))</span><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit"> return</span><span style="color:#89DDFF;--shiki-dark:#F97583"> new</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> NumericValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">num</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit">    // Parsing date, no other changes!</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">    if</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> (</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">DateTimeOffset</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">TryParse</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">value</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">,</span><span style="color:#C792EA;--shiki-dark:#F97583"> out</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> dateTime</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">))</span><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit"> return</span><span style="color:#89DDFF;--shiki-dark:#F97583"> new</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> DateTimeValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">dateTime</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">    return</span><span style="color:#89DDFF;--shiki-dark:#F97583"> new</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> StringValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">value</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var d=e(c,4);i(d,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span>Write a property value: 2024-02-18T19:38:37Z</span></span>
<span class="line"><span>Unhandled exception. System.Diagnostics.UnreachableException: The program executed an instruction that was thought to be unreachable.                                </span></span>
<span class="line"><span>   at TypePatternMatchingOnVisitors.ValidationHelper.IsValid(IValue value) in C:UsersAxelUprojectslearnTypePatternMatchingOnVisitorsValidationHelper.cs:line 13</span></span>
<span class="line"><span>   at Program.&#x3C;Main>$(String[] args) in C:UsersAxelUprojectslearnTypePatternMatchingOnVisitorsProgram.cs:line 8                                                </span></span>
<span class="line"><span></span></span>
<span class="line"><span>Process finished with exit code -532,462,766.</span></span></code></pre>`);var h=e(d,12);i(h,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> interface</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> IValue</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    T</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Accept</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">>(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">IValueVisitor</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> visitor</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var k=e(h,4);i(k,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> interface</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> IValueVisitor</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#C792EA;--shiki-dark:#F97583">out</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    T</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Visit</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">StringValue</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> stringValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    T</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Visit</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">NumericValue</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> numericValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var D=e(k,4);i(D,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> record</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> StringValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">?</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Value</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">):</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> IValue</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> T</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Accept</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">>(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">IValueVisitor</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> visitor</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =></span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> visitor</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">Visit</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">this</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit">// ... same for other IValue implementations</span></span></code></pre>`);var u=e(D,4);i(u,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> class</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> ValueValidationVisitor</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">:</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> IValueVisitor</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#89DDFF;--shiki-dark:#F97583">bool</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#89DDFF;--shiki-dark:#F97583"> bool</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Visit</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">StringValue</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> stringValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =></span><span style="color:#89DDFF;--shiki-dark:#F97583"> !</span><span style="color:#89DDFF;--shiki-dark:#F97583">string</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">IsNullOrWhiteSpace</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">stringValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">Value</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#89DDFF;--shiki-dark:#F97583"> bool</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Visit</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">NumericValue</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> numericValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =></span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> numericValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">Value </span><span style="color:#89DDFF;--shiki-dark:#F97583">>=</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 0</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var A=e(u,4);i(A,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> record</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> DateTimeValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">DateTimeOffset</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Value</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> :</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> IValue</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit">    // Compilation error - we don't implement Visit for this value type yet!</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> T</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Accept</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">>(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">IValueVisitor</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> visitor</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =></span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> visitor</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">Visit</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#79B8FF">this</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var C=e(A,4);i(C,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> interface</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> IValueVisitor</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#C792EA;--shiki-dark:#F97583">out</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> T</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit">    // ... other Visit overloads</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#B392F0">    T</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Visit</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">DateTimeValue</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> dateTimeValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">public</span><span style="color:#FFCB6B;--shiki-dark:#F97583"> class</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> ValueValidationVisitor</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">:</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> IValueVisitor</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#89DDFF;--shiki-dark:#F97583">bool</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit">    // singleton for visitor cause it's stateless and safe to share between IValue instances</span></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#C792EA;--shiki-dark:#F97583"> static</span><span style="color:#C792EA;--shiki-dark:#F97583"> readonly</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> ValueValidationVisitor</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> Instance</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#89DDFF;--shiki-dark:#F97583"> new</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit">    // ... other Visit overloads</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;--shiki-dark:#F97583">    public</span><span style="color:#89DDFF;--shiki-dark:#F97583"> bool</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Visit</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#FFCB6B;--shiki-dark:#B392F0">DateTimeValue</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> dateTimeValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =></span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> dateTimeValue</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">Value </span><span style="color:#89DDFF;--shiki-dark:#F97583">&#x3C;=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> DateTimeOffset</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">UtcNow</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span>
<span class="line"></span></code></pre>`);var T=e(C,4);i(T,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">while</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8"> (</span><span style="color:#FF9CAC;--shiki-dark:#79B8FF">true</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#123;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    Console</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">Write</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">Write a property value: </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">    var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> input</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> Console</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">ReadLine</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#FFCB6B;--shiki-dark:#F97583">    var</span><span style="color:#FFCB6B;--shiki-dark:#B392F0"> value</span><span style="color:#89DDFF;--shiki-dark:#F97583"> =</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> Parse</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">input</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit">    //Console.WriteLine($"Value '&#123;input&#125;' is valid: " + ValidationHelper.IsValid(value));    </span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    Console</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">WriteLine</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">$"</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">Value '</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#123;</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">input</span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">&#125;</span><span style="color:#C3E88D;--shiki-dark:#9ECBFF">' is valid: </span><span style="color:#89DDFF;--shiki-dark:#9ECBFF">"</span><span style="color:#89DDFF;--shiki-dark:#F97583"> +</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> value</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#82AAFF;--shiki-dark:#B392F0">Accept</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">(</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">ValueValidationVisitor</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">.</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">Instance</span><span style="color:#89DDFF;--shiki-dark:#E1E4E8">));</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">    </span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`),z(10),B(t,a)}const Pa=Object.freeze(Object.defineProperty({__proto__:null,default:Ha,metadata:na},Symbol.toStringTag,{value:"Module"})),Wa=16,ja=4;function Vs(t,a){let n=5381;for(let o=0;o<t.length;o++)n=(n<<5)+n+t.charCodeAt(o)>>>0;return n%a}function Ms(t,a){let n=0;for(let l=0;l<t.length;l++)n=t.charCodeAt(l)+(n<<6)+(n<<16)-n>>>0;let o=n%a;return o===0&&(o=1),a%2===0&&o%2===0&&(o=o===a-1?1:o+1),o}function qa(t,a){return(t%a+a)%a}function ys(t,a,n){if(!t||a<=0||n<=0)return[];const o=Vs(t,a),l=Ms(t,a),p=[];for(let r=0;r<n;r++){const c=qa(o+r*l,a);p.push(c)}return p.sort((r,c)=>r-c)}class Oa{constructor(a,n){Ts(this,"bitArray");Ts(this,"size");Ts(this,"numHashFunctions");this.size=a,this.numHashFunctions=n,this.bitArray=new Array(a).fill(!1)}generateInsertSteps(a){const n=[],o=Vs(a,this.size),l=Ms(a,this.size);n.push({type:"hash1",value:o}),n.push({type:"hash2",value:l});const p=ys(a,this.size,this.numHashFunctions),r=new Array(this.size).fill("0");return p.forEach(c=>r[c]="1"),n.push({type:"binary",value:r.join("")}),p.forEach(c=>{const d=this.bitArray[c];n.push({type:"setBit",index:c,wasSet:d})}),n}generateCheckSteps(a){const n=[],o=Vs(a,this.size),l=Ms(a,this.size);n.push({type:"hash1",value:o}),n.push({type:"hash2",value:l});const p=ys(a,this.size,this.numHashFunctions),r=new Array(this.size).fill("0");return p.forEach(c=>r[c]="1"),n.push({type:"binary",value:r.join("")}),p.forEach(c=>{n.push({type:"setBit",index:c,wasSet:this.bitArray[c]})}),n}insert(a){ys(a,this.size,this.numHashFunctions).forEach(o=>{this.bitArray[o]=!0})}check(a){return ys(a,this.size,this.numHashFunctions).every(o=>this.bitArray[o])}getBitArray(){return[...this.bitArray]}reset(){this.bitArray.fill(!1)}getHashValues(a){return{h1:Vs(a,this.size),h2:Ms(a,this.size)}}getBinaryRepresentation(a){const n=ys(a,this.size,this.numHashFunctions),o=new Array(this.size).fill("0");return n.forEach(l=>o[l]="1"),o.join("")}getSize(){return this.size}}var Ra=_("<div> </div>"),La=_('<span class="index svelte-rx78hf"> </span>'),Na=_('<div class="bit-segment svelte-rx78hf"><div class="segment-bits svelte-rx78hf"></div> <div class="segment-indices svelte-rx78hf"></div></div>');function $s(t,a){zs(a,!0);const n=H(a,"type",3,"bitarray"),o=H(a,"highlightedBits",19,()=>new Set),l=H(a,"bitColors",19,()=>new Map);var p=Na(),r=y(p);Ds(r,21,()=>a.bits,ms,(d,h,k)=>{var D=Ra();const u=w(()=>a.startIndex+k);let A;var C=y(D,!0);F(D),J(T=>{A=us(D,1,"bit svelte-rx78hf",null,A,T),N(C,n()==="binary"?s(h):s(h)?"1":"0")},[()=>({active:n()==="binary"&&s(h)==="1",set:n()==="bitarray"&&s(h)===!0,highlighted:o().has(s(u)),blue:l().get(s(u))==="blue",red:l().get(s(u))==="red"})]),B(d,D)}),F(r);var c=e(r,2);Ds(c,21,()=>a.bits,ms,(d,h,k)=>{var D=La();const u=w(()=>a.startIndex+k);var A=y(D,!0);F(D),J(()=>N(A,s(u))),B(d,D)}),F(c),F(p),B(t,p),Hs()}var Ga=_('<div class="unit svelte-ooecwa"> </div>'),$a=_('<div class="description svelte-ooecwa"> </div>'),Ua=_('<div><div class="label svelte-ooecwa"> </div> <div> </div> <!> <!></div>');function Y(t,a){const n=H(a,"variant",3,"default"),o=H(a,"showEmpty",3,!0),l=w(()=>a.value===null||a.value===void 0||a.value===""),p=w(()=>s(l)&&!o()?"—":a.value);var r=Ua();let c;var d=y(r),h=y(d,!0);F(d);var k=e(d,2);let D;var u=y(k,!0);F(k);var A=e(k,2);{var C=f=>{var x=Ga(),P=y(x,!0);F(x),J(()=>N(P,a.unit)),B(f,x)};ls(A,f=>{a.unit&&f(C)})}var T=e(A,2);{var S=f=>{var x=$a(),P=y(x,!0);F(x),J(()=>N(P,a.description)),B(f,x)};ls(T,f=>{a.description&&f(S)})}F(r),J((f,x)=>{c=us(r,1,"display-card svelte-ooecwa",null,c,f),N(h,a.label),D=us(k,1,"value svelte-ooecwa",null,D,x),N(u,s(p))},[()=>({compact:n()==="compact",elevated:n()==="elevated",centered:n()==="centered",empty:s(l)&&!o()}),()=>({fade:s(l)&&!o()})]),B(t,r)}var Ya=_('<label class="svelte-qse8j9"> </label>'),Ja=_('<div class="input-group svelte-qse8j9"><!> <input class="svelte-qse8j9"></div>');function Es(t,a){zs(a,!0);let n=H(a,"value",15),o=H(a,"type",3,"text"),l=H(a,"disabled",3,!1),p=H(a,"required",3,!1);const r=w(()=>a.id||`input-${Math.random().toString(36).substr(2,9)}`);var c=Ja(),d=y(c);{var h=D=>{var u=Ya(),A=y(u);F(u),J(()=>{ts(u,"for",s(r)),N(A,`${a.label??""}${p()?"*":""}`)}),B(D,u)};ls(d,D=>{a.label&&D(h)})}var k=e(d,2);Os(k),F(c),J(()=>{ts(k,"id",s(r)),ts(k,"type",o()),ts(k,"placeholder",a.placeholder),k.disabled=l(),ts(k,"min",a.min),ts(k,"max",a.max),ts(k,"step",a.step),k.required=p()}),ya(k,n),B(t,c),Hs()}var Ka=_('<div><h3 class="svelte-5o5yhn"> </h3> <!></div>');function ia(t,a){const n=H(a,"variant",3,"default"),o=H(a,"cardVariant",3,"compact");var l=Ka();let p;var r=y(l),c=y(r,!0);F(r);var d=e(r,2);Ds(d,17,()=>a.parameters,ms,(h,k)=>{Y(h,{get label(){return s(k).label},get value(){return s(k).value},get unit(){return s(k).unit},get description(){return s(k).description},get variant(){return o()}})}),F(l),J(h=>{p=us(l,1,"parameters-section svelte-5o5yhn",null,p,h),N(c,a.title)},[()=>({sticky:n()==="sticky"})]),B(t,l)}var Xa=_('<div class="binary-grid svelte-1hmxjsx"></div>'),Qa=_('<div class="binary-placeholder svelte-1hmxjsx"><span class="placeholder svelte-1hmxjsx">— Nothing yet —</span></div>'),Za=_('<div class="input-section svelte-1hmxjsx"><!> <div class="button-group svelte-1hmxjsx"><!> <!> <!></div></div>'),se=_('<div class="result-display svelte-1hmxjsx"><span class="operation svelte-1hmxjsx"> </span> <span> </span></div>'),ae=_('<div class="bloom-filter-container svelte-1hmxjsx"><div class="layout svelte-1hmxjsx"><div class="main-content svelte-1hmxjsx"><div class="hash-display svelte-1hmxjsx"><!> <!></div> <div class="binary-display svelte-1hmxjsx"><label class="svelte-1hmxjsx">Mapped Bits:</label> <!></div> <!> <!> <div class="binary-display svelte-1hmxjsx"><label class="svelte-1hmxjsx">Bit Array:</label> <div class="binary-grid svelte-1hmxjsx"></div></div></div> <div class="parameters-column svelte-1hmxjsx"><!></div></div></div>');function ee(t,a){zs(a,!0);const n=H(a,"size",3,Wa),o=H(a,"numHashFunctions",3,ja),l=H(a,"stepDuration",3,1500),p=H(a,"userInputEnabled",3,!0),r=H(a,"autoAnimate",3,!0);let c=M(""),d=M(!1),h=M(Is([])),k=M(null),D=M(null),u=M(null),A=M(null),C=M(""),T=M(Is(new Set)),S=M(Is(new Map)),f=w(()=>new Oa(n(),o())),x=M(Is([]));ka(()=>{m(x,s(f).getBitArray(),!0)});const P=w(o),R=w(n);function X(){m(u,null),m(A,null),m(C,""),s(T).clear(),s(S).clear(),m(D,null)}async function Q(g,v){if(!(s(d)||!v.trim())){m(d,!0),m(k,g,!0),X(),g==="insert"?m(h,s(f).generateInsertSteps(v),!0):m(h,s(f).generateCheckSteps(v),!0);for(let I=0;I<s(h).length;I++){const b=s(h)[I];switch(b.type){case"hash1":m(u,b.value,!0);break;case"hash2":m(A,b.value,!0);break;case"binary":m(C,b.value,!0);break;case"setBit":s(T).add(b.index),g==="insert"?(s(S).set(b.index,b.wasSet?"red":"blue"),b.wasSet||(s(x)[b.index]=!0)):s(S).set(b.index,b.wasSet?"blue":"red"),m(T,new Set(s(T)),!0),m(S,new Map(s(S)),!0),m(x,[...s(x)],!0);break}r()&&I<s(h).length-1&&await new Promise(W=>setTimeout(W,l()))}g==="insert"?(s(f).insert(v),m(D,!0)):m(D,s(f).check(v),!0),m(x,s(f).getBitArray(),!0),r()&&setTimeout(()=>{s(T).clear(),s(S).clear(),m(T,new Set,!0),m(S,new Map,!0)},l()),m(d,!1)}}async function G(){p()&&(await Q("insert",s(c)),m(c,""))}async function Z(){p()&&(await Q("check",s(c)),m(c,""))}function es(){s(d)||(s(f).reset(),m(x,s(f).getBitArray(),!0),X())}const L=w(()=>s(x).reduce((g,v,I)=>{const b=Math.floor(I/4);return g[b]||(g[b]=[]),g[b].push(v),g},[])),os=w(()=>s(C).split("").reduce((g,v,I)=>{const b=Math.floor(I/4);return g[b]||(g[b]=[]),g[b].push(v),g},[]));var q=ae(),rs=y(q),$=y(rs),ss=y($),U=y(ss);Y(U,{label:"Hash 1:",get value(){return s(u)},variant:"centered",showEmpty:!1});var ps=e(U,2);Y(ps,{label:"Hash 2:",get value(){return s(A)},variant:"centered",showEmpty:!1}),F(ss);var as=e(ss,2),ns=e(y(as),2);{var cs=g=>{var v=Xa();Ds(v,21,()=>s(os),ms,(I,b,W)=>{$s(I,{get bits(){return s(b)},startIndex:W*4,type:"binary"})}),F(v),B(g,v)},ds=g=>{var v=Qa();B(g,v)};ls(ns,g=>{s(C)!==""?g(cs):g(ds,!1)})}F(as);var Bs=e(as,2);{var gs=g=>{var v=Za(),I=y(v);Es(I,{get disabled(){return s(d)},placeholder:"Enter any text...",onkeydown:O=>O.key==="Enter"&&G(),get value(){return s(c)},set value(O){m(c,O,!0)}});var b=e(I,2),W=y(b);const hs=w(()=>s(d)||!s(c).trim());Fs(W,{intent:"primary",onclick:G,get disabled(){return s(hs)},children:(O,_s)=>{z();var is=ks("Insert");B(O,is)},$$slots:{default:!0}});var E=e(W,2);const V=w(()=>s(d)||!s(c).trim());Fs(E,{intent:"primary",onclick:Z,get disabled(){return s(V)},children:(O,_s)=>{z();var is=ks("Check");B(O,is)},$$slots:{default:!0}});var j=e(E,2);Fs(j,{intent:"secondary",onclick:es,get disabled(){return s(d)},children:(O,_s)=>{z();var is=ks("Reset");B(O,is)},$$slots:{default:!0}}),F(b),F(v),B(g,v)};ls(Bs,g=>{p()&&g(gs)})}var fs=e(Bs,2);{var bs=g=>{var v=se(),I=y(v),b=y(I);F(I);var W=e(I,2);let hs;var E=y(W,!0);F(W),F(v),J(V=>{N(b,`${s(k)==="insert"?"Inserted":"Check"}:`),hs=us(W,1,"result svelte-1hmxjsx",null,hs,V),N(E,s(k)==="insert"?"Element added":s(D)?"Possibly present":"Definitely not present")},[()=>({positive:s(D),negative:!s(D)})]),B(g,v)};ls(fs,g=>{s(D)!==null&&s(k)&&g(bs)})}var vs=e(fs,2),Cs=e(y(vs),2);Ds(Cs,21,()=>s(L),ms,(g,v,I)=>{$s(g,{get bits(){return s(v)},startIndex:I*4,type:"bitarray",get highlightedBits(){return s(T)},get bitColors(){return s(S)}})}),F(Cs),F(vs),F($);var xs=e($,2),ws=y(xs);const As=w(()=>[{label:"k (Hash Functions):",value:s(P)},{label:"m (Bit Array Size):",value:s(R)}]);ia(ws,{title:"Parameters",get parameters(){return s(As)},variant:"sticky"}),F(xs),F(rs),F(q),B(t,q),Hs()}var ne=_('<div class="custom-params svelte-9b9zo"><!> <!></div>'),ie=_('<div class="calculator-container svelte-9b9zo"><h2 class="svelte-9b9zo">Bloom Filter Parameter Calculator</h2> <div class="layout svelte-9b9zo"><div class="main-content svelte-9b9zo"><div class="input-section svelte-9b9zo"><h3 class="svelte-9b9zo">Input Parameters</h3> <!> <!> <div class="mode-section svelte-9b9zo"><h4 class="svelte-9b9zo">Calculation Mode</h4> <div class="radio-group svelte-9b9zo"><label class="radio-label svelte-9b9zo"><input type="radio"> Calculate optimal parameters</label> <label class="radio-label svelte-9b9zo"><input type="radio"> Use custom parameters</label></div></div> <!></div> <div class="results-section svelte-9b9zo"><h3 class="svelte-9b9zo">Calculated Results</h3> <div class="results-grid svelte-9b9zo"><!> <!> <!> <!> <!> <!></div></div></div> <div class="parameters-column svelte-9b9zo"><!> <div class="parameters-section svelte-9b9zo"><h3 class="svelte-9b9zo">Quick Presets</h3> <div class="preset-buttons svelte-9b9zo"><!> <!> <!></div></div></div></div></div>');function te(t,a){zs(a,!0);const n=[],o=32;let l=M(1e5),p=M(.01),r=M(null),c=M(null),d=M("optimal");const h=w(()=>s(l)<=0||s(p)<=0||s(p)>=1?0:Math.ceil(-(s(l)*Math.log(s(p)))/Math.pow(Math.log(2),2))),k=w(()=>s(l)<=0||s(h)<=0?0:Math.max(1,Math.round(s(h)/s(l)*Math.log(2)))),D=w(()=>{const E=s(d)==="optimal"?s(h):s(r)||s(h),V=s(d)==="optimal"?s(k):s(c)||s(k),j=s(l);return j<=0||E<=0||V<=0?0:Math.pow(1-Math.exp(-V*j/E),V)}),u=w(()=>{const E=s(d)==="optimal"?s(h):s(r)||s(h);return Math.ceil(E/8)}),A=w(()=>{const E=s(d)==="optimal"?s(h):s(r)||s(h);return s(l)<=0?0:E/s(l)});function C(E,V=2){return E===0?"0":E<.01&&E>0?E.toExponential(2):E.toLocaleString(void 0,{maximumFractionDigits:V})}function T(E){return(E*100).toFixed(4)+"%"}function S(E){return E<1024?`${E} B`:E<1024*1024?`${(E/1024).toFixed(2)} KiB`:`${(E/(1024*1024)).toFixed(2)} MiB`}var f=ie(),x=e(y(f),2),P=y(x),R=y(P),X=e(y(R),2);Es(X,{label:"Expected Elements (n):",type:"number",min:1,step:"1",placeholder:"100000",id:"expected-elements",get value(){return s(l)},set value(E){m(l,E,!0)}});var Q=e(X,2);Es(Q,{label:"Target False Positive Rate (p):",type:"number",min:1e-6,max:.999999,step:"0.001",placeholder:"0.01",id:"false-positive-rate",get value(){return s(p)},set value(E){m(p,E,!0)}});var G=e(Q,2),Z=e(y(G),2),es=y(Z),L=y(es);Os(L),L.value=L.__value="optimal",z(),F(es);var os=e(es,2),q=y(os);Os(q),q.value=q.__value="custom",z(),F(os),F(Z),F(G);var rs=e(G,2);{var $=E=>{var V=ne(),j=y(V);const O=w(()=>s(h).toString());Es(j,{label:"Bit Array Size (m):",type:"number",min:1,step:"1",get placeholder(){return s(O)},id:"custom-m",get value(){return s(r)},set value(Ps){m(r,Ps,!0)}});var _s=e(j,2);const is=w(()=>s(k).toString());Es(_s,{label:"Hash Functions (k):",type:"number",min:1,step:"1",get placeholder(){return s(is)},id:"custom-k",get value(){return s(c)},set value(Ps){m(c,Ps,!0)}}),F(V),B(E,V)};ls(rs,E=>{s(d)==="custom"&&E($)})}F(R);var ss=e(R,2),U=e(y(ss),2),ps=y(U);const as=w(()=>C(s(d)==="optimal"?s(h):s(r)||s(h),0));Y(ps,{label:"Bit Array Size (m)",get value(){return s(as)},unit:"bits",variant:"elevated"});var ns=e(ps,2);const cs=w(()=>s(d)==="optimal"?s(k):s(c)||s(k));Y(ns,{label:"Hash Functions (k)",get value(){return s(cs)},unit:"functions",variant:"elevated"});var ds=e(ns,2);const Bs=w(()=>T(s(D)));Y(ds,{label:"Actual False Positive Rate",get value(){return s(Bs)},unit:"probability",variant:"elevated"});var gs=e(ds,2);const fs=w(()=>S(s(u)));Y(gs,{label:"Memory Usage",get value(){return s(fs)},unit:"total",variant:"elevated"});var bs=e(gs,2);const vs=w(()=>C(s(A)));Y(bs,{label:"Bits per Element",get value(){return s(vs)},unit:"bits/element",variant:"elevated"});var Cs=e(bs,2);const xs=w(()=>`${C(100*(1-s(u)/(s(l)*o)))}%`);Y(Cs,{label:"Space Efficiency",get value(){return s(xs)},description:`vs naive storage (${o} bits/element)`,variant:"elevated"}),F(U),F(ss),F(P);var ws=e(P,2),As=y(ws);const g=w(()=>[{label:"Expected Elements (n):",value:C(s(l),0)},{label:"Target FPR (p):",value:T(s(p))},{label:"Bit Array Size (m):",value:C(s(d)==="optimal"?s(h):s(r)||s(h),0)},{label:"Hash Functions (k):",value:s(d)==="optimal"?s(k):s(c)||s(k)}]);ia(As,{title:"Current Parameters",get parameters(){return s(g)},variant:"sticky",cardVariant:"compact"});var v=e(As,2),I=e(y(v),2),b=y(I);Fs(b,{onclick:()=>{m(l,1e3),m(p,.01),m(d,"optimal")},children:(E,V)=>{z();var j=ks("Small (1K, 1%)");B(E,j)},$$slots:{default:!0}});var W=e(b,2);Fs(W,{onclick:()=>{m(l,1e5),m(p,.01),m(d,"optimal")},children:(E,V)=>{z();var j=ks("Medium (100K, 1%)");B(E,j)},$$slots:{default:!0}});var hs=e(W,2);Fs(hs,{onclick:()=>{m(l,1e6),m(p,.001),m(d,"optimal")},children:(E,V)=>{z();var j=ks("Large (1M, 0.1%)");B(E,j)},$$slots:{default:!0}}),F(I),F(v),F(ws),F(x),F(f),Ls(n,[],L,()=>s(d),E=>m(d,E)),Ls(n,[],q,()=>s(d),E=>m(d,E)),B(t,f),Hs()}const ta={date:"2025-06-09",tags:["Algorithms"],keywords:["Bloom filters","Probabilistic data structures","Hash functions","Bit arrays"],title:"Grokking Bloom Filters: The Classic Bloom Filter Demystified",preview:"How a tiny data structure cuts memory usage by 90% — while helping systems instantly check if data exists.",series:"Grokking Bloom Filters",draft:!1,hero:"/images/blog/008-bloom-filters-pt1/hero.jpg"},{date:fn,tags:bn,keywords:vn,title:Cn,preview:xn,series:wn,draft:An,hero:_n}=ta;var le=_(`<p>There’s a special category of data structures known as probabilistic data structures — and I have a soft spot for some of them. One of my absolute favorites is the Bloom filter. It’s a beautifully simple concept that tackles a surprisingly common challenge: how can we quickly check whether something belongs to a set — without eating up loads of memory?</p> <p>Even though Bloom filters aren’t something most of us use directly in everyday business code, they quietly work behind the scenes in the infrastructure of modern distributed systems, databases, and web services.</p> <p>Instead of storing the actual data, Bloom filters use a clever combo of hash functions and bit arrays to give us lightning-fast answers to a very simple question: is this thing definitely not in the set — or is it maybe there?</p> <p>This post is a deep dive — it’s long, and we’ll take our time walking through how Bloom filters work, how they’re built, and how they behave. But if you’re just here to see it in action, feel free to jump straight to the <a href="#live-demo">interactive playground</a> and try it out yourself. Or, if you’re ready to tune your own Bloom filter, head over to the <a href="#play-with-the-numbers">calculator</a> to configure parameters for your use case.</p> <h2 id="contents"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#contents">#</a>Contents</h2> <ul><li><a href="#what-is-a-bloom-filter">What is a Bloom Filter?</a></li> <li><a href="#how-bloom-filters-work">How Bloom Filters Work</a> <ul><li><a href="#live-demo">Live Demo</a></li> <li><a href="#why-cant-we-delete">Why Can’t We Delete?</a></li> <li><a href="#can-it-scale">Can It Scale?</a></li></ul></li> <li><a href="#optimizing-hash-functions">Optimizing Hash Functions</a> <ul><li><a href="#double-hashing-approach">Double Hashing Approach</a></li> <li><a href="#wide-hash-split">Wide Hash Split</a></li> <li><a href="#recap">Recap</a></li></ul></li> <li><a href="#how-to-calculate-parameters">How to Calculate Parameters</a> <ul><li><a href="#the-false-positive-rate">The False Positive Rate</a></li> <li><a href="#how-parameters-affect-performance">How Parameters Affect Performance</a></li> <li><a href="#calculating-optimal-parameters">Calculating Optimal Parameters</a></li> <li><a href="#examples-with-calculations">Examples With Calculations</a></li> <li><a href="#play-with-the-numbers">Play With The Numbers</a></li></ul></li> <li><a href="#wrapping-up">Wrapping Up</a></li></ul> <h2 id="what-is-a-bloom-filter"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#what-is-a-bloom-filter">#</a>What is a Bloom Filter?</h2> <p>A Bloom filter is a space-efficient probabilistic data structure designed to test whether an element belongs to a set. The key insight behind Bloom filters is their fundamental trade-off: they can guarantee with absolute certainty that an element is <em>not</em> in the set, but when they report that an element <em>is</em> present, there’s a small chance this may be a false positive. This asymmetry makes them especially useful as a first-line filter in systems where false positives are acceptable, but false negatives are not.</p> <div class="callout" data-callout="info" data-collapsible="false"><div class="callout-title"><div class="callout-title-icon" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg></div><div class="callout-title-text">Info</div></div><div class="callout-content"><p>If you’re not familiar with the terms <em>false positive</em> and <em>false negative</em>, here’s a quick translation:</p><ul><li>A <strong>false positive</strong> means the system says “yes, it’s here” when actually it’s not.</li> <li>A <strong>false negative</strong> means the system says “no, it’s not here” when actually it is.</li></ul></div></div> <p>The core idea is simple yet powerful. Rather than storing the actual elements, a Bloom filter keeps only hashed representations of the elements inside a compact bit array. This sacrifices some precision but delivers outstanding space efficiency and fast query times. For example, a typical Bloom filter with a 1% error rate requires just about 9.6 bits per element—regardless of the size of the elements themselves. That’s a significant improvement over traditional data structures like hash tables or hash sets, which must store the full data items.</p> <p>Bloom filters may report false positives — claiming an element is present when it isn’t — but they never report false negatives. This makes them extremely reliable for exclusion queries. This property has made Bloom filters invaluable in a wide range of applications, from web caching to database query optimization, where the cost of a false positive is far lower than the cost of missing a true member.</p> <h2 id="how-bloom-filters-work"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#how-bloom-filters-work">#</a>How Bloom Filters Work</h2> <p>The algorithm behind Bloom filters is elegantly built on three main components: a fixed-size bit array, multiple independent hash functions, and straightforward insertion and lookup operations. An empty Bloom filter starts as a bit array of <code>m</code> bits, all initialized to 0, and comes equipped with <code>k</code> different hash functions that map each element to exact <code>k</code> positions within the array. For optimal performance, these hash functions should ideally be independent and uniformly distributed.</p> <div class="callout" data-callout="info" data-collapsible="false"><div class="callout-title"><div class="callout-title-icon" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg></div><div class="callout-title-text">Hash functions?</div></div><div class="callout-content"><p>A hash function is a function that takes an input (like a string or number) and deterministically maps it to a number within a fixed range — in this case, some positions in the bit array.
When we say that hash functions should be <strong>independent</strong>, we mean that knowing the output of one hash function doesn’t help you guess or calculate the output of another — each one works on its own, like rolling different dice.
And when we say they are <strong>uniformly distributed</strong>, we mean that they spread their results evenly across all possible positions, so no part of the resulting bit array gets overloaded with too many bits set.</p><p>Examples of commonly used hash functions include MurmurHash, xxHash, CityHash, or cryptographic ones like SHA-256 (though cryptographic hashes are usually overkill for Bloom filters).</p></div></div> <!> <p>Inserting an element is fast and deterministic: the element is fed into each of the <code>k</code> hash functions, producing <code>k</code> unique array positions. The bits at all these positions are then set to 1. No matter how many elements have already been inserted, this operation always requires exactly <code>k</code> hash calculations and <code>k</code> bit updates. The beauty of this approach is its simplicity—there’s no need for collision resolution or complex data structures.</p> <p>Lookup works similarly. To check whether an element might be in the set, the algorithm runs the element through the same <code>k</code> hash functions to obtain <code>k</code> positions. If any of these bits is 0, the element is definitely not in the set — this is guaranteed, since insertion would have set all these bits to 1.</p> <!> <p>However, if all the bits are 1, the element <em>might</em> be in the set, but there’s also a chance that these bits were set by previous insertions of other elements. This creates the possibility of a false positive.</p> <!> <p>The math behind this comes from the probabilistic nature of hash collisions. As more elements are added, more bits get flipped to 1, which increases the chance that any random combination of <code>k</code> positions is already occupied, even for elements that were never inserted. That’s why the false positive rate grows with the number of elements, while the false negative rate stays at zero — if an element was inserted, it will always test as present.</p> <h3 id="live-demo"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#live-demo">#</a>Live Demo</h3> <p>Let’s get our hands dirty.</p> <p>In the interactive playground below, you can <strong>insert any string values into the Bloom filter</strong> and watch how it modifies the internal bit array. You can also <strong>check if a value is present</strong>, and see how Bloom filters may return <code>possibly present</code> even for things you never inserted — that’s our famous false positives in action.</p> <p>A few technical notes about this demo:</p> <ul><li>It uses a <strong>double hashing technique</strong> (which we’ll cover in more detail later). In short: instead of generating many completely separate hashes, it combines just two distinct hash functions to simulate any number of <code>k</code> hash functions. This approach is both efficient and widely used in real-world Bloom filters.</li> <li>For simplicity and to keep things visual, the filter here uses a very compact bit array — only <strong>16 bits</strong> (<code>m = 16</code>) and sets <code>k = 4</code> bit positions for each element.</li></ul> <p>Here’s what happens under the hood:</p> <ul><li>When you add a value: the filter applies the double hash to calculate <code>k</code> positions and flips the corresponding bits to <code>1</code>.</li> <li>When you check a value: it verifies if all these bits are still set to <code>1</code>. If yes — it says “maybe”; if any of them is <code>0</code> — it’s a definite “no”.</li></ul> <!> <h3 id="why-cant-we-delete"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#why-cant-we-delete">#</a>Why Can’t We Delete?</h3> <p>As you may have already noticed, we have <strong>INSERT</strong> and <strong>CHECK</strong> operations in Bloom filters, but I never mentioned a <strong>DELETE</strong> operation. That’s because — in the original design — we simply can’t. At least, not without breaking some of the guarantees that make Bloom filters useful in the first place. (Though, as we’ll see later in the series, there <em>are</em> variations of Bloom filters that support deletion.)</p> <p>The root of the problem is that multiple elements may hash to the same bit positions. When you attempt to delete an element by resetting its bits back to <code>0</code>, you risk clearing bits that may still be in use by other elements. Since Bloom filters are designed to avoid <strong>false negatives</strong>, any operation that might accidentally remove evidence of another element’s presence would break this guarantee.</p> <p>As one researcher <a href="https://www.math.umd.edu/~immortal/CMSC420/notes/bloomfilters.pdf" rel="nofollow">puts it nicely:</a></p> <div class="callout" data-callout="quote" data-collapsible="false"><div class="callout-title"><div class="callout-title-icon" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z"></path><path d="M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z"></path></svg></div><div class="callout-title-text">Quote</div></div><div class="callout-content"><p>“There is no deletion basically because the only reasonable way to delete would be to hash the key and then set those corresponding bits to 0, but this could cause false negatives for other keys.”</p></div></div> <p>Let’s visualize this. Imagine a Bloom filter as a shared apartment building where multiple tenants (elements) occupy overlapping rooms (bit positions).</p> <ul><li>When Alice moves in, she gets keys to rooms <code>3</code>, <code>7</code>, and <code>12</code>.</li> <li>When Bob moves in, he gets keys to rooms <code>7</code>, <code>15</code>, and <code>23</code>.</li></ul> <p>Notice: both Alice and Bob share room <code>7</code>.</p> <p>Now, if Alice moves out and we naively “delete” her by switching off the lights (setting bits to <code>0</code>) in rooms <code>3</code>, <code>7</code>, and <code>12</code>, we inadvertently turn off room <code>7</code>, which Bob still needs.<br> The next time someone asks, “Is Bob still living here?” the system might falsely answer “No” — even though Bob never left. That’s a <strong>false negative</strong>, and Bloom filters are designed specifically to prevent that.</p> <!> <p>Of course, for a quick and dirty workaround, an engineer might introduce a second “blacklist” Bloom filter to track deletions. When checking membership, an element would only be considered present if it’s in the main filter <strong>and</strong> not in the deletion filter. But this comes with its own trade-offs — and we’ll cover better solutions later.</p> <h3 id="can-it-scale"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#can-it-scale">#</a>Can It Scale?</h3> <p>The second major limitation of standard Bloom filters is their <strong>fixed size</strong>. Once you create a Bloom filter, you can’t resize it on the fly without breaking its mathematical guarantees.</p> <p>Traditional Bloom filters require you to <strong>declare their size upfront</strong> — it’s a bit like booking an apartment based on how many guests you <em>think</em> might show up. This creates the classic “Goldilocks problem”:</p> <ul><li><strong>Underestimated capacity</strong>: You planned for 1M elements but end up with 1.2M? The false positive rate can shoot up to 20% or even higher.</li> <li><strong>Overestimated capacity</strong>: You reserved space for 10M elements but only store 1M? You’re wasting 90% of your allocated memory.</li></ul> <p>The <a href="https://gsd.di.uminho.pt/members/cbm/ps/dbloom.pdf" rel="nofollow">solution</a> — or rather, the workaround — is fairly straightforward: monitor the Bloom filter’s saturation. Once the false positive rate crosses an unacceptable threshold, you simply add another (larger) Bloom filter. To check membership, you query all filters in sequence until you get a match or exhaust them.</p> <h2 id="optimizing-hash-functions"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#optimizing-hash-functions">#</a>Optimizing Hash Functions</h2> <p>As we discussed earlier, the key to an efficient Bloom filter lies in having k independent and uniformly distributed hash functions. The more evenly they spread their outputs across the bit array, the lower the risk of false positives.</p> <p>While this idea is elegant in theory, it’s more complicated in practice — creating and computing many truly independent hash functions can be both conceptually challenging and computationally expensive.</p> <p>Designing good hash functions isn’t something most engineers do every day. Creating a brand new hash function that minimizes collisions and evenly spreads values across the bit array is far from trivial. And Bloom filters typically require at least two hash functions — sometimes even four or more depending on your workload and the nature of the data you’re adding.</p> <p>As you probably noticed in your day-to-day work, we rarely write our own math-heavy algorithms from scratch. Instead, we lean on solid, battle-tested abstractions: hashing libraries, built-in data structures, utility modules, etc. Even if you’re adventurous enough to roll out your own Bloom filter implementation, you probably don’t want to spend weeks designing hash functions from scratch — but you still want decent performance.</p> <p>On top of that, hash computation itself can get expensive, especially if you’re using cryptographic hashes like SHA-256. These functions are overkill for Bloom filters and introduce unnecessary overhead. Faster non-cryptographic hash functions like <strong>MurmurHash</strong> or <strong>xxHash</strong> are much better suited for this use case — but even then, if you naively calculate <em>k</em> separate hashes per element, the cost adds up.</p> <p>Let’s take a look at a simple, naive approach just to set the baseline:</p> <!> <p>At first glance, problem solved: you’re generating multiple hash values by salting your input with different constants. It works, and it’s easy to implement. But this method has an important drawback — you need to compute <em>k</em> separate hashes for every element, which becomes costly for larger <em>k</em> values (say 10 or more) — especially if the hash function itself isn’t cheap.</p> <p>While this approach might be acceptable for use-cases where performance isn’t important, let’s be honest: for such cases, you probably don’t even need a Bloom filter — a plain old <code>Set</code> would do the job just fine.</p> <h3 id="double-hashing-approach"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#double-hashing-approach">#</a>Double Hashing Approach</h3> <p>Luckily, there’s a well-known trick to avoid computing <em>k</em> independent hash functions while still achieving almost the same statistical behavior. This method is often called <strong>double hashing</strong> or <strong>Kirsch-Mitzenmacher optimization</strong>, after the authors who <a href="https://www.eecs.harvard.edu/~michaelm/postscripts/rsa2008.pdf" rel="nofollow">formally analyzed it</a>.</p> <p>The idea is surprisingly simple: instead of calculating <em>k</em> totally independent hashes, you calculate just two independent hash functions, and then combine them to generate the rest.</p> <p>The formula goes like this:</p> <div class="math math-display"><!></div> <p>Where:</p> <ul><li><code>h1(x)</code> and <code>h2(x)</code> are two independent hash functions (or at least two reasonably uncorrelated ones).</li> <li><code>i</code> is the index of the hash function you want (ranging from 0 to k-1).</li> <li>Each resulting value is then typically reduced by modulo <code>m</code> (the bit array size) to map it into the bit array in case it’s larger than the bit array size.</li></ul> <p>In code, it may look something like this:</p> <!> <p>This approach has several nice properties:</p> <ul><li>You only calculate <strong>two</strong> hash functions per inserted element, no matter how many hash functions <em>k</em> you want.</li> <li>You get a whole sequence of hash values that are nicely spread across your bit array.</li> <li>The results are nearly as good as having fully independent hashes, at least for practical Bloom filter usage.</li></ul> <!> <h4 id="why-does-double-hashing-work"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#why-does-double-hashing-work">#</a>Why does Double-Hashing Work?</h4> <p>Without diving too deep into math: Kirsch and Mitzenmacher showed that this sequence of hashes behaves <em>almost</em> like having <em>k</em> independent hashes for the purposes of a Bloom filter. The false-positive rate remains essentially the same, while computational cost is dramatically reduced.</p> <p>This optimization is commonly used in real-world Bloom filter implementations — for example, it’s part of <a href="https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/utils/BloomFilter.java" rel="nofollow">Cassandra’s BloomFilter implementation</a>.</p> <h4 id="but-what-if-h2-is-zero"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#but-what-if-h2-is-zero">#</a>But what if <code>h2</code> is zero?</h4> <p>Yeah… You may have already noticed a potential issue in our formula:</p> <div class="math math-display"><!></div> <p>If <code>h2(x)</code> happens to be zero, all your hashes collapse into the same value:</p> <div class="math math-display"><!></div> <p>How likely is that? Well, it depends, but not impossible.</p> <p>To protect yourself, many implementations include a tiny fix like:</p> <!> <p>This guarantees forward progress: even in the worst case you still generate <code>k</code> distinct bit positions.</p> <h4 id="h2x-and-m-should-be-coprime"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#h2x-and-m-should-be-coprime">#</a><code>h2(x)</code> and <code>m</code> Should Be Coprime</h4> <p>There’s one more sneaky issue that’s often overlooked when using the double hashing formula:</p> <div class="math math-display"><!></div> <p>Everything seems fine… until one day your Bloom filter quietly becomes <em>less random than you expect</em>. This happens when <code>h2(x)</code> and <code>m</code> (the Bloom filter size) are not <strong>coprime</strong>.</p> <div class="callout" data-callout="info" data-collapsible="false"><div class="callout-title"><div class="callout-title-icon" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg></div><div class="callout-title-text">What does “coprime” mean?</div></div><div class="callout-content"><p>Two numbers are coprime if they don’t share any common divisors except 1.
For example:</p><ul><li><code>9</code> and <code>16</code> are coprime.</li> <li><code>6</code> and <code>18</code> are <strong>not</strong> coprime (since they share divisor <code>6</code>).</li></ul></div></div> <p>If <code>h2(x)</code> and <code>m</code> share a common divisor, the sequence of hashes generated</p> <!> <p>will only cover part of the bit array. In other words: <strong>you won’t reach all possible bit positions</strong>.</p> <p>This leads to: fewer unique bits set → more collisions → higher false-positive rates → sad stakeholders.</p> <p>Let’s say you have:</p> <ul><li><code>m = 10</code></li> <li><code>h1(x) = 2</code></li> <li><code>h2(x) = 4</code> (notice that both <code>4</code> and <code>10</code> share divisor <code>2</code>)</li></ul> <p>Now calculate the hashes:</p> <!> <p>You never touch bit positions <code>1, 3, 5, 7, 9</code> — half of your bit array is completely unused!</p> <p>Ideally, choose <code>m</code> to be a <strong>prime number</strong> — then any <code>h2(x)</code> is automatically coprime with <code>m</code> (except if <code>h2(x) = 0</code> which we already handled earlier).</p> <p>Or, when <code>m</code> is not prime, ensure that your hash function produces <code>h2(x)</code> values that are statistically unlikely to share factors with <code>m</code>. A simple safety net is to force <code>h2(x)</code> to always be odd:</p> <!> <p>This avoids most practical problems if <code>m</code> is a power of two (which is very common for bit arrays).</p> <p>Let’s walk through a small example where things work exactly as intended:</p> <ul><li><code>m = 10</code></li> <li><code>h1(x) = 2</code></li> <li><code>h2(x) = 7</code> (notice that <code>7</code> and <code>10</code> are coprime (they share no divisors except <code>1</code>)</li></ul> <p>Hash values be like that:</p> <!> <p>Full cycle, no repeats — the bit array is fully covered.</p> <h3 id="wide-hash-split"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#wide-hash-split">#</a>Wide Hash Split</h3> <p>There’s another technique that sometimes gets used, especially in high-performance Bloom filters - wide hash split. A good example is <a href="https://github.com/google/guava/blob/master/guava/src/com/google/common/hash/BloomFilterStrategies.java" rel="nofollow">Google Guava</a>, where it works nicely alongside the double hashing approach.</p> <p>The core idea is also simple - instead of generating multiple completely separate hash values, you generate <strong>one wide hash output</strong> (e.g. 128 or 256 bits), and then split it into multiple pieces to simulate multiple hash functions.</p> <!> <h4 id="why-does-hash-split-work"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#why-does-hash-split-work">#</a>Why does hash split work?</h4> <p>Good hash functions like <strong>MurmurHash3 128-bit</strong>, <strong>CityHash128</strong>, or <strong>xxHash3 128-bit</strong> are designed to spread randomness across all bits, i.e. have avalanche effect, when small input changes drastically alter all output bits. So, the upper bits are just as random as the lower bits.</p> <p>Of course, like everything in Bloom filters — no free lunch:</p> <ul><li>The resulting hashes are <strong>not truly independent</strong>, just decorrelated, i.e. different enough. This may theoretically increase false positives slightly if your input data is highly correlated and the hash function doesn’t have good avalanche effect.</li> <li>You’re limited by how many slices you can get — e.g., 128-bit hash gives you at most 4×32-bit slices (or more if you slice into smaller chunks).</li></ul> <h3 id="recap"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#recap">#</a>Recap</h3> <table><thead><tr><th>Method</th><th># of Hash Calls</th><th>Speed</th><th>Independence</th></tr></thead><tbody><tr><td>k hashes</td><td>k</td><td>Slow</td><td>True</td></tr><tr><td>Double hashing</td><td>2</td><td>Fast</td><td>Almost</td></tr><tr><td>Wide hash split</td><td>1</td><td>Even faster</td><td>Almost</td></tr></tbody></table> <h2 id="how-to-calculate-parameters"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#how-to-calculate-parameters">#</a>How to Calculate Parameters</h2> <p>Strictly speaking, this section should be at the very beginning — but I didn’t want to scare you away with formulas too early. Since you’re still here, let’s finally dive into how to properly configure your Bloom filter.</p> <p>Some of the parameters you’ve already met, but let’s quickly recap:</p> <ol><li><strong>m</strong> — the size of the bit array (in bits)</li> <li><strong>n</strong> — the expected number of inserted elements</li> <li><strong>k</strong> — the number of hash functions and bit positions to set</li> <li><strong>p</strong> — the false positive probability (also called <strong>FPP</strong>)</li></ol> <p>These parameters are tightly interconnected — changing one affects the others, leading to trade-offs between memory usage, query speed, and accuracy.</p> <h3 id="the-false-positive-rate"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#the-false-positive-rate">#</a>The False Positive Rate</h3> <p>The false positive rate is arguably the most important characteristic of a Bloom filter. It represents the probability that the filter incorrectly reports an element as present when it actually isn’t. The theoretical false positive probability can be approximated by:</p> <div class="math math-display"><!></div> <p>Where once again:</p> <ul><li><code>p</code> is the false positive probability</li> <li><code>k</code> is the number of hash functions and bit positions to set</li> <li><code>n</code> is the number of inserted elements</li> <li><code>m</code> is the size of the bit array</li></ul> <div class="callout" data-callout="warning" data-collapsible="false"><div class="callout-title"><div class="callout-title-icon" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg></div><div class="callout-title-text">Warning</div></div><div class="callout-content"><p>It’s worth noting that this formula is an approximation. According to <a href="https://cglab.ca/~morin/publications/ds/bloom-submitted.pdf" rel="nofollow">detailed mathematical analysis</a>, the actual false positive rate is strictly larger than this approximation for any k ≥ 2.</p></div></div> <h3 id="how-parameters-affect-performance"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#how-parameters-affect-performance">#</a>How Parameters Affect Performance</h3> <h4 id="memory-usage"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#memory-usage">#</a>Memory Usage</h4> <p>The memory usage of a Bloom filter is directly proportional to <code>m</code>. This is one of its key strengths — excellent space efficiency compared to hash tables or sets.</p> <p>For <a href="https://valkey.io/blog/introducing-bloom-filters/" rel="nofollow">example</a>, let’s say you want to maintain 500 Bloom filters, each capable of holding 5 million elements. The total memory depends heavily on your target false positive rate:</p> <table><thead><tr><th>False Positive Rate</th><th>Total Memory</th><th>Memory Savings vs SET</th></tr></thead><tbody><tr><td>0.01 (1 in 100)</td><td>2.9 GB</td><td>98.08% saved</td></tr><tr><td>0.001 (1 in 1,000)</td><td>4.9 GB</td><td>96.80% saved</td></tr><tr><td>0.00001 (1 in 100,000)</td><td>7.8 GB</td><td>94.88% saved</td></tr></tbody></table> <h4 id="query-performance"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#query-performance">#</a>Query Performance</h4> <p>Both insertions and lookups require computing <code>k</code> hash functions and updating or reading <code>k</code> bits. Therefore, both operations have time complexity <code>O(k)</code>, assuming that hash function is some constant time operation. Since <code>k</code> is typically small (usually between 5 and 12), Bloom filters are extremely fast for membership checks, regardless of how many elements they contain.</p> <h3 id="calculating-optimal-parameters"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#calculating-optimal-parameters">#</a>Calculating Optimal Parameters</h3> <h4 id="optimal-size-m"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#optimal-size-m">#</a>Optimal Size (m)</h4> <p>If you know the expected number of elements (<code>n</code>) and your target false positive probability (<code>p</code>), you can compute the optimal size of the bit array as:</p> <div class="math math-display"><!></div> <p>Or approximately:</p> <div class="math math-display"><!></div> <h4 id="optimal-number-of-hash-functions-k"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#optimal-number-of-hash-functions-k">#</a>Optimal Number of Hash Functions (k)</h4> <p>Once you have <code>m</code>, you can compute the optimal number of hash functions:</p> <div class="math math-display"><!></div> <p>Or approximately:</p> <div class="math math-display"><!></div> <p>Choosing this optimal <code>k</code> minimizes the false positive rate for your selected <code>m</code> and <code>n</code>.</p> <h3 id="examples-with-calculations"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#examples-with-calculations">#</a>Examples With Calculations</h3> <h4 id="example-1-calculating-size-and-hash-functions"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#example-1-calculating-size-and-hash-functions">#</a>Example 1: Calculating Size and Hash Functions</h4> <p>Given:</p> <ul><li><code>n = 100,000</code> (expected elements)</li> <li><code>p = 0.01</code> (1% false positive rate)</li></ul> <p>Calculate <code>m</code>:</p> <!> <p>Calculate <code>k</code>:</p> <!> <h4 id="example-2-calculating-false-positive-rate"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#example-2-calculating-false-positive-rate">#</a>Example 2: Calculating False Positive Rate</h4> <p>Given:</p> <ul><li><code>n = 100</code> (elements)</li> <li><code>m = 1,000</code> (bits)</li> <li><code>k = 4</code> (hash functions)</li></ul> <p>Calculate <code>p</code>:</p> <!> <p>So the false positive rate is approximately <strong>1.18%</strong>.</p> <h3 id="play-with-the-numbers"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#play-with-the-numbers">#</a>Play With The Numbers</h3> <p>If you’re getting bored (or dizzy) with all these formulas — don’t worry. Instead of torturing your brain, let’s just throw your numbers into the calculator below and let it crunch everything for you.</p> <p>After all, you’re sitting right next to one of the most advanced calculators humanity ever built — <strong>for Christ’s sake, let it do the math.</strong></p> <!> <h2 id="wrapping-up"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#wrapping-up">#</a>Wrapping Up</h2> <p>Every time I revisit Bloom filters, I’m reminded why computer science so often feels like magic. A simple structure — just a bit array and a handful of hash functions — yet it dances gracefully with probability to solve problems that could easily swallow gigabytes of memory if approached naively.</p> <p>And yet — this is only the beginning.</p> <p>As we move forward, we’ll see how this beautifully simple idea can be stretched, twisted, and extended to take on even bigger challenges.</p> <p>See you in the next parts — things are about to get even more interesting.</p>`,1);function oe(t){var a=le(),n=e(K(a),28);i(n,()=>`<pre class="mermaid">graph TD
    A["Element: 'apple'"] --> B["Hash Function 1<br/>h1('apple') = 3"]
    A --> C["Hash Function 2<br/>h2('apple') = 8"]  
    A --> D["Hash Function 3<br/>h3('apple') = 14"]
    
    B --> E["Bit Array Position 3"]
    C --> F["Bit Array Position 8"]
    D --> G["Bit Array Position 14"]
    
    E --> H["Set bit[3] = 1"]
    F --> I["Set bit[8] = 1"] 
    G --> J["Set bit[14] = 1"]
    
    H --> K["Bit Array:<br/>[0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0]"]
    I --> K
    J --> K
    
    style A fill:#5d5fef,color:#f8f9fa
    style K fill:#22d3ee,color:#212529</pre>`);var o=e(n,6);i(o,()=>`<pre class="mermaid">graph TD
    A["Query: 'banana'"] --> B["Hash Function 1<br/>h1('banana') = 3"]
    A --> C["Hash Function 2<br/>h2('banana') = 7"]  
    A --> D["Hash Function 3<br/>h3('banana') = 14"]
    
    B --> E["Check bit[3]<br/>Result: 1 ✓"]
    C --> F["Check bit[7]<br/>Result: 0 ✗"]
    D --> G["Check bit[14]<br/>Result: 1 ✓"]
    
    E --> H["Current Bit Array:<br/>[0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0]"]
    F --> H
    G --> H
    
    H --> I{"All bits = 1?"}
    I -->|"No, bit[7] = 0"| J["DEFINITELY NOT in set<br/>(No false negative)"]
    
    style A fill:#5d5fef,color:#f8f9fa
    style J fill:#dc2626,color:#f8f9fa
    style I fill:#f59e0b,color:#212529</pre>`);var l=e(o,4);i(l,()=>`<pre class="mermaid">graph TD
    A["Query: 'cherry'"] --> B["Hash Function 1<br/>h1('cherry') = 3"]
    A --> C["Hash Function 2<br/>h2('cherry') = 8"]  
    A --> D["Hash Function 3<br/>h3('cherry') = 14"]
    
    B --> E["Check bit[3]<br/>Result: 1 ✓"]
    C --> F["Check bit[8]<br/>Result: 1 ✓"]
    D --> G["Check bit[14]<br/>Result: 1 ✓"]
    
    E --> H["Current Bit Array:<br/>[0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0]"]
    F --> H
    G --> H
    
    H --> I{"All bits = 1?"}
    I -->|"Yes, all = 1"| J["POSSIBLY in set<br/>(Could be false positive)"]
    
    K["Note: 'cherry' was never inserted!<br/>But its hash positions match<br/>bits set by previous elements"]
    K -.-> J
    
    style A fill:#5d5fef,color:#f8f9fa
    style J fill:#fde047,color:#212529
    style I fill:#f59e0b,color:#212529
    style K fill:#d97706,color:#f8f9fa</pre>`);var p=e(l,18);ee(p,{});var r=e(p,20);i(r,()=>`<pre class="mermaid">graph TD
    A["Alice moves in"] --> A1["Gets keys to rooms:<br/>3, 7, 12"]
    B["Bob moves in"] --> B1["Gets keys to rooms:<br/>7, 15, 23"]
    
    A1 --> R["Room occupancy:<br/>Room 3: Alice<br/>Room 7: Alice + Bob<br/>Room 12: Alice<br/>Room 15: Bob<br/>Room 23: Bob"]
    B1 --> R
    
    R --> D["Alice moves out<br/>(Naive deletion)"]
    D --> D1["Turn off lights in<br/>rooms 3, 7, 12"]
    
    D1 --> P["Problem: Room 7 light<br/>is turned off but<br/>Bob still needs it!"]
    
    P --> Q["Next query: 'Is Bob here?'<br/>Checks rooms 7, 15, 23<br/>Room 7 is dark (0)<br/>Answer: NO"]
    
    Q --> F["FALSE NEGATIVE<br/>Bob never left!"]
    
    style A fill:#22d3ee,color:#212529
    style B fill:#22d3ee,color:#212529
    style D fill:#dc2626,color:#f8f9fa
    style F fill:#dc2626,color:#f8f9fa
    style P fill:#f59e0b,color:#212529</pre>`);var c=e(r,28);i(c,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#89DDFF;--shiki-dark:#F97583">val</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> h1 </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> hash_function_1</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">(</span><span style="color:#C792EA;--shiki-dark:#F97583">data</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#F97583">val</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> h2 </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> hash_function_2</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">(</span><span style="color:#C792EA;--shiki-dark:#F97583">data</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#F97583">..</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#F97583">val</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> hk </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> hash_function_k</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">(</span><span style="color:#C792EA;--shiki-dark:#F97583">data</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">)</span></span></code></pre>`);var d=e(c,14),h=y(d);i(h,()=>'<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mtext>position</mtext><mi>i</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><msub><mi>h</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>+</mo><mi>i</mi><mo>⋅</mo><msub><mi>h</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mtext> </mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext> </mtext><mi>m</mi></mrow><annotation encoding="application/x-tex">\\text{position}_i(x) = (h_1(x) + i \\cdot h_2(x)) \\bmod m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord text"><span class="mord">position</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2175em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">))</span><span class="mspace" style="margin-right:0.0556em;"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.0556em;"></span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span></span>'),F(d);var k=e(d,8);i(k,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#89DDFF;--shiki-dark:#F97583">val</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> h1 </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> hash1</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">(</span><span style="color:#C792EA;--shiki-dark:#F97583">data</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#F97583">val</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> h2 </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> hash2</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">(</span><span style="color:#C792EA;--shiki-dark:#F97583">data</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">for</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> (i </span><span style="color:#89DDFF;--shiki-dark:#F97583">in</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 0</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> until k) &#123;</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#F97583">    val</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> position </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> (h1 </span><span style="color:#89DDFF;--shiki-dark:#F97583">+</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> i </span><span style="color:#89DDFF;--shiki-dark:#F97583">*</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> h2) </span><span style="color:#89DDFF;--shiki-dark:#F97583">%</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> m</span></span>
<span class="line"><span style="color:#82AAFF;--shiki-dark:#B392F0">    setBit</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">(position)</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">&#125;</span></span>
<span class="line"></span></code></pre>`);var D=e(k,6);i(D,()=>`<pre class="mermaid">graph LR
    A["Element: 'data'"] --> B["h1('data') = 5"]
    A --> C["h2('data') = 3"]
    
    B --> D["position_0 = (5 + 0×3) % 16 = 5"]
    B --> E["position_1 = (5 + 1×3) % 16 = 8"]  
    B --> F["position_2 = (5 + 2×3) % 16 = 11"]
    B --> G["position_3 = (5 + 3×3) % 16 = 14"]
    
    C --> D
    C --> E
    C --> F
    C --> G
    
    D --> H["Set bits: 5, 8, 11, 14"]
    E --> H
    F --> H
    G --> H
    
    style A fill:#5d5fef,color:#f8f9fa
    style B fill:#495057,color:#f8f9fa
    style C fill:#495057,color:#f8f9fa
    style H fill:#22d3ee,color:#212529</pre>`);var u=e(D,12),A=y(u);i(A,()=>'<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mtext>position</mtext><mi>i</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><msub><mi>h</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>+</mo><mi>i</mi><mo>⋅</mo><msub><mi>h</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mtext> </mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext> </mtext><mi>m</mi></mrow><annotation encoding="application/x-tex">\\text{position}_i(x) = (h_1(x) + i \\cdot h_2(x)) \\bmod m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord text"><span class="mord">position</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2175em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">))</span><span class="mspace" style="margin-right:0.0556em;"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.0556em;"></span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span></span>'),F(u);var C=e(u,4),T=y(C);i(T,()=>'<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mtext>position</mtext><mi>i</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><msub><mi>h</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>+</mo><mi>i</mi><mo>⋅</mo><mn>0</mn><mo stretchy="false">)</mo><mtext> </mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext> </mtext><mi>m</mi><mo>=</mo><msub><mi>h</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mtext> </mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext> </mtext><mi>m</mi></mrow><annotation encoding="application/x-tex">\\text{position}_i(x) = (h_1(x) + i \\cdot 0) \\bmod m = h_1(x) \\bmod m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord text"><span class="mord">position</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2175em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.0556em;"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.0556em;"></span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.0556em;"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.0556em;"></span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span></span>'),F(C);var S=e(C,6);i(S,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">if</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> (h2 </span><span style="color:#89DDFF;--shiki-dark:#F97583">==</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 0</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">) &#123;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    h2 </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var f=e(S,8),x=y(f);i(x,()=>'<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mtext>position</mtext><mi>i</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><msub><mi>h</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>+</mo><mi>i</mi><mo>⋅</mo><msub><mi>h</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mtext> </mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext> </mtext><mi>m</mi></mrow><annotation encoding="application/x-tex">\\text{position}_i(x) = (h_1(x) + i \\cdot h_2(x)) \\bmod m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord text"><span class="mord">position</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2175em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">))</span><span class="mspace" style="margin-right:0.0556em;"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.0556em;"></span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span></span>'),F(f);var P=e(f,8);i(P,()=>'<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span>h1(x), h1(x) + h2(x), h1(x) + 2*h2(x), ...</span></span></code></pre>');var R=e(P,12);i(R,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span>(2 + 0*4) % 10 → 2  </span></span>
<span class="line"><span>(2 + 1*4) % 10 → 6  </span></span>
<span class="line"><span>(2 + 2*4) % 10 → 0  </span></span>
<span class="line"><span>(2 + 3*4) % 10 → 4  </span></span>
<span class="line"><span>(2 + 4*4) % 10 → 8  </span></span>
<span class="line"><span>(2 + 5*4) % 10 → 2  (cycle repeats)</span></span></code></pre>`);var X=e(R,8);i(X,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;--shiki-dark:#F97583;--shiki-dark-font-style:inherit">if</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> (h2 </span><span style="color:#89DDFF;--shiki-dark:#F97583">%</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 2</span><span style="color:#89DDFF;--shiki-dark:#F97583"> ==</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 0</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">) &#123;</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">    h2 </span><span style="color:#89DDFF;--shiki-dark:#F97583">+=</span><span style="color:#F78C6C;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#BABED8;--shiki-dark:#E1E4E8">&#125;</span></span></code></pre>`);var Q=e(X,10);i(Q,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span>(2 + 0*7) % 10 → 2  </span></span>
<span class="line"><span>(2 + 1*7) % 10 → 9  </span></span>
<span class="line"><span>(2 + 2*7) % 10 → 6  </span></span>
<span class="line"><span>(2 + 3*7) % 10 → 3  </span></span>
<span class="line"><span>(2 + 4*7) % 10 → 0  </span></span>
<span class="line"><span>(2 + 5*7) % 10 → 7  </span></span>
<span class="line"><span>(2 + 6*7) % 10 → 4  </span></span>
<span class="line"><span>(2 + 7*7) % 10 → 1  </span></span>
<span class="line"><span>(2 + 8*7) % 10 → 8  </span></span>
<span class="line"><span>(2 + 9*7) % 10 → 5</span></span></code></pre>`);var G=e(Q,10);i(G,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#89DDFF;--shiki-dark:#F97583">val</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> wideHash </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#82AAFF;--shiki-dark:#B392F0"> hash128</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">(</span><span style="color:#C792EA;--shiki-dark:#F97583">data</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#F97583">val</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> h1 </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> (wideHash shr </span><span style="color:#F78C6C;--shiki-dark:#79B8FF">0</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">)  </span><span style="color:#89DDFF;--shiki-dark:#F97583">%</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> m </span><span style="color:#676E95;font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit">// or apply mask, if m is a power of two</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#F97583">val</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> h2 </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> (wideHash shr </span><span style="color:#F78C6C;--shiki-dark:#79B8FF">16</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">) </span><span style="color:#89DDFF;--shiki-dark:#F97583">%</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> m</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#F97583">val</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> h3 </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> (wideHash shr </span><span style="color:#F78C6C;--shiki-dark:#79B8FF">32</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">) </span><span style="color:#89DDFF;--shiki-dark:#F97583">%</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> m</span></span>
<span class="line"><span style="color:#89DDFF;--shiki-dark:#F97583">val</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> h4 </span><span style="color:#89DDFF;--shiki-dark:#F97583">=</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> (wideHash shr </span><span style="color:#F78C6C;--shiki-dark:#79B8FF">48</span><span style="color:#BABED8;--shiki-dark:#E1E4E8">) </span><span style="color:#89DDFF;--shiki-dark:#F97583">%</span><span style="color:#BABED8;--shiki-dark:#E1E4E8"> m</span></span></code></pre>`);var Z=e(G,28),es=y(Z);i(es,()=>'<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>p</mi><mo>=</mo><msup><mrow><mo fence="true">(</mo><mn>1</mn><mo>−</mo><msup><mi>e</mi><mrow><mo>−</mo><mi>k</mi><mi>n</mi><mi mathvariant="normal">/</mi><mi>m</mi></mrow></msup><mo fence="true">)</mo></mrow><mi>k</mi></msup></mrow><annotation encoding="application/x-tex">p = \\left(1 - e^{-kn/m}\\right)^k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.039em;vertical-align:-0.65em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">(</span></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathnormal mtight">kn</span><span class="mord mtight">/</span><span class="mord mathnormal mtight">m</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.389em;"><span style="top:-3.6029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span></span></span></span>'),F(Z);var L=e(Z,28),os=y(L);i(os,()=>'<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>m</mi><mo>=</mo><mo>−</mo><mfrac><mrow><mi>n</mi><mi>ln</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">)</mo></mrow><mrow><mo stretchy="false">(</mo><mi>ln</mi><mo>⁡</mo><mo stretchy="false">(</mo><mn>2</mn><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">m = -\\frac{n \\ln(p)}{(\\ln(2))^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord">−</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mop">ln</span><span class="mopen">(</span><span class="mord">2</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">ln</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>'),F(L);var q=e(L,4),rs=y(q);i(rs,()=>'<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>m</mi><mo>≈</mo><mo>−</mo><mi>n</mi><mi>ln</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">)</mo><mo>⋅</mo><mn>2.08</mn></mrow><annotation encoding="application/x-tex">m \\approx -n \\ln(p) \\cdot 2.08</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4831em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">−</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">ln</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2.08</span></span></span></span></span>'),F(q);var $=e(q,6),ss=y($);i(ss,()=>'<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>k</mi><mo>=</mo><mfrac><mi>m</mi><mi>n</mi></mfrac><mi>ln</mi><mo>⁡</mo><mo stretchy="false">(</mo><mn>2</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">k = \\frac{m}{n} \\ln(2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.7936em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">ln</span><span class="mopen">(</span><span class="mord">2</span><span class="mclose">)</span></span></span></span></span>'),F($);var U=e($,4),ps=y(U);i(ps,()=>'<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>k</mi><mo>≈</mo><mfrac><mi>m</mi><mi>n</mi></mfrac><mo>⋅</mo><mn>0.693</mn></mrow><annotation encoding="application/x-tex">k \\approx \\frac{m}{n} \\cdot 0.693</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.7936em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0.693</span></span></span></span></span>'),F(U);var as=e(U,14);i(as,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span>m = -(n * ln(p)) / (ln(2))^2</span></span>
<span class="line"><span>  = -(100,000 * ln(0.01)) / (ln(2))^2</span></span>
<span class="line"><span>  = -(100,000 * (-4.6052)) / (0.4809)</span></span>
<span class="line"><span>  ≈ 958,506 bits (≈ 117 KiB)</span></span></code></pre>`);var ns=e(as,4);i(ns,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span>k = (m / n) * ln(2)</span></span>
<span class="line"><span>  = (958,506 / 100,000) * 0.693</span></span>
<span class="line"><span>  ≈ 6.64 (≈ 7 hash functions)</span></span></code></pre>`);var cs=e(ns,10);i(cs,()=>`<pre class="shiki shiki-themes material-theme-palenight github-dark" style="background-color:#292D3E;--shiki-dark-bg:#24292e;color:#babed8;--shiki-dark:#e1e4e8" tabindex="0"><code><span class="line"><span>p = (1 - e^(-k * n / m))^k</span></span>
<span class="line"><span>  = (1 - e^(-4 * 100 / 1000))^4</span></span>
<span class="line"><span>  = (1 - e^(-0.4))^4</span></span>
<span class="line"><span>  = (1 - 0.6703)^4</span></span>
<span class="line"><span>  = (0.3297)^4</span></span>
<span class="line"><span>  ≈ 0.0118</span></span></code></pre>`);var ds=e(cs,10);te(ds,{}),z(10),B(t,a)}const re=Object.freeze(Object.defineProperty({__proto__:null,default:oe,metadata:ta},Symbol.toStringTag,{value:"Module"})),la={date:"2025-06-24",tags:["Algorithms"],keywords:["Bloom filters","Probabilistic data structures","Counting Bloom filters"],title:"Grokking Bloom Filters: Counting Bloom Filter",preview:"Bloom filters can't remove elements — unless you let them count.",series:"Grokking Bloom Filters",draft:!1,hero:"/images/blog/009-counting-bloom-filters/hero.jpg"},{date:Tn,tags:In,keywords:Sn,title:Vn,preview:Mn,series:zn,draft:Hn,hero:Pn}=la;var pe=Ys(`<svg xmlns="http://www.w3.org/2000/svg" width="672" height="208" class="svgbob"><style>.svgbob line, .svgbob path, .svgbob circle, .svgbob rect, .svgbob polygon {
  stroke: black;
  stroke-width: 2;
  stroke-opacity: 1;
  fill-opacity: 1;
  stroke-linecap: round;
  stroke-linejoin: miter;
}

.svgbob text {
  white-space: pre;
  fill: black;
  font-family: Iosevka Fixed, monospace;
  font-size: 14px;
}

.svgbob rect.backdrop {
  stroke: none;
  fill: transparent;
}

.svgbob .broken {
  stroke-dasharray: 8;
}

.svgbob .filled {
  fill: black;
}

.svgbob .bg_filled {
  fill: transparent;
  stroke-width: 1;
}

.svgbob .nofill {
  fill: transparent;
}

.svgbob .end_marked_arrow {
  marker-end: url(#arrow);
}

.svgbob .start_marked_arrow {
  marker-start: url(#arrow);
}

.svgbob .end_marked_diamond {
  marker-end: url(#diamond);
}

.svgbob .start_marked_diamond {
  marker-start: url(#diamond);
}

.svgbob .end_marked_circle {
  marker-end: url(#circle);
}

.svgbob .start_marked_circle {
  marker-start: url(#circle);
}

.svgbob .end_marked_open_circle {
  marker-end: url(#open_circle);
}

.svgbob .start_marked_open_circle {
  marker-start: url(#open_circle);
}

.svgbob .end_marked_big_open_circle {
  marker-end: url(#big_open_circle);
}

.svgbob .start_marked_big_open_circle {
  marker-start: url(#big_open_circle);
}</style><defs><marker id="arrow" viewBox="-2 -2 8 8" refX="4" refY="2" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><polygon points="0,0 0,4 4,2 0,0"></polygon></marker><marker id="diamond" viewBox="-2 -2 8 8" refX="4" refY="2" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><polygon points="0,2 2,0 4,2 2,4 0,2"></polygon></marker><marker id="circle" viewBox="0 0 8 8" refX="4" refY="4" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><circle cx="4" cy="4" r="2" class="filled"></circle></marker><marker id="open_circle" viewBox="0 0 8 8" refX="4" refY="4" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><circle cx="4" cy="4" r="2" class="bg_filled"></circle></marker><marker id="big_open_circle" viewBox="0 0 8 8" refX="4" refY="4" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><circle cx="4" cy="4" r="3" class="bg_filled"></circle></marker></defs><rect class="backdrop" x="0" y="0" width="672" height="208"></rect><text x="2" y="12">Classic</text><text x="66" y="12">Bloom</text><text x="114" y="12">Filter</text><path d="M 176,0 A 16,16 0,0,0 176,16" class="nofill"></path><text x="178" y="12">1</text><line x1="184" y1="8" x2="192" y2="8" class="solid"></line><text x="194" y="12">bit</text><text x="10" y="44">0</text><text x="26" y="44">0</text><text x="42" y="44">1</text><text x="58" y="44">0</text><text x="74" y="44">0</text><text x="90" y="44">1</text><text x="106" y="44">0</text><text x="122" y="44">1</text><text x="138" y="44">1</text><text x="154" y="44">0</text><text x="10" y="76">0</text><text x="26" y="76">1</text><text x="42" y="76">2</text><text x="58" y="76">3</text><text x="74" y="76">4</text><text x="90" y="76">5</text><text x="106" y="76">6</text><text x="122" y="76">7</text><text x="138" y="76">8</text><text x="154" y="76">9</text><text x="226" y="12">array</text><path d="M 264,0 A 16,16 0,0,1 264,16" class="nofill"></path><text x="274" y="12">:</text><text x="186" y="44">←</text><text x="202" y="44">each</text><text x="242" y="44">cell</text><line x1="280" y1="38" x2="288" y2="38" class="solid"></line><line x1="280" y1="42" x2="288" y2="42" class="solid"></line><text x="298" y="44">1</text><text x="314" y="44">bit</text><text x="2" y="108">Counting</text><text x="74" y="108">Bloom</text><text x="122" y="108">Filter</text><path d="M 184,96 A 16,16 0,0,0 184,112" class="nofill"></path><text x="186" y="108">4</text><line x1="192" y1="104" x2="200" y2="104" class="solid"></line><text x="202" y="108">bit</text><text x="234" y="108">counters</text><path d="M 296,96 A 16,16 0,0,1 296,112" class="nofill"></path><text x="306" y="108">:</text><text x="26" y="140">0</text><text x="74" y="140">1</text><text x="122" y="140">0</text><text x="170" y="140">0</text><text x="218" y="140">2</text><text x="266" y="140">0</text><text x="314" y="140">1</text><text x="362" y="140">1</text><text x="410" y="140">0</text><text x="458" y="140">1</text><text x="10" y="156">0000</text><text x="58" y="156">0001</text><text x="106" y="156">0000</text><text x="154" y="156">0000</text><text x="202" y="156">0010</text><text x="250" y="156">0000</text><text x="298" y="156">0001</text><text x="346" y="156">0001</text><text x="394" y="156">0000</text><text x="442" y="156">0001</text><text x="26" y="188">0</text><text x="74" y="188">1</text><text x="122" y="188">2</text><text x="170" y="188">3</text><text x="218" y="188">4</text><text x="266" y="188">5</text><text x="314" y="188">6</text><text x="362" y="188">7</text><text x="410" y="188">8</text><text x="458" y="188">9</text><text x="506" y="156">←</text><text x="522" y="156">each</text><text x="562" y="156">cell</text><line x1="600" y1="150" x2="608" y2="150" class="solid"></line><line x1="600" y1="154" x2="608" y2="154" class="solid"></line><text x="618" y="156">4</text><text x="634" y="156">bits</text><g><line x1="4" y1="24" x2="164" y2="24" class="solid"></line><line x1="4" y1="24" x2="4" y2="56" class="solid"></line><line x1="20" y1="24" x2="20" y2="56" class="solid"></line><line x1="36" y1="24" x2="36" y2="56" class="solid"></line><line x1="52" y1="24" x2="52" y2="56" class="solid"></line><line x1="68" y1="24" x2="68" y2="56" class="solid"></line><line x1="84" y1="24" x2="84" y2="56" class="solid"></line><line x1="100" y1="24" x2="100" y2="56" class="solid"></line><line x1="116" y1="24" x2="116" y2="56" class="solid"></line><line x1="132" y1="24" x2="132" y2="56" class="solid"></line><line x1="148" y1="24" x2="148" y2="56" class="solid"></line><line x1="164" y1="24" x2="164" y2="56" class="solid"></line><line x1="4" y1="56" x2="164" y2="56" class="solid"></line></g><g><line x1="4" y1="120" x2="484" y2="120" class="solid"></line><line x1="4" y1="120" x2="4" y2="168" class="solid"></line><line x1="52" y1="120" x2="52" y2="168" class="solid"></line><line x1="100" y1="120" x2="100" y2="168" class="solid"></line><line x1="148" y1="120" x2="148" y2="168" class="solid"></line><line x1="196" y1="120" x2="196" y2="168" class="solid"></line><line x1="244" y1="120" x2="244" y2="168" class="solid"></line><line x1="292" y1="120" x2="292" y2="168" class="solid"></line><line x1="340" y1="120" x2="340" y2="168" class="solid"></line><line x1="388" y1="120" x2="388" y2="168" class="solid"></line><line x1="436" y1="120" x2="436" y2="168" class="solid"></line><line x1="484" y1="120" x2="484" y2="168" class="solid"></line><line x1="4" y1="168" x2="484" y2="168" class="solid"></line></g></svg>`),ce=Ys(`<svg xmlns="http://www.w3.org/2000/svg" width="552" height="480" class="svgbob"><style>.svgbob line, .svgbob path, .svgbob circle, .svgbob rect, .svgbob polygon {
  stroke: black;
  stroke-width: 2;
  stroke-opacity: 1;
  fill-opacity: 1;
  stroke-linecap: round;
  stroke-linejoin: miter;
}

.svgbob text {
  white-space: pre;
  fill: black;
  font-family: Iosevka Fixed, monospace;
  font-size: 14px;
}

.svgbob rect.backdrop {
  stroke: none;
  fill: transparent;
}

.svgbob .broken {
  stroke-dasharray: 8;
}

.svgbob .filled {
  fill: black;
}

.svgbob .bg_filled {
  fill: transparent;
  stroke-width: 1;
}

.svgbob .nofill {
  fill: transparent;
}

.svgbob .end_marked_arrow {
  marker-end: url(#arrow);
}

.svgbob .start_marked_arrow {
  marker-start: url(#arrow);
}

.svgbob .end_marked_diamond {
  marker-end: url(#diamond);
}

.svgbob .start_marked_diamond {
  marker-start: url(#diamond);
}

.svgbob .end_marked_circle {
  marker-end: url(#circle);
}

.svgbob .start_marked_circle {
  marker-start: url(#circle);
}

.svgbob .end_marked_open_circle {
  marker-end: url(#open_circle);
}

.svgbob .start_marked_open_circle {
  marker-start: url(#open_circle);
}

.svgbob .end_marked_big_open_circle {
  marker-end: url(#big_open_circle);
}

.svgbob .start_marked_big_open_circle {
  marker-start: url(#big_open_circle);
}</style><defs><marker id="arrow" viewBox="-2 -2 8 8" refX="4" refY="2" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><polygon points="0,0 0,4 4,2 0,0"></polygon></marker><marker id="diamond" viewBox="-2 -2 8 8" refX="4" refY="2" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><polygon points="0,2 2,0 4,2 2,4 0,2"></polygon></marker><marker id="circle" viewBox="0 0 8 8" refX="4" refY="4" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><circle cx="4" cy="4" r="2" class="filled"></circle></marker><marker id="open_circle" viewBox="0 0 8 8" refX="4" refY="4" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><circle cx="4" cy="4" r="2" class="bg_filled"></circle></marker><marker id="big_open_circle" viewBox="0 0 8 8" refX="4" refY="4" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><circle cx="4" cy="4" r="3" class="bg_filled"></circle></marker></defs><rect class="backdrop" x="0" y="0" width="552" height="480"></rect><text x="98" y="12">d</text><line x1="104" y1="8" x2="112" y2="8" class="solid"></line><text x="114" y="12">left</text><text x="154" y="12">Counting</text><text x="226" y="12">Bloom</text><text x="274" y="12">Filter</text><text x="330" y="12">Memory</text><text x="386" y="12">Layout</text><path d="M 136,16 A 16,16 0,0,0 136,32" class="nofill"></path><text x="138" y="28">d</text><line x1="144" y1="22" x2="152" y2="22" class="solid"></line><line x1="144" y1="26" x2="152" y2="26" class="solid"></line><text x="154" y="28">2</text><text x="170" y="28">subtables,</text><text x="258" y="28">B</text><line x1="264" y1="22" x2="272" y2="22" class="solid"></line><line x1="264" y1="26" x2="272" y2="26" class="solid"></line><text x="274" y="28">4</text><text x="290" y="28">buckets</text><text x="354" y="28">each</text><path d="M 384,16 A 16,16 0,0,1 384,32" class="nofill"></path><text x="18" y="60">Subtable</text><text x="90" y="60">0:</text><text x="34" y="92">Bucket</text><text x="90" y="92">0</text><text x="42" y="124">fp:0xA2C</text><text x="122" y="124">fp:0x7F1</text><text x="210" y="124">...</text><text x="42" y="140">cnt:</text><text x="82" y="140">1</text><text x="122" y="140">cnt:</text><text x="162" y="140">2</text><text x="34" y="188">Bucket</text><text x="90" y="188">1</text><text x="42" y="220">fp:0x5B8</text><text x="138" y="220">empty</text><text x="210" y="220">...</text><text x="42" y="236">cnt:</text><text x="82" y="236">1</text><text x="34" y="284">Bucket</text><text x="90" y="284">2</text><text x="58" y="316">empty</text><text x="138" y="316">empty</text><text x="210" y="316">...</text><text x="34" y="380">Bucket</text><text x="90" y="380">3</text><text x="42" y="412">fp:0x8E6</text><text x="138" y="412">empty</text><text x="210" y="412">...</text><text x="42" y="428">cnt:</text><text x="82" y="428">2</text><text x="314" y="60">Subtable</text><text x="386" y="60">1:</text><text x="314" y="92">Bucket</text><text x="370" y="92">0</text><text x="322" y="124">fp:0x3E9</text><text x="418" y="124">empty</text><text x="490" y="124">...</text><text x="322" y="140">cnt:</text><text x="362" y="140">1</text><text x="314" y="188">Bucket</text><text x="370" y="188">1</text><text x="322" y="220">fp:0x9D4</text><text x="402" y="220">fp:0x1C7</text><text x="490" y="220">...</text><text x="322" y="236">cnt:</text><text x="362" y="236">3</text><text x="402" y="236">cnt:</text><text x="442" y="236">1</text><text x="314" y="284">Bucket</text><text x="370" y="284">2</text><text x="322" y="316">fp:0x6A1</text><text x="418" y="316">empty</text><text x="490" y="316">...</text><text x="322" y="332">cnt:</text><text x="362" y="332">1</text><text x="314" y="380">Bucket</text><text x="370" y="380">3</text><text x="338" y="412">empty</text><text x="418" y="412">empty</text><text x="490" y="412">...</text><g><line x1="20" y1="72" x2="260" y2="72" class="solid"></line><line x1="20" y1="72" x2="20" y2="456" class="solid"></line><line x1="260" y1="72" x2="260" y2="456" class="solid"></line><line x1="20" y1="168" x2="260" y2="168" class="solid"></line><line x1="20" y1="264" x2="260" y2="264" class="solid"></line><line x1="20" y1="360" x2="260" y2="360" class="solid"></line><line x1="20" y1="456" x2="260" y2="456" class="solid"></line></g><g><line x1="36" y1="104" x2="244" y2="104" class="solid"></line><line x1="36" y1="104" x2="36" y2="152" class="solid"></line><line x1="116" y1="104" x2="116" y2="152" class="solid"></line><line x1="196" y1="104" x2="196" y2="152" class="solid"></line><line x1="244" y1="104" x2="244" y2="152" class="solid"></line><line x1="36" y1="152" x2="244" y2="152" class="solid"></line></g><g><line x1="36" y1="200" x2="244" y2="200" class="solid"></line><line x1="36" y1="200" x2="36" y2="248" class="solid"></line><line x1="116" y1="200" x2="116" y2="248" class="solid"></line><line x1="196" y1="200" x2="196" y2="248" class="solid"></line><line x1="244" y1="200" x2="244" y2="248" class="solid"></line><line x1="36" y1="248" x2="244" y2="248" class="solid"></line></g><g><line x1="36" y1="296" x2="244" y2="296" class="solid"></line><line x1="36" y1="296" x2="36" y2="344" class="solid"></line><line x1="116" y1="296" x2="116" y2="344" class="solid"></line><line x1="196" y1="296" x2="196" y2="344" class="solid"></line><line x1="244" y1="296" x2="244" y2="344" class="solid"></line><line x1="36" y1="344" x2="244" y2="344" class="solid"></line></g><g><line x1="36" y1="392" x2="244" y2="392" class="solid"></line><line x1="36" y1="392" x2="36" y2="440" class="solid"></line><line x1="116" y1="392" x2="116" y2="440" class="solid"></line><line x1="196" y1="392" x2="196" y2="440" class="solid"></line><line x1="244" y1="392" x2="244" y2="440" class="solid"></line><line x1="36" y1="440" x2="244" y2="440" class="solid"></line></g><g><line x1="300" y1="72" x2="540" y2="72" class="solid"></line><line x1="300" y1="72" x2="300" y2="456" class="solid"></line><line x1="540" y1="72" x2="540" y2="456" class="solid"></line><line x1="300" y1="168" x2="540" y2="168" class="solid"></line><line x1="300" y1="264" x2="540" y2="264" class="solid"></line><line x1="300" y1="360" x2="540" y2="360" class="solid"></line><line x1="300" y1="456" x2="540" y2="456" class="solid"></line></g><g><line x1="316" y1="104" x2="524" y2="104" class="solid"></line><line x1="316" y1="104" x2="316" y2="152" class="solid"></line><line x1="396" y1="104" x2="396" y2="152" class="solid"></line><line x1="476" y1="104" x2="476" y2="152" class="solid"></line><line x1="524" y1="104" x2="524" y2="152" class="solid"></line><line x1="316" y1="152" x2="524" y2="152" class="solid"></line></g><g><line x1="316" y1="200" x2="524" y2="200" class="solid"></line><line x1="316" y1="200" x2="316" y2="248" class="solid"></line><line x1="396" y1="200" x2="396" y2="248" class="solid"></line><line x1="476" y1="200" x2="476" y2="248" class="solid"></line><line x1="524" y1="200" x2="524" y2="248" class="solid"></line><line x1="316" y1="248" x2="524" y2="248" class="solid"></line></g><g><line x1="316" y1="296" x2="524" y2="296" class="solid"></line><line x1="316" y1="296" x2="316" y2="344" class="solid"></line><line x1="396" y1="296" x2="396" y2="344" class="solid"></line><line x1="476" y1="296" x2="476" y2="344" class="solid"></line><line x1="524" y1="296" x2="524" y2="344" class="solid"></line><line x1="316" y1="344" x2="524" y2="344" class="solid"></line></g><g><line x1="316" y1="392" x2="524" y2="392" class="solid"></line><line x1="316" y1="392" x2="316" y2="440" class="solid"></line><line x1="396" y1="392" x2="396" y2="440" class="solid"></line><line x1="476" y1="392" x2="476" y2="440" class="solid"></line><line x1="524" y1="392" x2="524" y2="440" class="solid"></line><line x1="316" y1="440" x2="524" y2="440" class="solid"></line></g></svg>`),de=_(`<p>Bloom filters are incredibly space-efficient probabilistic data structures, perfect for answering a simple question: “Is this element in the set — no or maybe?”</p> <p>But as we discussed in <a href="/blog/008-bloom-filters-pt1">deep dive into Bloom filters</a>, there’s a big limitation: <strong>they don’t support deletion</strong>.</p> <p>In this part of the series, we’ll tackle that problem. We’ll explore how we can extend Bloom filters to allow element removal — and what trade-offs come with that.</p> <h2 id="contents"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#contents">#</a>Contents</h2> <ul><li><a href="#why-deletion-is-hard">Why Deletion Is Hard</a></li> <li><a href="#easy-workarounds-that-actually-dont-work">Easy Workarounds (That Actually Don’t Work)</a> <ul><li><a href="#rebuilding-the-filter">Rebuilding the Filter</a></li> <li><a href="#using-a-tombstone-filter">Using a Tombstone Filter</a></li></ul></li> <li><a href="#counting-bloom-filters">Counting Bloom Filters</a> <ul><li><a href="#how-counting-bloom-filters-work">How Counting Bloom Filters Work</a></li> <li><a href="#handling-counter-overflow-and-underflow">Handling Counter Overflow and Underflow</a></li> <li><a href="#removing-a-non-existent-element">Removing a Non-Existent Element</a></li> <li><a href="#is-it-worth-it">Is It Worth It?</a></li></ul></li> <li><a href="#d-left-counting-bloom-filter">d-left Counting Bloom Filter</a> <ul><li><a href="#core-idea">Core Idea</a></li> <li><a href="#why-d-left">Why d-left?</a></li> <li><a href="#insertion">Insertion</a></li> <li><a href="#deletion">Deletion</a></li> <li><a href="#membership-check">Membership Check</a></li> <li><a href="#about-permutations-two-phase-hashing">About Permutations (Two-Phase Hashing)</a></li></ul></li> <li><a href="#moving-forward">Moving Forward</a></li></ul> <h2 id="why-deletion-is-hard"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#why-deletion-is-hard">#</a>Why Deletion Is Hard</h2> <p>To understand why deletion doesn’t work in a classic Bloom filter, let’s quickly revisit how it operates.</p> <p>A Bloom filter consists of two core components:</p> <ul><li>A fixed-size <strong>bit array</strong></li> <li>A set of <strong>hash functions</strong></li></ul> <p>Each time you insert an element, it is hashed at most <code>k</code> times to determine <code>k</code> bit positions in the array, and those bits are set to <code>1</code>. Since the bit array is shared across all elements, multiple elements may overlap and set the same bits — this is expected and what makes Bloom filters space-efficient.</p> <p>But this sharing creates a fundamental problem: <strong>you can’t tell which element set a given bit</strong>. If you try to delete an element by resetting its <code>k</code> bits to <code>0</code>, you may accidentally unset bits that are still needed by other elements, breaking one of the Bloom filter’s key guarantees: <strong>no false negatives</strong>.</p> <p>Let’s see this in action. Suppose we have a Bloom filter with 10 bits and we want to insert two elements:</p> <ul><li><strong>Element A</strong> hashes to positions 0, 5, and 8</li> <li><strong>Element B</strong> hashes to positions 5, 7, and 9</li></ul> <p>Notice that both elements share position 5 — this is where the trouble begins.</p> <p>First, we insert both elements. Element A sets bits at positions 0, 5, and 8. Then Element B tries to set bits at positions 5, 7, and 9. Position 5 is already set from Element A, so it remains <code>1</code>, while positions 7 and 9 are newly set.</p> <!> <p>Our final bit array looks like:</p> <svg xmlns="http://www.w3.org/2000/svg" width="176" height="160" class="svgbob"><style>.svgbob line, .svgbob path, .svgbob circle, .svgbob rect, .svgbob polygon {
  stroke: black;
  stroke-width: 2;
  stroke-opacity: 1;
  fill-opacity: 1;
  stroke-linecap: round;
  stroke-linejoin: miter;
}

.svgbob text {
  white-space: pre;
  fill: black;
  font-family: Iosevka Fixed, monospace;
  font-size: 14px;
}

.svgbob rect.backdrop {
  stroke: none;
  fill: transparent;
}

.svgbob .broken {
  stroke-dasharray: 8;
}

.svgbob .filled {
  fill: black;
}

.svgbob .bg_filled {
  fill: transparent;
  stroke-width: 1;
}

.svgbob .nofill {
  fill: transparent;
}

.svgbob .end_marked_arrow {
  marker-end: url(#arrow);
}

.svgbob .start_marked_arrow {
  marker-start: url(#arrow);
}

.svgbob .end_marked_diamond {
  marker-end: url(#diamond);
}

.svgbob .start_marked_diamond {
  marker-start: url(#diamond);
}

.svgbob .end_marked_circle {
  marker-end: url(#circle);
}

.svgbob .start_marked_circle {
  marker-start: url(#circle);
}

.svgbob .end_marked_open_circle {
  marker-end: url(#open_circle);
}

.svgbob .start_marked_open_circle {
  marker-start: url(#open_circle);
}

.svgbob .end_marked_big_open_circle {
  marker-end: url(#big_open_circle);
}

.svgbob .start_marked_big_open_circle {
  marker-start: url(#big_open_circle);
}</style><defs><marker id="arrow" viewBox="-2 -2 8 8" refX="4" refY="2" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><polygon points="0,0 0,4 4,2 0,0"></polygon></marker><marker id="diamond" viewBox="-2 -2 8 8" refX="4" refY="2" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><polygon points="0,2 2,0 4,2 2,4 0,2"></polygon></marker><marker id="circle" viewBox="0 0 8 8" refX="4" refY="4" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><circle cx="4" cy="4" r="2" class="filled"></circle></marker><marker id="open_circle" viewBox="0 0 8 8" refX="4" refY="4" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><circle cx="4" cy="4" r="2" class="bg_filled"></circle></marker><marker id="big_open_circle" viewBox="0 0 8 8" refX="4" refY="4" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><circle cx="4" cy="4" r="3" class="bg_filled"></circle></marker></defs><rect class="backdrop" x="0" y="0" width="176" height="160"></rect><text x="50" y="12">shared</text><line x1="92" y1="16" x2="92" y2="68" class="solid"></line><text x="10" y="44">A</text><text x="122" y="44">B</text><text x="138" y="44">A</text><text x="154" y="44">B</text><line x1="12" y1="48" x2="12" y2="68" class="solid"></line><line x1="124" y1="48" x2="124" y2="68" class="solid"></line><line x1="140" y1="48" x2="140" y2="68" class="solid"></line><line x1="156" y1="48" x2="156" y2="68" class="solid"></line><polygon points="8,68 16,68 12,80" class="filled"></polygon><polygon points="88,68 96,68 92,80" class="filled"></polygon><polygon points="120,68 128,68 124,80" class="filled"></polygon><polygon points="136,68 144,68 140,80" class="filled"></polygon><polygon points="152,68 160,68 156,80" class="filled"></polygon><text x="10" y="108">1</text><text x="26" y="108">0</text><text x="42" y="108">0</text><text x="58" y="108">0</text><text x="74" y="108">0</text><text x="90" y="108">1</text><text x="106" y="108">0</text><text x="122" y="108">1</text><text x="138" y="108">1</text><text x="154" y="108">1</text><text x="10" y="140">0</text><text x="26" y="140">1</text><text x="42" y="140">2</text><text x="58" y="140">3</text><text x="74" y="140">4</text><text x="90" y="140">5</text><text x="106" y="140">6</text><text x="122" y="140">7</text><text x="138" y="140">8</text><text x="154" y="140">9</text><text x="106" y="12">bit</text><g><line x1="4" y1="88" x2="164" y2="88" class="solid"></line><line x1="4" y1="88" x2="4" y2="120" class="solid"></line><line x1="20" y1="88" x2="20" y2="120" class="solid"></line><line x1="36" y1="88" x2="36" y2="120" class="solid"></line><line x1="52" y1="88" x2="52" y2="120" class="solid"></line><line x1="68" y1="88" x2="68" y2="120" class="solid"></line><line x1="84" y1="88" x2="84" y2="120" class="solid"></line><line x1="100" y1="88" x2="100" y2="120" class="solid"></line><line x1="116" y1="88" x2="116" y2="120" class="solid"></line><line x1="132" y1="88" x2="132" y2="120" class="solid"></line><line x1="148" y1="88" x2="148" y2="120" class="solid"></line><line x1="164" y1="88" x2="164" y2="120" class="solid"></line><line x1="4" y1="120" x2="164" y2="120" class="solid"></line></g></svg> <p>Now, let’s attempt to delete Element A. The naive approach would be to reset its bits at positions 0, 5, and 8 back to <code>0</code>. This seems straightforward, but here’s the problem: when we reset position 5, we’re also removing Element B’s contribution to that position. After this “deletion,” our bit array becomes: <code>[0,0,0,0,0,0,0,1,0,1]</code>.</p> <!> <p>The corruption becomes evident when we later check for Element B. We hash it to positions 5, 7, and 9, but now position 5 is <code>0</code>. Since not all of Element B’s positions are set, the Bloom filter incorrectly reports that Element B is not present — a <strong>false negative</strong>. This is catastrophic because Element B was never deleted; it’s still supposed to be in the set.</p> <!> <div class="callout" data-callout="tip" data-collapsible="false"><div class="callout-title"><div class="callout-title-icon" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg></div><div class="callout-title-text">Tip</div></div><div class="callout-content"><p>It’s similar to erasing your tag from a public graffiti wall — you might end up scrubbing off someone else’s mark too, and now no one can tell they were ever there.</p></div></div> <p>This is why deletion is fundamentally unsafe in standard Bloom filters — any attempt to remove an element risks corrupting the filter’s state and creating false negatives for other elements.</p> <h2 id="easy-workarounds-that-actually-dont-work"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#easy-workarounds-that-actually-dont-work">#</a>Easy Workarounds (That Actually Don’t Work)</h2> <p>Before diving into data structure modifications, let’s look at a few simple workarounds for deletion.</p> <h3 id="rebuilding-the-filter"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#rebuilding-the-filter">#</a>Rebuilding the Filter</h3> <p>In many use cases, full deletion support isn’t necessary. Instead, you can periodically <strong>rebuild</strong> the Bloom filter from scratch — daily, weekly, or based on certain metrics like false positive rate. This works especially well if:</p> <ul><li>You can tolerate brief downtime or rebuild in the background.</li> <li>The data set is relatively stable or changes in batches.</li></ul> <p>This is often the simplest and safest approach.</p> <h3 id="using-a-tombstone-filter"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#using-a-tombstone-filter">#</a>Using a Tombstone Filter</h3> <p>Another workaround is to maintain a second Bloom filter — a <strong>tombstone filter</strong> — to track deletions. When you remove an element, you insert it into the tombstone filter.</p> <p>To check for membership:</p> <ol><li>Check the main Bloom filter.</li> <li>If it’s a <strong>possible match</strong>, check the tombstone filter.</li> <li>If it also matches there, treat it as deleted.</li></ol> <p>The problem? If the tombstone filter gives a <strong>false positive</strong>, you’ll wrongly conclude that an element was deleted — effectively creating a <strong>false negative</strong>. This defeats the main strength of Bloom filters.</p> <p>So while this method technically adds delete support, it weakens the guarantees and is rarely worth the risk.</p> <h2 id="counting-bloom-filters"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#counting-bloom-filters">#</a>Counting Bloom Filters</h2> <p>The core strength of Bloom filters lies in their simplicity: a bit array and some hash functions. This makes them fast and compact — but also limited. In particular, the bit array can’t tell <strong>which elements</strong> contributed to setting each bit.</p> <p>That’s where <strong>Counting Bloom Filters (CBFs)</strong> come in.</p> <p>Originally proposed by <a href="https://www.cs.princeton.edu/courses/archive/spr05/cos598E/bib/p254-fan.pdf" rel="nofollow">Fan et al.</a> as a solution for scalable web cache, CBFs replace the bit array with an array of <strong>small integer counters</strong> — typically 4-bit values. These allow us to track how many elements have set each position.</p> <!> <h3 id="how-counting-bloom-filters-work"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#how-counting-bloom-filters-work">#</a>How Counting Bloom Filters Work</h3> <p>CBFs operate using three fundamental operations, same as the classic Bloom filter, but each building on the counter-based structure.</p> <h4 id="insertion-of-an-element"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#insertion-of-an-element">#</a>Insertion of an Element</h4> <p>When inserting an element into a CBF:</p> <ol><li><strong>Hash the element</strong> to determine <code>k</code> positions in the counter array</li> <li><strong>Increment each counter</strong> at those <code>k</code> positions by 1</li></ol> <p>The key insight is that <strong>multiple elements may share the same positions</strong> — but now we track exactly how many elements contributed to each position through the counter values.</p> <!> <h4 id="membership-query-operation"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#membership-query-operation">#</a>Membership Query Operation</h4> <p>To check if an element exists in the CBF:</p> <ol><li><strong>Hash the element</strong> using the same <code>k</code> hash functions to get <code>k</code> positions</li> <li><strong>Check all counters</strong> at those positions</li> <li><strong>Return the result</strong>: <ul><li>If <strong>all counters > 0</strong>: Element is <strong>possibly present</strong></li> <li>If <strong>any counter = 0</strong>: Element is <strong>definitely not present</strong></li></ul></li></ol> <p>The query operation is identical to a standard Bloom filter, just checking counters instead of bits.</p> <h4 id="deletion-of-an-element"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#deletion-of-an-element">#</a>Deletion of an Element</h4> <p>The deletion operation is just the opposite of the insertion operation:</p> <ol><li><strong>Hash the element</strong> to get the same <code>k</code> positions used during insertion</li> <li><strong>Decrement each counter</strong> at those positions by 1</li></ol> <p>The result is that other elements sharing those positions remain unaffected because their contributions are still counted.</p> <!> <p>This counter-based approach enables <strong>insert</strong>, <strong>query</strong>, and <strong>delete</strong> operations while preserving the probabilistic guarantees of the original Bloom filter structure. However, it’s not without its own challenges.</p> <h3 id="handling-counter-overflow-and-underflow"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#handling-counter-overflow-and-underflow">#</a>Handling Counter Overflow and Underflow</h3> <p>When implementing a CBF, you need to be mindful of counter limits. Most implementations use 4-bit counters, which means each counter can represent values from 0 to 15.</p> <h4 id="overflow-during-insertion"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#overflow-during-insertion">#</a>Overflow During Insertion</h4> <p>If a counter is already at its maximum value (e.g., 15) and you try to increment it, the result will either:</p> <ul><li>Wrap around to 0 (in case of overflow), or</li> <li>Overwrite memory incorrectly (if not handled properly)</li></ul> <p>To prevent this, insertions should <strong>skip incrementing</strong> counters that are already at their maximum value.</p> <h4 id="underflow-during-deletion"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#underflow-during-deletion">#</a>Underflow During Deletion</h4> <p>Similarly, if a counter is at <code>0</code> and you try to decrement it, you risk corrupting the filter — especially if that position was never associated with the element being removed. Deletion code should <strong>never decrement</strong> a zero counter.</p> <p>This raises a deeper issue: if the counter is <code>0</code>, the element likely wasn’t inserted — and deleting it can silently damage the filter. That brings us to a more subtle and dangerous scenario…</p> <h3 id="removing-a-non-existent-element"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#removing-a-non-existent-element">#</a>Removing a Non-Existent Element</h3> <p>Counting Bloom Filters only work reliably if deletions are performed on elements that were actually inserted. If you delete an element that was never added, you can unintentionally corrupt the state of the filter.</p> <p>Let’s walk through a simple example:</p> <ul><li>Element <strong>A</strong> hashes to positions <code>1, 5, 7, 9</code></li> <li>Element <strong>B</strong> hashes to positions <code>1, 3, 7, 8</code></li></ul> <p>Now suppose you insert <strong>A</strong> — this increments the counters at positions <code>1, 5, 7, 9</code>.</p> <p>Then, without inserting <strong>B</strong>, you try to delete it. This decrements counters at <code>1, 3, 7, 8</code>.</p> <p>Here’s what goes wrong:</p> <ul><li>Counters at positions <code>1</code> and <code>7</code> (shared with A) are decremented — possibly to zero.</li> <li>When you later check for <strong>A</strong>, it may appear absent, even though it was never deleted.</li> <li>Counters at positions <code>5</code> and <code>9</code> remain set — creating an inconsistent state.</li></ul> <p>This creates a <strong>false negative</strong>, something Bloom filters are explicitly designed to avoid. And the worst part? There’s no way to detect this corruption after the fact.</p> <h3 id="is-it-worth-it"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#is-it-worth-it">#</a>Is It Worth It?</h3> <p>Counting Bloom Filters provide a straightforward way to support deletions: just replace bits with small counters. The core algorithm remains nearly identical to the classic Bloom filter — simple and efficient.</p> <p>But this simplicity comes at a cost:</p> <ul><li>Requires more memory — typically 4× larger due to 4-bit counters.</li> <li>Vulnerable to accidental false negatives if deletions aren’t handled carefully.</li> <li>Doesn’t track which elements contributed to a counter — so overlapping deletions are still a risk.</li></ul> <p>CBFs were proposed back in 2000 as a practical workaround, and they still hold up in simple scenarios. But if memory is tight or deletion accuracy is critical, modern alternatives like <strong>Cuckoo Filters</strong> offer better guarantees.</p> <p>Before we get there, let’s look at one more variation that builds on this concept — the <strong>d-left Counting Bloom Filter</strong>.</p> <h2 id="d-left-counting-bloom-filter"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#d-left-counting-bloom-filter">#</a>d-left Counting Bloom Filter</h2> <p>This data structure is quite different from classic Bloom and Counting Bloom Filters, but it gives us useful ideas that eventually lead to Cuckoo Filters — especially I love the point when it comes to handling collisions.</p> <h3 id="core-idea"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#core-idea">#</a>Core Idea</h3> <p>The <a href="https://people.eecs.berkeley.edu/~sylvia/cs268-2014/papers/countingbloom.pdf" rel="nofollow">d-left Counting Bloom Filter (dlCBF)</a> replaces the flat array of counters with a multi-part structure — or simply, <code>d</code> separate hash tables (subtables).</p> <p>Each subtable contains <code>B</code> buckets. Every bucket holds a small, fixed number of cells (e.g., 8). Each cell has:</p> <ul><li>a <strong>fingerprint</strong> (a short hash of the original element)</li> <li>a <strong>counter</strong> (how many times it’s been added)</li></ul> <p>So instead of one giant table, we split it into <code>d</code> isolated parts.</p> <!> <h3 id="why-d-left"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#why-d-left">#</a>Why d-left?</h3> <p>This structure is more complex than a flat CBF, but it packs data more tightly and handles collisions better. Each subtable manages its own space, and load balancing improves thanks to the “pick the least loaded” rule.</p> <div class="callout" data-callout="tip" data-collapsible="false"><div class="callout-title"><div class="callout-title-icon" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg></div><div class="callout-title-text">Tip</div></div><div class="callout-content"><p>Think of it like driving on a busy 6-lane road approaching an intersection. Three lanes can turn left, and the other three can turn right. In a regular CBF, it’s as if there’s only one lane for your direction — everyone turning left has to squeeze into the same lane, creating a traffic jam. But with d-left CBF, you have multiple lanes (subtables) going in your direction. When you need to turn (insert an element), you look at all the lanes that can make your turn and choose the one with the least traffic (fewest occupied cells). This way, cars turning in the same direction spread out across multiple lanes, reducing congestion.</p></div></div> <h3 id="insertion"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#insertion">#</a>Insertion</h3> <ol><li>First, hash the element once to get the <strong>true fingerprint</strong>.</li> <li>Each subtable applies its own <strong>deterministic permutation</strong> to the fingerprint. This maps the fingerprint to a bucket in that subtable and modifies the fingerprint slightly to avoid clashes. I explain it later.</li> <li>Now we have <code>d</code> candidate buckets — one per subtable.</li> <li>From those, pick the bucket with the fewest used cells.</li> <li>If a cell with the modified fingerprint already exists there, increment its counter.</li> <li>Otherwise, insert a new cell with the fingerprint and counter set to 1.</li></ol> <p>Here’s how dlCBF insertion works:</p> <!> <h3 id="deletion"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#deletion">#</a>Deletion</h3> <p>To remove an element:</p> <ul><li>Use the same process to find candidate buckets and fingerprints.</li> <li>Locate the matching cell and decrement its counter.</li></ul> <h3 id="membership-check"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#membership-check">#</a>Membership Check</h3> <p>Same logic: use the original fingerprint, permute it per subtable, and check each candidate bucket. If any bucket contains a matching fingerprint with a positive counter, the element is <strong>possibly present</strong>.</p> <h3 id="about-permutations-two-phase-hashing"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#about-permutations-two-phase-hashing">#</a>About Permutations (Two-Phase Hashing)</h3> <p>One subtle but powerful part of dlCBF is <strong>how it avoids ambiguous deletions and collisions</strong>.</p> <ul><li><strong>Phase 1</strong>: Generate a fingerprint from the element.</li> <li><strong>Phase 2</strong>: Each subtable applies its own deterministic permutation to the fingerprint. This affects both the bucket index and the fingerprint value inside that subtable.</li></ul> <p>So instead of computing <code>d</code> separate hashes, we just compute one hash and shuffle it differently in each subtable. This helps avoid situations where two elements look the same across all subtables and buckets — a common cause of incorrect deletions.</p> <p>By doing this simple fingerprint transformation per subtable, dlCBF lowers the chance of “hot buckets” and overlapping fingerprints, making the structure more reliable.</p> <h2 id="moving-forward"><a class="header-anchor" aria-hidden="true" tabindex="-1" href="#moving-forward">#</a>Moving Forward</h2> <p>Counting Bloom Filters are a natural extension of the classic Bloom Filter — they add support for deletions with minimal structural changes. On paper, it’s a neat solution. But in practice, CBFs are not always the most efficient choice, especially today.</p> <p>It’s a bit sad, honestly. There’s no simple way to preserve the elegance of the original Bloom Filter and still get reliable deletions. Every attempt to fix that tends to compromise either performance or memory efficiency.</p> <p>That said, the alternatives — like Cuckoo Filters and the newer Ribbon Filters — are surprisingly elegant in their own right. They’re more complex under the hood, but if you’re working with modern libraries, that complexity is abstracted away. For most real-world use cases where deletions matter, these filters are excellent, first-class replacements for classic Bloom Filters.</p>`,1);function he(t){var a=de(),n=e(K(a),30);i(n,()=>`<pre class="mermaid">graph TD
    A["Insert Element A<br/>Hash positions: 0, 5, 8"] --> A1["Set bits:<br/>bit[0] = 1<br/>bit[5] = 1<br/>bit[8] = 1"]
    
    B["Insert Element B<br/>Hash positions: 5, 7, 9"] --> B1["Set bits:<br/>bit[5] = 1 (already set)<br/>bit[7] = 1<br/>bit[9] = 1"]
    
    A1 --> C["Positions set: 0, 5, 7, 8, 9"]
    B1 --> C
    
    style A fill:#22d3ee,color:#212529
    style B fill:#22d3ee,color:#212529
    style C fill:#22c55e,color:#212529</pre>`);var o=e(n,8);i(o,()=>`<pre class="mermaid">graph TD
    A["Current state:<br/>[1,0,0,0,0,1,0,1,1,1]<br/>Both A and B inserted"] --> B["❌ Attempt to delete Element A<br/>Reset positions: 0, 5, 8"]
    
    B --> C["Naive deletion:<br/>bit[0] = 0<br/>bit[5] = 0 ⚠️ (shared with B!)<br/>bit[8] = 0"]
    
    C --> D["Corrupted bit array:<br/>[0,0,0,0,0,0,0,1,0,1]<br/>Only positions 7, 9 remain set"]
    
    style A fill:#495057,color:#f8f9fa
    style B fill:#dc2626,color:#f8f9fa
    style C fill:#f59e0b,color:#212529
    style D fill:#dc2626,color:#f8f9fa</pre>`);var l=e(o,4);i(l,()=>`<pre class="mermaid">graph TD
    A["Corrupted state:<br/>[0,0,0,0,0,0,0,1,0,1]<br/>Element A 'deleted'"] --> B["💥 Check Element B<br/>Hash positions: 5, 7, 9"]
    
    B --> C["Check each position:<br/>bit[5] = 0 ❌<br/>bit[7] = 1 ✓<br/>bit[9] = 1 ✓"]
    
    C --> D{"All bits set?"}
    
    D -->|"No, bit[5] = 0"| E["FALSE NEGATIVE!<br/>Element B appears absent<br/>but was never deleted"]
    
    style A fill:#dc2626,color:#f8f9fa
    style B fill:#f59e0b,color:#212529
    style D fill:#f59e0b,color:#212529
    style E fill:#dc2626,color:#f8f9fa</pre>`);var p=e(l,38);Gs(p,{children:(k,D)=>{var u=pe();B(k,u)}});var r=e(p,14);i(r,()=>`<pre class="mermaid">graph TD
    A["Insert Element A<br/>Hash positions: 1, 4, 7"] --> A1["Increment counters:<br/>counter[1] = 0+1 = 1<br/>counter[4] = 0+1 = 1<br/>counter[7] = 0+1 = 1"]
    
    A1 --> A2["Counter array after A:<br/>[0,1,0,0,1,0,0,1,0,0]"]
    
    B["Insert Element B<br/>Hash positions: 4, 6, 9"] --> B1["Increment counters:<br/>counter[4] = 1+1 = 2 (shared!)<br/>counter[6] = 0+1 = 1<br/>counter[9] = 0+1 = 1"]
    
    A2 --> C["Final counter array:<br/>[0,1,0,0,2,0,1,1,0,1]<br/>Position 4 shared by both elements"]
    B1 --> C
    
    style A fill:#3b82f6,color:#f8f9fa
    style B fill:#3b82f6,color:#f8f9fa
    style C fill:#22c55e,color:#212529</pre>`);var c=e(r,18);i(c,()=>`<pre class="mermaid">graph TD
    A["Current state:<br/>[0,1,0,0,2,0,1,1,0,1]<br/>Both A and B inserted"] --> B["Delete Element A<br/>Hash positions: 1, 4, 7"]
    
    B --> C["Decrement counters:<br/>counter[1] = 1-1 = 0<br/>counter[4] = 2-1 = 1 (B still contributes!)<br/>counter[7] = 1-1 = 0"]
    
    C --> D["✅ Updated counter array:<br/>[0,0,0,0,1,0,1,0,0,1]<br/>Element B's data preserved"]
    
    style A fill:#495057,color:#f8f9fa
    style B fill:#3b82f6,color:#f8f9fa
    style D fill:#495057,color:#f8f9fa</pre>`);var d=e(c,66);Gs(d,{children:(k,D)=>{var u=ce();B(k,u)}});var h=e(d,14);i(h,()=>`<pre class="mermaid">graph TD
    A["Element: 'apple'<br/>Generate fingerprint: 0x4A2C"] --> B["Subtable 1<br/>Permute: 0x4A2C → 0x7B1D<br/>Bucket: hash(0x7B1D) % B = 3<br/>Load: 2 cells"]
    
    A --> C["Subtable 2<br/>Permute: 0x4A2C → 0x9E8F<br/>Bucket: hash(0x9E8F) % B = 7<br/>Load: 1 cell"]
    
    B --> D["Candidate buckets:<br/>Subtable 1 bucket 3: 2 cells<br/>Subtable 2 bucket 7: 1 cell ⭐"]
    C --> D
    
    D --> E["Choose least loaded<br/>Subtable 2, bucket 7"]
    
    E --> F["Check if fingerprint 0x9E8F<br/>already exists in bucket 7"]
    
    F --> G{"Fingerprint<br/>exists?"}
    
    G -->|Yes| H["Increment existing<br/>counter"]
    G -->|No| I["Insert new cell with<br/>fingerprint: 0x9E8F<br/> and counter: 1"]
    
    H --> J["✅ Insertion complete"]
    I --> J
    
    style A fill:#5d5fef,color:#f8f9fa
    style J fill:#22c55e,color:#212529
    style G fill:#f59e0b,color:#212529</pre>`),z(28),B(t,a)}const ke=Object.freeze(Object.defineProperty({__proto__:null,default:he,metadata:la},Symbol.toStringTag,{value:"Module"}));function Ss(t){throw new Error(t)}function Fe(t=null,a="published"){const l=Object.entries(Object.assign({"/src/posts/001-binary-shifts-for-flags/index.md":ua,"/src/posts/002-callermembername-attribute-for-logging/index.md":fa,"/src/posts/003-internals-visible-for-testing/index.md":Ca,"/src/posts/004-deconstructors/index.md":Aa,"/src/posts/005-dictionary-on-generics/index.md":Ia,"/src/posts/006-how-to-get-status-of-mongodb-operation/index.md":Ma,"/src/posts/007-fixing-csharp-type-pattern-matching/index.md":Pa,"/src/posts/008-bloom-filters-pt1/index.md":re,"/src/posts/009-counting-bloom-filters/index.md":ke})).map(([p,r])=>{const c=p.replace("/index.md","").split("/").pop(),d=r.metadata;return{slug:c,date:d.date??Ss(`Date is missing in post ${c}`),title:d.title??Ss(`Title is missing in post ${c}`),preview:d.preview??Ss(`Preview is missing in post ${c}`),tags:d.tags??Ss(`Tags are missing in post ${c}`),draft:d.draft??!1,series:d.series}}).filter(p=>a==="all"?!0:p.draft===(a==="draft")).sort((p,r)=>{const c=new Date(p.date);return new Date(r.date).getTime()-c.getTime()});return t?l.slice(0,t):l}function Wn(t){return t?Fe().filter(n=>n.series&&n.series===t).sort((n,o)=>{const l=new Date(n.date),p=new Date(o.date);return l.getTime()-p.getTime()}):[]}export{ua as _,Wn as a,fa as b,Ca as c,Aa as d,Ia as e,Ma as f,Fe as g,Pa as h,re as i,ke as j};
